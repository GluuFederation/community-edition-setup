dn: inum=%(inumOrg)s!0011!031C.4A65,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Id Generator script
displayName: id_generator
gluuStatus: false
inum: %(inumOrg)s!0011!031C.4A65
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5pZCBpbXBvcnQgS
 WRHZW5lcmF0b3JUeXBlCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFy
 cmF5SGVscGVyCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdAoKaW1wb3J
 0IGphdmEKCmNsYXNzIElkR2VuZXJhdG9yKElkR2VuZXJhdG9yVHlwZSk6CiAgICBkZWYgX19pbm
 l0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOgogICAgICAgIHNlbGYuY3VycmVudFRpbWVNa
 WxsaXMgPSBjdXJyZW50VGltZU1pbGxpcwoKICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXphdGl
 vbiIKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbH
 kiCgogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIERlc3Ryb3ki
 CiAgICAgICAgcHJpbnQgIklkIGdlbmVyYXRvci4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIKICA
 gICAgICByZXR1cm4gVHJ1ZSAgIAoKICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOgogICAgIC
 AgIHJldHVybiAxCgogICAgIyBJZCBnZW5lcmF0b3IgaW5pdCBtZXRob2QKICAgICMgICBhcHBJZ
 CBpcyBhcHBsaWNhdGlvbiBJZAogICAgIyAgIGlkVHlwZSBpcyBJZCBUeXBlCiAgICAjICAgaWRQ
 cmVmaXggaXMgSWQgUHJlZml4CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGV
 sLkdsdXVDdXN0b21QZXJzb24KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYX
 ZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+CiAgICBkZWYgZ2VuZXJhd
 GVJZChzZWxmLCBhcHBJZCwgaWRUeXBlLCBpZFByZWZpeCwgY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkIgogICAgICAgIHB
 yaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkLiBBcHBJZDogJyIsIGFwcElkLCAiJywgSW
 RUeXBlOiAnIiwgaWRUeXBlLCAiJywgSWRQcmVmaXg6ICciLCBpZFByZWZpeCwgIiciCgogICAgI
 CAgICMgUmV0dXJuIE5vbmUgb3IgZW1wdHkgc3RyaW5nIHRvIHRyaWdnZXIgZGVmYXVsdCBJZCBn
 ZW5lcmF0aW9uIG1ldGhvZAogICAgICAgIHJldHVybiBOb25lCg==
oxScriptType: id_generator
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!13D3.E7AD,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Cache Refresh script
displayName: cache_refresh
gluuStatus: false
inum: %(inumOrg)s!0011!13D3.E7AD
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBDYWNoZVJlZnJlc2hUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQp
 mcm9tIG9yZy5nbHV1Lm94dHJ1c3QubW9kZWwgaW1wb3J0IEdsdXVDdXN0b21BdHRyaWJ1dGUNCg
 0KaW1wb3J0IGphdmENCg0KY2xhc3MgQ2FjaGVSZWZyZXNoKENhY2hlUmVmcmVzaFR5cGUpOg0KI
 CAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYu
 Y3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcm
 VzaC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLiBJbml0a
 WFsaXplZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRl
 ZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQ
 gIkNhY2hlIHJlZnJlc2guIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLi
 BEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgI
 yBVcGRhdGUgdXNlciBlbnRyeSBiZWZvcmUgcGVyc2lzdCBpdA0KICAgICMgICB1c2VyIGlzIG9y
 Zy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcG
 VydHk+DQogICAgZGVmIHVwZGF0ZVVzZXIoc2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcmVzaC4gVXBkYXRlVXNlciBtZXRob2Qi
 DQoNCiAgICAgICAgYXR0cmlidXRlcyA9IHVzZXIuZ2V0Q3VzdG9tQXR0cmlidXRlcygpDQoNCiA
 gICAgICAgIyBBZGQgbmV3IGF0dHJpYnV0ZSBwcmVmZXJyZWRMYW5ndWFnZQ0KICAgICAgICBhdH
 RyUHJlZmZlcmVkTGFuZ3VhZ2UgPSBHbHV1Q3VzdG9tQXR0cmlidXRlKCJwcmVmZXJyZWRMYW5nd
 WFnZSIsICJlbi11cyIpDQogICAgICAgIGF0dHJpYnV0ZXMuYWRkKGF0dHJQcmVmZmVyZWRMYW5n
 dWFnZSkNCg0KICAgICAgICAjIEFkZCBuZXcgYXR0cmlidXRlIHVzZXJQYXNzd29yZA0KICAgICA
 gICBhdHRyVXNlclBhc3N3b3JkID0gR2x1dUN1c3RvbUF0dHJpYnV0ZSgidXNlclBhc3N3b3JkIi
 wgInRlc3QiKQ0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChhdHRyVXNlclBhc3N3b3JkKQ0KDQogI
 CAgICAgICMgVXBkYXRlIGdpdmVuTmFtZSBhdHRyaWJ1dGUNCiAgICAgICAgZm9yIGF0dHJpYnV0
 ZSBpbiBhdHRyaWJ1dGVzOg0KICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyaWJ1dGUuZ2V0TmF
 tZSgpDQogICAgICAgICAgICBpZiAoKCJnaXZlbm5hbWUiID09IFN0cmluZ0hlbHBlci50b0xvd2
 VyQ2FzZShhdHRyTmFtZSkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShhdHRyaWJ1dGUuZ
 2V0VmFsdWUoKSkpOg0KICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShTdHJpbmdI
 ZWxwZXIucmVtb3ZlTXVsdGlwbGVTcGFjZXMoYXR0cmlidXRlLmdldFZhbHVlKCkpICsgIiAodXB
 kYXRlZCkiKQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbi
 hzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: cache_refresh
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!2DAF.F995,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample UMA Authorization policy
displayName: uma_authorization_policy
gluuStatus: true
inum: %(inumOrg)s!0011!2DAF.F995
oxConfigurationProperty: {"value1":"allowed_clients","value2":"%(scim_rp_client_id)s","description":""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51bWEgaW1wb3J0IEF1d
 Ghvcml6YXRpb25Qb2xpY3lUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0LCBIYXN
 oU2V0DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UudW1hLmF1dGhvcml6YXRpb24gaW1wb3J0IE
 F1dGhvcml6YXRpb25Db250ZXh0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEF1dGhvcml6YXRpb25Qb
 2xpY3koQXV0aG9yaXphdGlvblBvbGljeVR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJy
 ZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGl
 tZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KIC
 AgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml0aWFsaXphdGlvbiINCg0KI
 CAgICAgICBzZWxmLmNsaWVudHNTZXQgPSBzZWxmLnByZXBhcmVDbGllbnRzU2V0KGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKQ0KICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml
 0aWFsaXphdGlvbi4gQ291bnQgYXV0aG9yaXplZCBjbGllbnRzOiAlcyIgJSBzZWxmLmNsaWVudHNTZX
 Quc2l6ZSgpDQoNCiAgICAgICAgcHJpbnQgIlVNQSBhdXRob3JpemF0aW9uIHBvbGljeS4gSW5pdGlhb
 Gl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVz
 dHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgYXV
 0aG9yaXphdGlvbiBwb2xpY3kuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJVTUEgYXV0aG9yaXphdG
 lvbiBwb2xpY3kuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgD
 QoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgICMg
 UHJvY2VzcyBwb2xpY3kgcnVsZQ0KICAgICMgICBhdXRob3JpemF0aW9uQ29udGV4dCBpcyBvcmcueGR
 pLm94YXV0aC5zZXJ2aWNlLnVtYS5hdXRob3JpemF0aW9uLkF1dGhvcml6YXRpb25Db250ZXh0DQogIC
 AgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wb
 GVDdXN0b21Qcm9wZXJ0eT4NCiAgICBkZWYgYXV0aG9yaXplKHNlbGYsIGF1dGhvcml6YXRpb25Db250
 ZXh0LCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXp
 hdGlvbiBwb2xpY3kuIEF0dGVtcHRpbmcgdG8gYXV0aG9yaXplIGNsaWVudCINCiAgICAgICAgY2xpZW
 50X2lkID0gYXV0aG9yaXphdGlvbkNvbnRleHQuZ2V0R3JhbnQoKS5nZXRDbGllbnRJZCgpDQoNCiAgI
 CAgICAgcHJpbnQgIlVNQSBBdXRob3JpemF0aW9uIHBvbGljeS4gQ2xpZW50OiAiLCBjbGllbnRfaWQN
 CiAgICAgICAgaWYgKHNlbGYuY2xpZW50c1NldC5jb250YWlucyhjbGllbnRfaWQpKToNCiAgICAgICA
 gICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3kuIEF1dGhvcml6aW5nIGNsaWVudCINCi
 AgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludCAiV
 U1BIEF1dGhvcml6YXRpb24gcG9saWN5LiBDbGllbnQgaXNuJ3QgYXV0aG9yaXplZCINCiAgICAgICAg
 ICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3k
 uIEF1dGhvcml6aW5nIGNsaWVudCINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBwcmVwYX
 JlQ2xpZW50c1NldChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNsaWVud
 HNTZXQgPSBIYXNoU2V0KCkNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5j
 b250YWluc0tleSgiYWxsb3dlZF9jbGllbnRzIikpOg0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHN
 TZXQNCg0KICAgICAgICBhbGxvd2VkQ2xpZW50c0xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImFsbG93ZWRfY2xpZW50cyIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIChTdHJpbmdIZWxwZ
 XIuaXNFbXB0eShhbGxvd2VkQ2xpZW50c0xpc3QpKToNCiAgICAgICAgICAgIHByaW50ICJVTUEgYXV0
 aG9yaXphdGlvbiBwb2xpY3kuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgYWxsb3dlZF9jbGl
 lbnRzIGlzIGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHNTZXQgICAgDQoNCiAgICAgIC
 AgYWxsb3dlZENsaWVudHNMaXN0QXJyYXkgPSBTdHJpbmdIZWxwZXIuc3BsaXQoYWxsb3dlZENsaWVud
 HNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KGFsbG93ZWRDbGllbnRz
 TGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiB
 Jbml0aWFsaXphdGlvbi4gVGhlcmUgYXJlbid0IGNsaWVudHMgc3BlY2lmaWVkIGluIGFsbG93ZWRfY2
 xpZW50cyBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBjbGllbnRzU2V0DQogICAgICAgIA0KI
 CAgICAgICAjIENvbnZlcnQgdG8gSGFzaFNldCB0byBxdWljayBzZWFyY2gNCiAgICAgICAgaSA9IDAN
 CiAgICAgICAgY291bnQgPSBsZW4oYWxsb3dlZENsaWVudHNMaXN0QXJyYXkpDQogICAgICAgIHdoaWx
 lIChpIDwgY291bnQpOg0KICAgICAgICAgICAgY2xpZW50ID0gYWxsb3dlZENsaWVudHNMaXN0QXJyYX
 lbaV0NCiAgICAgICAgICAgIGNsaWVudHNTZXQuYWRkKGNsaWVudCkNCiAgICAgICAgICAgIGkgPSBpI
 CsgMQ0KDQogICAgICAgIHJldHVybiBjbGllbnRzU2V0DQo=
oxScriptType: uma_authorization_policy
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!522F.CDC5,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Update User script
displayName: update_user
gluuStatus: false
inum: %(inumOrg)s!0011!522F.CDC5
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBVcGRhdGVVc2VyVHlwZQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyLCBB
 cnJheUhlbHBlcgpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QKCmltcG9
 ydCBqYXZhCgpjbGFzcyBVcGRhdGVVc2VyKFVwZGF0ZVVzZXJUeXBlKToKICAgIGRlZiBfX2luaX
 RfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6CiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pb
 GxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzCgogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gSW5pdGlhbGl6YXRpb24
 iCiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiCg
 ogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gRGVzdHJveSIKICAg
 ICAgICBwcmludCAiVXBkYXRlIHVzZXIuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiCiAgICAgICA
 gcmV0dXJuIFRydWUgICAKCiAgICAjIFVwZGF0ZSB1c2VyIGVudHJ5IGJlZm9yZSBwZXJzaXN0ZW
 50IGl0CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZ
 XJzb24KICAgICMgICBwZXJzaXN0ZWQgaXMgYm9vbGVhbiB2YWx1ZSB0byBzcGVjaWZ5IGlmIG9w
 ZXJhdGlvbiB0eXBlOiBhZGQvbW9kaWZ5CiAgICAjICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 gaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5PgogICAgZGVmIH
 VwZGF0ZVVzZXIoc2VsZiwgdXNlciwgcGVyc2lzdGVkLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6CiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBVcGRhdGVVc2VyIG1ldGhvZCIKCiAgICAg
 ICAgdWlkID0gdXNlci5nZXRVaWQoKQogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gVXNlciB
 VaWQ6IiwgdWlkCiAgICAgICAgCiAgICAgICAgbWFpbCA9IHVpZCArICJAZXhhbXBsZS5vcmciCi
 AgICAgICAgdXNlci5zZXRNYWlsKG1haWwpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmI
 GdldEFwaVZlcnNpb24oc2VsZik6CiAgICAgICAgcmV0dXJuIDEK
oxScriptType: update_user
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!6EA0.8F0C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample User Registration script
displayName: user_registration
gluuStatus: false
inum: %(inumOrg)s!0011!6EA0.8F0C
oxConfigurationProperty: {"value1":"enable_user","value2":"false","description":
 ""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9ydCBVc
 2VyUmVnaXN0cmF0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLmxkYXAubW9kZWwgaW1wb3J0IEdsdXVTdGF0
 dXMNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9
 tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QNCg0KaW1wb3J0IGphdmENCg0KY2xhc3
 MgVXNlclJlZ2lzdHJhdGlvbihVc2VyUmVnaXN0cmF0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fK
 HNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9
 IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cml
 idXRlcyk6DQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6YXRpb24iDQ
 oNCiAgICAgICAgc2VsZi5lbmFibGVfdXNlciA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJlbmFibGVfdXNlciIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0K
 ICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSI
 NCg0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIERlc3Ryb
 3kiDQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxs
 eSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXNlciByZWdpc3RyYXRpb24gaW5pdCB
 tZXRob2QNCiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZX
 Jzb24NCiAgICAjICAgcmVxdWVzdFBhcmFtZXRlcnMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFN0c
 mluZ1tdPg0KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0
 cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+DQogICAgZGVmIGluaXRSZWdpc3RyYXRpb24oc2VsZiw
 gdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgIC
 AgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9uLiBJbml0IG1ldGhvZCINCg0KICAgICAgICByZXR1cm4gV
 HJ1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwcmUgbWV0aG9kDQogICAgIyAgIHVzZXIgaXMg
 b3JnLmdsdXUub3h0cnVzdC5tb2RlbC5HbHV1Q3VzdG9tUGVyc29uDQogICAgIyAgIHJlcXVlc3RQYXJ
 hbWV0ZXJzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTdHJpbmdbXT4NCiAgICAjICAgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3Blc
 nR5Pg0KICAgIGRlZiBwcmVSZWdpc3RyYXRpb24oc2VsZiwgdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMs
 IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9
 uLiBQcmUgbWV0aG9kIg0KDQogICAgICAgIHVzZXJTdGF0dXMgPSBHbHV1U3RhdHVzLkFDVElWRQ0KIC
 AgICAgICBpZiBub3Qgc2VsZi5lbmFibGVfdXNlcjoNCiAgICAgICAgICAgIHVzZXJTdGF0dXMgPSBHb
 HV1U3RhdHVzLklOQUNUSVZFDQoNCiAgICAgICAgIyBEaXNhYmxlL0VuYWJsZSByZWdpc3RlcmVkIHVz
 ZXINCiAgICAgICAgdXNlci5zZXRTdGF0dXModXNlclN0YXR1cykNCg0KICAgICAgICByZXR1cm4gVHJ
 1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwb3N0IG1ldGhvZA0KICAgICMgICB1c2VyIGlzIG
 9yZy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICByZXF1ZXN0UGFyY
 W1ldGVycyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU3RyaW5nW10+DQogICAgIyAgIGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ
 0eT4NCiAgICBkZWYgcG9zdFJlZ2lzdHJhdGlvbihzZWxmLCB1c2VyLCByZXF1ZXN0UGFyYW1ldGVycy
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb
 24uIFBvc3QgbWV0aG9kIg0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVy
 c2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: user_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!A51E.76DA,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample authentication module
displayName: basic
gluuStatus: false
inum: %(inumOrg)s!0011!A51E.76DA
oxLevel: 100
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb2
 0gb3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0a
 GVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJT
 ZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQoNCmltcG9ydCB
 qYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVH
 lwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgI
 CAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYg
 aW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJCYXN
 pYy4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJCYXNpYy4gSW5pdGlhbGl6ZWQgc3
 VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc
 2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMuIERl
 c3Ryb3kiDQogICAgICAgIHByaW50ICJCYXNpYy4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiA
 gICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgIC
 AgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmL
 CB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRy
 dWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHV
 zYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZQ
 0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc
 mVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAg
 ICAgICAgIHByaW50ICJCYXNpYy4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgICA
 gICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQ
 ogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgI
 CAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICAg
 ICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5
 pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3
 RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VyU2VydmljZSA9IFVzZ
 XJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2Vy
 dmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgICA
 gICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1c
 m4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0
 cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSA
 xKToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYy4gUHJlcGFyZSBmb3IgU3RlcCAxIg0KICAgIC
 AgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGY
 WxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJh
 dGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGd
 ldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 k6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29uZ
 mlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiINCg0KICAgIGRl
 ZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJ
 zKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!4BBE.C6A8,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Basic (with user locking) authentication module
displayName: basic_lock
gluuStatus: false
inum: %(inumOrg)s!0011!4BBE.C6A8
oxConfigurationProperty: {"value1":"invalid_login_count_attribute","value2":
 "oxCountInvalidLogin","description":""}
oxConfigurationProperty: {"value1":"maximum_invalid_login_attemps","value2":
 "3","description":""}
oxLevel: 110
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb2
 0gb3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0a
 GVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJT
 ZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy5
 nbHV1LnNpdGUubGRhcC5wZXJzaXN0ZW5jZS5leGNlcHRpb24gaW1wb3J0IEF1dGhlbnRpY2F0aW
 9uRXhjZXB0aW9uDQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uK
 FBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJl
 bnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnR
 UaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 k6DQogICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gSW5pdGlhbGl6YXRpb24iD
 QoNCiAgICAgICAgc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0dHJpYnV0ZSA9ICJveENvdW50SW52
 YWxpZExvZ2luIg0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0t
 leSgiaW52YWxpZF9sb2dpbl9jb3VudF9hdHRyaWJ1dGUiKToNCiAgICAgICAgICAgIHNlbGYuaW
 52YWxpZExvZ2luQ291bnRBdHRyaWJ1dGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoI
 mludmFsaWRfbG9naW5fY291bnRfYXR0cmlidXRlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgZWxz
 ZToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gSW5pdGlhbGl6YXR
 pb24uIFVzaW5nIGRlZmF1bHQgYXR0cmlidXRlIg0KDQogICAgICAgIHNlbGYubWF4aW11bUludm
 FsaWRMb2dpbkF0dGVtcHMgPSAzDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 mNvbnRhaW5zS2V5KCJtYXhpbXVtX2ludmFsaWRfbG9naW5fYXR0ZW1wcyIpOg0KICAgICAgICAg
 ICAgc2VsZi5tYXhpbXVtSW52YWxpZExvZ2luQXR0ZW1wcyA9IFN0cmluZ0hlbHBlci50b0ludGV
 nZXIoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJtYXhpbXVtX2ludmFsaWRfbG9naW5fYX
 R0ZW1wcyIpLmdldFZhbHVlMigpKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQgI
 kJhc2ljIChsb2NrIGFjY291bnQpLiBJbml0aWFsaXphdGlvbi4gVXNpbmcgZGVmYXVsdCBudW1i
 ZXIgYXR0ZW1wdHMiDQoNCiAgICAgICAgcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBJbml
 0aWFsaXplZCBzdWNjZXNzZnVsbHkuIGludmFsaWRfbG9naW5fY291bnRfYXR0cmlidXRlOiAnJX
 MnLCBtYXhpbXVtX2ludmFsaWRfbG9naW5fYXR0ZW1wczogJyVzJyIgJSAoc2VsZi5pbnZhbGlkT
 G9naW5Db3VudEF0dHJpYnV0ZSwgc2VsZi5tYXhpbXVtSW52YWxpZExvZ2luQXR0ZW1wcykNCg0K
 ICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIE
 Rlc3Ryb3kiDQogICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gRGVzdHJveWVkI
 HN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJz
 aW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWN
 hdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCi
 AgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0a
 W9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAg
 ICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiBzdG
 VwID09IDE6DQogICAgICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIEF1dGhlb
 nRpY2F0ZSBmb3Igc3RlcCAxIg0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5
 Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3J
 lZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZW
 RlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUp
 IGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICA
 gICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgIC
 AgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2Vyd
 mljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KICAgICAgICAgICAg
 ICAgIGV4Y2VwdCBBdXRoZW50aWNhdGlvbkV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICAgICA
 gcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBBdXRoZW50aWNhdGUuIEZhaWxlZCB0byBhdX
 RoZW50aWNhdGUgdXNlciAnJXMnIiAlIHVzZXJfbmFtZQ0KDQogICAgICAgICAgICBpZiAobm90I
 GxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgY291bnRJbnZhbGlkTG9naW5BcnJpYnV0ZVZh
 bHVlID0gc2VsZi5nZXRVc2VyQXR0cmlidXRlVmFsdWUodXNlcl9uYW1lLCBzZWxmLmludmFsaWR
 Mb2dpbkNvdW50QXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgIGNvdW50SW52YWxpZExvZ2luID
 0gU3RyaW5nSGVscGVyLnRvSW50ZWdlcihjb3VudEludmFsaWRMb2dpbkFycmlidXRlVmFsdWUsI
 DApDQoNCiAgICAgICAgICAgICAgICBpZiBjb3VudEludmFsaWRMb2dpbiA8IHNlbGYubWF4aW11
 bUludmFsaWRMb2dpbkF0dGVtcHM6DQogICAgICAgICAgICAgICAgICAgIGNvdW50SW52YWxpZEx
 vZ2luID0gY291bnRJbnZhbGlkTG9naW4gKyAxDQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2
 V0VXNlckF0dHJpYnV0ZVZhbHVlKHVzZXJfbmFtZSwgc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0d
 HJpYnV0ZSwgU3RyaW5nSGVscGVyLnRvU3RyaW5nKGNvdW50SW52YWxpZExvZ2luKSkNCg0KICAg
 ICAgICAgICAgICAgIGlmIGNvdW50SW52YWxpZExvZ2luID49IHNlbGYubWF4aW11bUludmFsaWR
 Mb2dpbkF0dGVtcHM6DQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9ja1VzZXIodXNlcl9uYW
 1lKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNC
 g0KICAgICAgICAgICAgc2VsZi5zZXRVc2VyQXR0cmlidXRlVmFsdWUodXNlcl9uYW1lLCBzZWxm
 LmludmFsaWRMb2dpbkNvdW50QXR0cmlidXRlLCBTdHJpbmdIZWxwZXIudG9TdHJpbmcoMCkpDQo
 NCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZX
 R1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQ
 XR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiBzdGVwID09
 IDE6DQogICAgICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIFByZXBhcmUgZm9
 yIFN0ZXAgMSINCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgIC
 AgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwK
 HNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5v
 bmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGdldFBhZ2VGb3
 JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0d
 XJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBy
 ZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0VXN
 lckF0dHJpYnV0ZVZhbHVlKHNlbGYsIHVzZXJfbmFtZSwgYXR0cmlidXRlX25hbWUpOg0KICAgIC
 AgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh1c2VyX25hbWUpOg0KICAgICAgICAgICAgcmV0d
 XJuIE5vbmUNCg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkN
 Cg0KICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25
 hbWUsIGF0dHJpYnV0ZV9uYW1lKQ0KICAgICAgICBpZiBmaW5kX3VzZXJfYnlfdWlkID09IE5vbm
 U6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGN1c3RvbV9hdHRyaWJ1dGVfd
 mFsdWUgPSB1c2VyU2VydmljZS5nZXRDdXN0b21BdHRyaWJ1dGUoZmluZF91c2VyX2J5X3VpZCwg
 YXR0cmlidXRlX25hbWUpDQogICAgICAgIGlmIGN1c3RvbV9hdHRyaWJ1dGVfdmFsdWUgPT0gTm9
 uZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBhdHRyaWJ1dG
 VfdmFsdWUgPSBjdXN0b21fYXR0cmlidXRlX3ZhbHVlLmdldFZhbHVlKCkNCg0KICAgICAgICBwc
 mludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIEdldCB1c2VyIGF0dHJpYnV0ZS4gVXNlcidzICcl
 cycgYXR0cmlidXRlICclcycgdmFsdWUgaXMgJyVzJyIgJSAodXNlcl9uYW1lLCBhdHRyaWJ1dGV
 fbmFtZSwgYXR0cmlidXRlX3ZhbHVlKQ0KDQogICAgICAgIHJldHVybiBhdHRyaWJ1dGVfdmFsdW
 UNCg0KICAgIGRlZiBzZXRVc2VyQXR0cmlidXRlVmFsdWUoc2VsZiwgdXNlcl9uYW1lLCBhdHRya
 WJ1dGVfbmFtZSwgYXR0cmlidXRlX3ZhbHVlKToNCiAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlz
 RW1wdHkodXNlcl9uYW1lKToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgdXN
 lclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgZmluZF91c2VyX2
 J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiBmaW5kX
 3VzZXJfYnlfdWlkID09IE5vbmU6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICAN
 CiAgICAgICAgdXNlclNlcnZpY2Uuc2V0Q3VzdG9tQXR0cmlidXRlKGZpbmRfdXNlcl9ieV91aWQ
 sIGF0dHJpYnV0ZV9uYW1lLCBhdHRyaWJ1dGVfdmFsdWUpDQogICAgICAgIHVwZGF0ZWRfdXNlci
 A9IHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXIoZmluZF91c2VyX2J5X3VpZCkNCg0KICAgICAgICBwc
 mludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIFNldCB1c2VyIGF0dHJpYnV0ZS4gVXNlcidzICcl
 cycgYXR0cmlidXRlICclcycgdmFsdWUgaXMgJyVzJyIgJSAodXNlcl9uYW1lLCBhdHRyaWJ1dGV
 fbmFtZSwgYXR0cmlidXRlX3ZhbHVlKQ0KDQogICAgICAgIHJldHVybiB1cGRhdGVkX3VzZXINCg
 0KICAgIGRlZiBsb2NrVXNlcihzZWxmLCB1c2VyX25hbWUpOg0KICAgICAgICBpZiBTdHJpbmdIZ
 WxwZXIuaXNFbXB0eSh1c2VyX25hbWUpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAg
 ICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBmaW5
 kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25hbWUpDQogICAgICAgIG
 lmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNC
 g0KICAgICAgICBzdGF0dXNfYXR0cmlidXRlX3ZhbHVlID0gdXNlclNlcnZpY2UuZ2V0Q3VzdG9t
 QXR0cmlidXRlKGZpbmRfdXNlcl9ieV91aWQsICJnbHV1U3RhdHVzIikNCiAgICAgICAgaWYgc3R
 hdHVzX2F0dHJpYnV0ZV92YWx1ZSAhPSBOb25lOg0KICAgICAgICAgICAgdXNlcl9zdGF0dXMgPS
 BzdGF0dXNfYXR0cmlidXRlX3ZhbHVlLmdldFZhbHVlKCkNCiAgICAgICAgICAgIGlmIFN0cmluZ
 0hlbHBlci5lcXVhbHModXNlcl9zdGF0dXMsICJpbmFjdGl2ZSIpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gTG9jayB1c2VyLiBVc2VyICclcycgbG9ja2V
 kIGFscmVhZHkiICUgdXNlcl9uYW1lDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA
 0KICAgICAgICB1c2VyU2VydmljZS5zZXRDdXN0b21BdHRyaWJ1dGUoZmluZF91c2VyX2J5X3VpZ
 CwgImdsdXVTdGF0dXMiLCAiaW5hY3RpdmUiKQ0KICAgICAgICB1cGRhdGVkX3VzZXIgPSB1c2Vy
 U2VydmljZS51cGRhdGVVc2VyKGZpbmRfdXNlcl9ieV91aWQpDQoNCiAgICAgICAgcHJpbnQgIkJ
 hc2ljIChsb2NrIGFjY291bnQpLiBMb2NrIHVzZXIuIFVzZXIgJyVzJyBsb2NrZWQiICUgdXNlcl
 9uYW1lDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!8BAF.80D6,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Fido U2F authentication module
displayName: u2f
gluuStatus: false
inum: %(inumOrg)s!0011!8BAF.80D6
oxConfigurationProperty: {"value1":"u2f_application_id","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"u2f_server_uri","value2":"https://%(hostname)s","description":""}
oxLevel: 10
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydC
 BQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMga
 W1wb3J0IENvbnRleHQsIENvbnRleHRzDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGlt
 cG9ydCBJZGVudGl0eQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2V
 ydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBTZXNzaW9uU3RhdGVTZX
 J2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54Z
 GkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLnhkaS5veGF1dGguY2xpZW50LmZp
 ZG8udTJmIGltcG9ydCBGaWRvVTJmQ2xpZW50RmFjdG9yeQ0KZnJvbSBvcmcueGRpLm94YXV0aC5
 zZXJ2aWNlLmZpZG8udTJmIGltcG9ydCBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlDQpmcm9tIG
 9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20gb3JnLnhkaS5veGF1d
 GgubW9kZWwuY29uZmlnIGltcG9ydCBDb25zdGFudHMNCmZyb20gb3JnLmpib3NzLnJlc3RlYXN5
 LmNsaWVudCBpbXBvcnQgQ2xpZW50UmVzcG9uc2VGYWlsdXJlDQpmcm9tIGphdmF4LndzLnJzLmN
 vcmUgaW1wb3J0IFJlc3BvbnNlDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzDQoNCmltcG
 9ydCBzeXMNCmltcG9ydCBqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvb
 kF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1l
 TWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWl
 sbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogIC
 AgICAgIHByaW50ICJVMkYuIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHByaW50ICJVMkYuI
 EluaXRpYWxpemF0aW9uLiBEb3dubG9hZGluZyBVMkYgbWV0YWRhdGEiDQogICAgICAgIHUyZl9z
 ZXJ2ZXJfdXJpID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ1MmZfc2VydmVyX3VyaSI
 pLmdldFZhbHVlMigpDQogICAgICAgIHUyZl9zZXJ2ZXJfbWV0YWRhdGFfdXJpID0gdTJmX3Nlcn
 Zlcl91cmkgKyAiLy53ZWxsLWtub3duL2ZpZG8tdTJmLWNvbmZpZ3VyYXRpb24iDQoNCiAgICAgI
 CAgbWV0YURhdGFDb25maWd1cmF0aW9uU2VydmljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmlu
 c3RhbmNlKCkuY3JlYXRlTWV0YURhdGFDb25maWd1cmF0aW9uU2VydmljZSh1MmZfc2VydmVyX21
 ldGFkYXRhX3VyaSkNCg0KICAgICAgICBtYXhfYXR0ZW1wdHMgPSAzDQogICAgICAgIGZvciBhdH
 RlbXB0IGluIHJhbmdlKDEsIG1heF9hdHRlbXB0cyk6DQogICAgICAgICAgICB0cnk6DQogICAgI
 CAgICAgICAgICAgc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24gPSBtZXRhRGF0YUNvbmZpZ3Vy
 YXRpb25TZXJ2aWNlLmdldE1ldGFkYXRhQ29uZmlndXJhdGlvbigpDQogICAgICAgICAgICAgICA
 gYnJlYWsNCiAgICAgICAgICAgIGV4Y2VwdCBDbGllbnRSZXNwb25zZUZhaWx1cmUsIGV4Og0KIC
 AgICAgICAgICAgICAgICMgRGV0ZWN0IGlmIGxhc3QgdHJ5IG9yIHdlIHN0aWxsIGdldCBTZXJ2a
 WNlIFVuYXZhaWxhYmxlIEhUVFAgZXJyb3INCiAgICAgICAgICAgICAgICBpZiAoYXR0ZW1wdCA9
 PSBtYXhfYXR0ZW1wdHMpIG9yIChleC5nZXRSZXNwb25zZSgpLmdldFJlc3BvbnNlU3RhdHVzKCk
 gIT0gUmVzcG9uc2UuU3RhdHVzLlNFUlZJQ0VfVU5BVkFJTEFCTEUpOg0KICAgICAgICAgICAgIC
 AgICAgICByYWlzZSBleA0KDQogICAgICAgICAgICAgICAgamF2YS5sYW5nLlRocmVhZC5zbGVlc
 CgzMDAwKQ0KICAgICAgICAgICAgICAgIHByaW50ICJBdHRlbXB0aW5nIHRvIGxvYWQgbWV0YWRh
 dGE6ICVkIiAlIGF0dGVtcHQNCiAgICAgICAgDQogICAgICAgIHByaW50ICJVMkYuIEluaXRpYWx
 pemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZX
 N0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlUyR
 i4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIlUyRi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIN
 CiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICA
 gICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZW
 xmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuI
 FRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYs
 IHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9
 uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 wgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50a
 XR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVk
 ZW50aWFscy5nZXRVc2VybmFtZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICA
 gICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgIC
 AgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgI
 GxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1w
 dHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXN
 lcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2
 UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1d
 GhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChu
 b3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICA
 gICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIH
 ByaW50ICJVMkYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICB0b2tlb
 l9yZXNwb25zZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywg
 InRva2VuUmVzcG9uc2UiKQ0KICAgICAgICAgICAgaWYgdG9rZW5fcmVzcG9uc2UgPT0gTm9uZTo
 NCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gdG
 9rZW5SZXNwb25zZSBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KI
 CAgICAgICAgICAgYXV0aF9tZXRob2QgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVz
 dFBhcmFtZXRlcnMsICJhdXRoTWV0aG9kIikNCiAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kID0
 9IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdG
 VwIDIuIGF1dGhNZXRob2QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVk
 ZW50aWFscygpDQogICAgICAgICAgICB1c2VyID0gY3JlZGVudGlhbHMuZ2V0VXNlcigpDQogICA
 gICAgICAgICBpZiAodXNlciA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLi
 BQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlcm1pbmUgdXNlciBuYW1lIg0KICAgI
 CAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBpZiAoYXV0aF9tZXRob2Qg
 PT0gJ2F1dGhlbnRpY2F0ZScpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmU
 gZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBmaW5pc2ggYXV0aGVudGljYX
 Rpb24gd29ya2Zsb3ciDQogICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb25SZXF1ZXN0U2Vyd
 mljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmluc3RhbmNlKCkuY3JlYXRlQXV0aGVudGljYXRp
 b25SZXF1ZXN0U2VydmljZShzZWxmLm1ldGFEYXRhQ29uZmlndXJhdGlvbikNCiAgICAgICAgICA
 gICAgICBhdXRoZW50aWNhdGlvblN0YXR1cyA9IGF1dGhlbnRpY2F0aW9uUmVxdWVzdFNlcnZpY2
 UuZmluaXNoQXV0aGVudGljYXRpb24odXNlci5nZXRVc2VySWQoKSwgdG9rZW5fcmVzcG9uc2UpD
 QoNCiAgICAgICAgICAgICAgICBpZiAoYXV0aGVudGljYXRpb25TdGF0dXMuZ2V0U3RhdHVzKCkg
 IT0gQ29uc3RhbnRzLlJFU1VMVF9TVUNDRVNTKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQ
 gIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEdldCBpbnZhbGlkIGF1dGhlbnRpY2F0aW
 9uIHN0YXR1cyBmcm9tIEZJRE8gVTJGIHNlcnZlciINCiAgICAgICAgICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxp
 ZiAoYXV0aF9tZXRob2QgPT0gJ2Vucm9sbCcpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkY
 uIFByZXBhcmUgZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBmaW5pc2ggcm
 VnaXN0cmF0aW9uIHdvcmtmbG93Ig0KICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvblJlcXVlc
 3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudEZhY3RvcnkuaW5zdGFuY2UoKS5jcmVhdGVSZWdpc3Ry
 YXRpb25SZXF1ZXN0U2VydmljZShzZWxmLm1ldGFEYXRhQ29uZmlndXJhdGlvbikNCiAgICAgICA
 gICAgICAgICByZWdpc3RyYXRpb25TdGF0dXMgPSByZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZS
 5maW5pc2hSZWdpc3RyYXRpb24odXNlci5nZXRVc2VySWQoKSwgdG9rZW5fcmVzcG9uc2UpDQoNC
 iAgICAgICAgICAgICAgICBpZiAocmVnaXN0cmF0aW9uU3RhdHVzLmdldFN0YXR1cygpICE9IENv
 bnN0YW50cy5SRVNVTFRfU1VDQ0VTUyk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJVMkY
 uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBHZXQgaW52YWxpZCByZWdpc3RyYXRpb24gc3RhdH
 VzIGZyb20gRklETyBVMkYgc2VydmVyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc
 2UNCg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBlbHNlOg0KICAg
 ICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gQXV0aGVudGljYXR
 pb2QgbWV0aG9kIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IEN
 vbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogIC
 AgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgI
 CAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICBzZXNz
 aW9uX3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb25TdGF
 0ZUZyb21Db29raWUoKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2Vzc2
 lvbl9zdGF0ZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3Rlc
 CAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICAgICAgICAgICAg
 cmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGF
 uY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyID0gY3JlZGVudGlhbHMuZ2
 V0VXNlcigpDQoNCiAgICAgICAgICAgIGlmICh1c2VyID09IE5vbmUpOg0KICAgICAgICAgICAgI
 CAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1
 c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHU
 yZl9hcHBsaWNhdGlvbl9pZCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgidTJmX2FwcG
 xpY2F0aW9uX2lkIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB1c2VyI
 GhhdmUgcmVnaXN0ZXJlZCBkZXZpY2VzDQogICAgICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb25T
 ZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICA
 gICAgIHVzZXJJbnVtID0gdXNlci5nZXRBdHRyaWJ1dGUoImludW0iKQ0KDQogICAgICAgICAgIC
 ByZWdpc3RyYXRpb25SZXF1ZXN0ID0gTm9uZQ0KICAgICAgICAgICAgYXV0aGVudGljYXRpb25SZ
 XF1ZXN0ID0gTm9uZQ0KDQogICAgICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb25zID0gZGV2aWNl
 UmVnaXN0cmF0aW9uU2VydmljZS5maW5kVXNlckRldmljZVJlZ2lzdHJhdGlvbnModXNlckludW0
 sIHUyZl9hcHBsaWNhdGlvbl9pZCkNCiAgICAgICAgICAgIGlmIChkZXZpY2VSZWdpc3RyYXRpb2
 5zLnNpemUoKSA+IDApOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yI
 HN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBzdGFydCBhdXRoZW50aWNhdGlvbiB3
 b3JrZmxvdyINCg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgYXV
 0aGVudGljYXRpb25SZXF1ZXN0U2VydmljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmluc3Rhbm
 NlKCkuY3JlYXRlQXV0aGVudGljYXRpb25SZXF1ZXN0U2VydmljZShzZWxmLm1ldGFEYXRhQ29uZ
 mlndXJhdGlvbikNCiAgICAgICAgICAgICAgICAgICAgYXV0aGVudGljYXRpb25SZXF1ZXN0ID0g
 YXV0aGVudGljYXRpb25SZXF1ZXN0U2VydmljZS5zdGFydEF1dGhlbnRpY2F0aW9uKHVzZXIuZ2V
 0VXNlcklkKCksIE5vbmUsIHUyZl9hcHBsaWNhdGlvbl9pZCwgc2Vzc2lvbl9zdGF0ZSkNCiAgIC
 AgICAgICAgICAgICBleGNlcHQgQ2xpZW50UmVzcG9uc2VGYWlsdXJlLCBleDoNCiAgICAgICAgI
 CAgICAgICAgICAgaWYgKGV4LmdldFJlc3BvbnNlKCkuZ2V0UmVzcG9uc2VTdGF0dXMoKSAhPSBS
 ZXNwb25zZS5TdGF0dXMuTk9UX0ZPVU5EKToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW5
 0ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIHN0YXJ0IGF1dGhlbnRpY2F0aW
 9uIHdvcmtmbG93LiBFeGNlcHRpb246Iiwgc3lzLmV4Y19pbmZvKClbMV0NCiAgICAgICAgICAgI
 CAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 ICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIuIENhbGwgRklETyBVMkYgaW4gb3J
 kZXIgdG8gc3RhcnQgcmVnaXN0cmF0aW9uIHdvcmtmbG93Ig0KICAgICAgICAgICAgICAgIHJlZ2
 lzdHJhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudEZhY3RvcnkuaW5zdGFuY2UoK
 S5jcmVhdGVSZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZShzZWxmLm1ldGFEYXRhQ29uZmlndXJh
 dGlvbikNCiAgICAgICAgICAgICAgICByZWdpc3RyYXRpb25SZXF1ZXN0ID0gcmVnaXN0cmF0aW9
 uUmVxdWVzdFNlcnZpY2Uuc3RhcnRSZWdpc3RyYXRpb24odXNlci5nZXRVc2VySWQoKSwgdTJmX2
 FwcGxpY2F0aW9uX2lkLCBzZXNzaW9uX3N0YXRlKQ0KDQogICAgICAgICAgICBjb250ZXh0LnNld
 CgiZmlkb191MmZfYXV0aGVudGljYXRpb25fcmVxdWVzdCIsIFNlcnZlclV0aWwuYXNKc29uKGF1
 dGhlbnRpY2F0aW9uUmVxdWVzdCkpDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZmlkb191MmZ
 fcmVnaXN0cmF0aW9uX3JlcXVlc3QiLCBTZXJ2ZXJVdGlsLmFzSnNvbihyZWdpc3RyYXRpb25SZX
 F1ZXN0KSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9P
 SAzKToNCiAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAg
 ICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiB
 GYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmI
 GdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRl
 cyk6DQogICAgICAgIHJldHVybiAyDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29
 uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCi
 AgICAgICAgICAgIHJldHVybiAiL2F1dGgvdTJmL2xvZ2luLnhodG1sIg0KDQogICAgICAgIHJld
 HVybiAiIg0KDQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywg
 cmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!92F0.BF9E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Super Gluu authentication module
displayName: super_gluu
gluuStatus: false
inum: %(inumOrg)s!0011!92F0.BF9E
oxConfigurationProperty: {"value1":"qr_options","value2":"{ size: 500, mSize: 0.
 05 }","description":""}
oxConfigurationProperty: {"value1":"label","value2":"Super Gluu","description":""}
oxConfigurationProperty: {"value1":"registration_uri","value2":"https://%(hostname)s/identity/register","description":""}
oxConfigurationProperty: {"value1":"authentication_mode","value2":"two_step","de
 scription":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/super_gluu_creds.json","description":""}
oxLevel: 15
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuI
 FNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQojIENv
 cHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KaW1
 wb3J0IHN5cw0KaW1wb3J0IGRhdGV0aW1lDQppbXBvcnQgdXJsbGliDQoNCmZyb20gb3JnLnhkaS5tb2
 RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0aGVudGljYXRpb25UeXBlD
 Qpmcm9tIG9yZy5qYm9zcy5zZWFtLmNvbnRleHRzIGltcG9ydCBDb250ZXh0cw0KZnJvbSBvcmcuamJv
 c3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gb3JnLnhkaS5veGF1dGguc2Vydml
 jZSBpbXBvcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgU2
 Vzc2lvblN0YXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmZpZG8udTJmIGltc
 G9ydCBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20
 gb3JnLnhkaS51dGlsLnNlY3VyaXR5IGltcG9ydCBTdHJpbmdFbmNyeXB0ZXINCmZyb20gb3JnLnhkaS
 5veGF1dGgubW9kZWwuY29uZmlnIGltcG9ydCBDb25maWd1cmF0aW9uRmFjdG9yeQ0KZnJvbSBqYXZhL
 nV0aWwgaW1wb3J0IEFycmF5cw0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLm5ldCBpbXBvcnQg
 SHR0cFNlcnZpY2UNCmZyb20gb3JnLmFwYWNoZS5odHRwLnBhcmFtcyBpbXBvcnQgQ29yZUNvbm5lY3R
 pb25QTmFtZXMNCmZyb20gY29tLm5vdG5vb3AuYXBucyBpbXBvcnQgQVBOUw0KZnJvbSBjb20uZ29vZ2
 xlLmFuZHJvaWQuZ2NtLnNlcnZlciBpbXBvcnQgU2VuZGVyLCBNZXNzYWdlDQoNCg0KdHJ5Og0KICAgI
 GltcG9ydCBqc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMg
 anNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGU
 pOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbG
 YuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZ
 iwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5p
 dGlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnR
 haW5zS2V5KCJhdXRoZW50aWNhdGlvbl9tb2RlIik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2
 x1dS4gSW5pdGlhbGl6YXRpb24uIFByb3BlcnR5IGF1dGhlbnRpY2F0aW9uX21vZGUgaXMgbWFuZGF0b
 3J5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5yZWdpc3RyYXRpb25V
 cmkgPSBOb25lDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJ
 yZWdpc3RyYXRpb25fdXJpIik6DQogICAgICAgICAgICBzZWxmLnJlZ2lzdHJhdGlvblVyaSA9IGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgicmVnaXN0cmF0aW9uX3VyaSIpLmdldFZhbHVlMigpDQoNC
 iAgICAgICAgYXV0aGVudGljYXRpb25fbW9kZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgi
 YXV0aGVudGljYXRpb25fbW9kZSIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIFN0cmluZ0hlbHBlci5
 pc0VtcHR5KGF1dGhlbnRpY2F0aW9uX21vZGUpOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdX
 UuIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIGF1dGhlbnRpY2F0aW9uX21vZGUuI
 GF1dGhlbnRpY2F0aW9uX21vZGUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIgaXMgZW1wdHkiDQogICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICAgIHNlbGYub25lU3RlcCA9IFN0cml
 uZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGF1dGhlbnRpY2F0aW9uX21vZGUsICJvbmVfc3RlcCIpDQ
 ogICAgICAgIHNlbGYudHdvU3RlcCA9IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGF1dGhlb
 nRpY2F0aW9uX21vZGUsICJ0d29fc3RlcCIpDQoNCiAgICAgICAgaWYgbm90IChzZWxmLm9uZVN0ZXAg
 b3Igc2VsZi50d29TdGVwKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXp
 hdGlvbi4gVmFsaWQgYXV0aGVudGljYXRpb25fbW9kZSB2YWx1ZXMgYXJlIG9uZV9zdGVwIGFuZCB0d2
 9fc3RlcCINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgc2VsZi5lb
 mFibGVkUHVzaE5vdGlmaWNhdGlvbnMgPSBzZWxmLmluaXRQdXNoTm90aWZpY2F0aW9uU2VydmljZShj
 b25maWd1cmF0aW9uQXR0cmlidXRlcykNCg0KICAgICAgICBzZWxmLmN1c3RvbUxhYmVsID0gTm9uZQ0
 KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgibGFiZWwiKToNCi
 AgICAgICAgICAgIHNlbGYuY3VzdG9tTGFiZWwgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoI
 mxhYmVsIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBzZWxmLmN1c3RvbVFyT3B0aW9ucyA9IHt9DQog
 ICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJxcl9vcHRpb25zIik
 6DQogICAgICAgICAgICBzZWxmLmN1c3RvbVFyT3B0aW9ucyA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dG
 VzLmdldCgicXJfb3B0aW9ucyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsd
 XUuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseS4gb25lU3RlcDogJyVzJywgdHdvU3RlcDogJyVzJywg
 cHVzaE5vdGlmaWNhdGlvbnM6ICclcycsIGN1c3RvbUxhYmVsOiAnJXMnIiAlIChzZWxmLm9uZVN0ZXA
 sIHNlbGYudHdvU3RlcCwgc2VsZi5lbmFibGVkUHVzaE5vdGlmaWNhdGlvbnMsIHNlbGYuY3VzdG9tTG
 FiZWwpDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvb
 mZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIERlc3Ryb3ki
 DQogICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICA
 gICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldH
 VybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZ
 SwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVm
 IGdldEFsdGVybmF0aXZlQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd
 1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgYXV0aGVudG
 ljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3Rlc
 Ck6DQogICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFs
 cygpDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCg0KICAgICA
 gICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgc2Vzc2lvbl9hdH
 RyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCg0KICAgICAgICBjbGllb
 nRfcmVkaXJlY3RfdXJpID0gc2VsZi5nZXRDbGllbnRSZWRpcmVjVXJpKHNlc3Npb25fYXR0cmlidXRl
 cykNCiAgICAgICAgaWYgY2xpZW50X3JlZGlyZWN0X3VyaSA9PSBOb25lOg0KICAgICAgICAgICAgcHJ
 pbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZS4gcmVkaXJlY3RfdXJpIGlzIG5vdCBzZXQiDQogIC
 AgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLnNldEV2ZW50Q29udGV4dFBhcmFtZ
 XRlcnMoY29udGV4dCkNCg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNl
 KCkNCiAgICAgICAgZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZSA9IERldmljZVJlZ2lzdHJhdGlvblN
 lcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgICBwcmludC
 AiU3VwZXItR2x1dS4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQogICAgICAgICAgICBpZiBzZWxmL
 m9uZVN0ZXA6DQogIA0KICAgICAgICAgICAgICAgIHNlc3Npb25fZGV2aWNlX3N0YXR1cyA9IHNlbGYu
 Z2V0U2Vzc2lvbkRldmljZVN0YXR1cyhzZXNzaW9uX2F0dHJpYnV0ZXMsIHVzZXJfbmFtZSkNCiAgICA
 gICAgICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXMgPT0gTm9uZToNCiAgICAgICAgICAgIC
 AgICAgICAgcmV0dXJuDQoNCiAgICAgICAgICAgICAgICB1MmZfZGV2aWNlX2lkID0gc2Vzc2lvbl9kZ
 XZpY2Vfc3RhdHVzWydkZXZpY2VfaWQnXQ0KDQogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1
 bHQgPSBzZWxmLnZhbGlkYXRlU2Vzc2lvbkRldmljZVN0YXR1cyhjbGllbnRfcmVkaXJlY3RfdXJpLCB
 zZXNzaW9uX2RldmljZV9zdGF0dXMpDQogICAgICAgICAgICAgICAgaWYgdmFsaWRhdGlvbl9yZXN1bH
 Q6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yI
 HN0ZXAgMS4gVXNlciBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZCB3aXRoIHUyZl9kZXZpY2UgJyVz
 JyIgJSB1MmZfZGV2aWNlX2lkDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICA
 gICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIG
 5vdCBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ29uZV9zdGVwJ106DQogICAgICAgICAgICAgICAgICAgI
 HByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdTJmX2RldmljZSAnJXMn
 IGlzIG5vdCBvbmUgc3RlcCBkZXZpY2UiICUgdTJmX2RldmljZV9pZA0KICAgICAgICAgICAgICAgICA
 gICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBUaG
 VyZSBhcmUgdHdvIHN0ZXBzIG9ubHkgaW4gZW5yb2xsbWVudCBtb2RlDQogICAgICAgICAgICAgICAga
 WYgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydlbnJvbGwnXToNCiAgICAgICAgICAgICAgICAgICAgcmV0
 dXJuIHZhbGlkYXRpb25fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic3VwZXJ
 fZ2x1dV9jb3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICB1c2VyX2ludW0gPS
 BzZXNzaW9uX2RldmljZV9zdGF0dXNbJ3VzZXJfaW51bSddDQoNCiAgICAgICAgICAgICAgICB1MmZfZ
 GV2aWNlID0gZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5maW5kVXNlckRldmljZVJlZ2lzdHJhdGlv
 bih1c2VyX2ludW0sIHUyZl9kZXZpY2VfaWQsICJveElkIikNCiAgICAgICAgICAgICAgICBpZiB1MmZ
 fZGV2aWNlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGxvYWQgdTJmX2RldmljZSAnJXMnIiAlIHUyZ
 l9kZXZpY2VfaWQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAg
 ICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lKQ0KICAgICA
 gICAgICAgICAgIGlmIG5vdCBsb2dnZWRfaW46DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTdX
 Blci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB1c
 2VyICclcyciICUgdXNlcl9uYW1lDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQog
 ICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB
 Vc2VyICclcycgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQgd2l0aCB1MmZfZGV2aWNlICclcyciIC
 UgKHVzZXJfbmFtZSwgdTJmX2RldmljZV9pZCkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgI
 CAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxpZiBzZWxmLnR3b1N0ZXA6DQogICAgICAgICAg
 ICAgICAgYXV0aGVudGljYXRlZF91c2VyID0gc2VsZi5wcm9jZXNzQmFzaWNBdXRoZW50aWNhdGlvbih
 jcmVkZW50aWFscykNCiAgICAgICAgICAgICAgICBpZiBhdXRoZW50aWNhdGVkX3VzZXIgPT0gTm9uZT
 oNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgICAgICAgICAgICAgY
 XV0aF9tZXRob2QgPSAnYXV0aGVudGljYXRlJw0KICAgICAgICAgICAgICAgIGVucm9sbG1lbnRfbW9k
 ZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywgImxvZ2luRm9ybTp
 yZWdpc3RlckJ1dHRvbiIpDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzTm90RW1wdH
 koZW5yb2xsbWVudF9tb2RlKToNCiAgICAgICAgICAgICAgICAgICAgYXV0aF9tZXRob2QgPSAnZW5yb
 2xsJw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kID09ICdh
 dXRoZW50aWNhdGUnOg0KICAgICAgICAgICAgICAgICAgICB1c2VyX2ludW0gPSB1c2VyU2VydmljZS5
 nZXRVc2VySW51bShhdXRoZW50aWNhdGVkX3VzZXIpDQogICAgICAgICAgICAgICAgICAgIHUyZl9kZX
 ZpY2VzX2xpc3QgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyRGV2aWNlUmVnaXN0c
 mF0aW9ucyh1c2VyX2ludW0sIGNsaWVudF9yZWRpcmVjdF91cmksICJveElkIikNCiAgICAgICAgICAg
 ICAgICAgICAgaWYgdTJmX2RldmljZXNfbGlzdC5zaXplKCkgPT0gMDoNCiAgICAgICAgICAgICAgICA
 gICAgICAgIGF1dGhfbWV0aG9kID0gJ2Vucm9sbCcNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW
 50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGhlcmUgaXMgbm8gVTJGICclc
 ycgdXNlciBkZXZpY2VzIGFzc29jaWF0ZWQgd2l0aCBhcHBsaWNhdGlvbiAnJXMnLiBDaGFuZ2luZyBh
 dXRoX21ldGhvZCB0byAnJXMnIiAlICh1c2VyX25hbWUsIGNsaWVudF9yZWRpcmVjdF91cmksIGF1dGh
 fbWV0aG9kKQ0KICAgIA0KICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aW
 NhdGUgZm9yIHN0ZXAgMS4gYXV0aF9tZXRob2Q6ICclcyciICUgYXV0aF9tZXRob2QNCiAgICAgICAgI
 CAgICAgICANCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic3VwZXJfZ2x1dV9hdXRoX21ldGhv
 ZCIsIGF1dGhfbWV0aG9kKQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICA
 gICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsaWYgc3RlcCA9PSAyOg0KICAgICAgICAgICAgcHJpbn
 QgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgc2Vzc2lvb
 l9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCg0KICAgICAgICAg
 ICAgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzID0gc2VsZi5nZXRTZXNzaW9uRGV2aWNlU3RhdHVzKHNlc3N
 pb25fYXR0cmlidXRlcywgdXNlcl9uYW1lKQ0KICAgICAgICAgICAgaWYgc2Vzc2lvbl9kZXZpY2Vfc3
 RhdHVzID09IE5vbmU6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgI
 HUyZl9kZXZpY2VfaWQgPSBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ2RldmljZV9pZCddDQoNCiAgICAg
 ICAgICAgICMgVGhlcmUgYXJlIHR3byBzdGVwcyBvbmx5IGluIGVucm9sbG1lbnQgbW9kZQ0KICAgICA
 gICAgICAgaWYgc2VsZi5vbmVTdGVwIGFuZCBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ2Vucm9sbCddOg
 0KICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlciA9IHNlbGYucHJvY2Vzc0Jhc2ljQXV0a
 GVudGljYXRpb24oY3JlZGVudGlhbHMpDQogICAgICAgICAgICAgICAgaWYgYXV0aGVudGljYXRlZF91
 c2VyID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICA
 gICAgICAgdXNlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VXNlckludW0oYXV0aGVudGljYXRlZF91c2
 VyKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGF0dGFjaF9yZXN1bHQgPSBkZXZpY
 2VSZWdpc3RyYXRpb25TZXJ2aWNlLmF0dGFjaFVzZXJEZXZpY2VSZWdpc3RyYXRpb24odXNlcl9pbnVt
 LCB1MmZfZGV2aWNlX2lkKQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyLiBSZXN1bHQgYWZ0ZXIgYXR0YWNoaW5nIHUyZl9kZXZpY2UgJyVzJy
 B0byB1c2VyICclcyc6ICclcyciICUgKHUyZl9kZXZpY2VfaWQsIHVzZXJfbmFtZSwgYXR0YWNoX3Jlc
 3VsdCkgDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gYXR0YWNoX3Jlc3VsdA0KICAgICAgICAgICAg
 ZWxpZiBzZWxmLnR3b1N0ZXA6DQogICAgICAgICAgICAgICAgaWYgdXNlcl9uYW1lID09IE5vbmU6DQo
 gICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZX
 AgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgICAgIHJld
 HVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBzZWxmLnZhbGlk
 YXRlU2Vzc2lvbkRldmljZVN0YXR1cyhjbGllbnRfcmVkaXJlY3RfdXJpLCBzZXNzaW9uX2RldmljZV9
 zdGF0dXMsIHVzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdDoNCi
 AgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3Rlc
 CAyLiBVc2VyICclcycgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQgd2l0aCB1MmZfZGV2aWNlICcl
 cyciICUgKHVzZXJfbmFtZSwgdTJmX2RldmljZV9pZCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICA
 gICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICAgICANCiAgICAgICAgIC
 AgICAgICBzdXBlcl9nbHV1X3JlcXVlc3QgPSBqc29uLmxvYWRzKHNlc3Npb25fZGV2aWNlX3N0YXR1c
 1snc3VwZXJfZ2x1dV9yZXF1ZXN0J10pDQogICAgICAgICAgICAgICAgYXV0aF9tZXRob2QgPSBzdXBl
 cl9nbHV1X3JlcXVlc3RbJ21ldGhvZCddDQogICAgICAgICAgICAgICAgaWYgYXV0aF9tZXRob2QgaW4
 gWydlbnJvbGwnLCAnYXV0aGVudGljYXRlJ106DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YW
 xpZGF0aW9uX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlb
 nRpY2F0ZSBmb3Igc3RlcCAyLiBVMkYgYXV0aF9tZXRob2QgaXMgaW52YWxpZCINCg0KICAgICAgICAg
 ICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0
 KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdW
 VzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb
 250ZXh0KCkNCiAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25B
 dHRyaWJ1dGVzIikNCg0KICAgICAgICBjbGllbnRfcmVkaXJlY3RfdXJpID0gc2VsZi5nZXRDbGllbnR
 SZWRpcmVjVXJpKHNlc3Npb25fYXR0cmlidXRlcykNCiAgICAgICAgaWYgY2xpZW50X3JlZGlyZWN0X3
 VyaSA9PSBOb25lOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0Z
 XAuIHJlZGlyZWN0X3VyaSBpcyBub3Qgc2V0Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAg
 ICAgICAgc2VsZi5zZXRFdmVudENvbnRleHRQYXJhbWV0ZXJzKGNvbnRleHQpDQoNCiAgICAgICAgaWY
 gc3RlcCA9PSAxOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZX
 AgMSINCiAgICAgICAgICAgIGlmIHNlbGYub25lU3RlcDoNCiAgICAgICAgICAgICAgICBzZXNzaW9uX
 3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb25TdGF0ZUZyb21D
 b29raWUoKQ0KICAgICAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5KHNlc3Npb25fc3R
 hdGUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3
 RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICAgICAgICAgICAgI
 CAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaXNzdWVyID0gQ29u
 ZmlndXJhdGlvbkZhY3RvcnkuaW5zdGFuY2UoKS5nZXRDb25maWd1cmF0aW9uKCkuZ2V0SXNzdWVyKCk
 NCiAgICAgICAgICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSA9IHsnYXBwJzogY2
 xpZW50X3JlZGlyZWN0X3VyaSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzc
 3Vlcic6IGlzc3VlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXRlJzog
 c2Vzc2lvbl9zdGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWQ
 nOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKX0NCg0KICAgICAgICAgICAgICAgIH
 NlbGYuYWRkR2VvbG9jYXRpb25EYXRhKHNlc3Npb25fYXR0cmlidXRlcywgc3VwZXJfZ2x1dV9yZXF1Z
 XN0X2RpY3Rpb25hcnkpDQoNCiAgICAgICAgICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3QgPSBqc29u
 LmR1bXBzKHN1cGVyX2dsdXVfcmVxdWVzdF9kaWN0aW9uYXJ5LCBzZXBhcmF0b3JzPSgnLCcsJzonKSk
 NCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAxLiBQcm
 VwYXJlZCBzdXBlcl9nbHV1X3JlcXVlc3Q6Iiwgc3VwZXJfZ2x1dV9yZXF1ZXN0DQogICAgDQogICAgI
 CAgICAgICAgICAgY29udGV4dC5zZXQoInN1cGVyX2dsdXVfcmVxdWVzdCIsIHN1cGVyX2dsdXVfcmVx
 dWVzdCkNCiMgICAgICAgICAgICBlbGlmIHNlbGYudHdvU3RlcDoNCiMgICAgICAgICAgICAgICAgY29
 udGV4dC5zZXQoImRpc3BsYXlfcmVnaXN0ZXJfYWN0aW9uIiwgVHJ1ZSkNCg0KICAgICAgICAgICAgcm
 V0dXJuIFRydWUNCiAgICAgICAgZWxpZiBzdGVwID09IDI6DQogICAgICAgICAgICBwcmludCAiU3VwZ
 XItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgaWYgc2VsZi5vbmVTdGVwOg0K
 ICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWR
 lbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyID0gY3JlZG
 VudGlhbHMuZ2V0VXNlcigpDQogICAgICAgICAgICBpZiB1c2VyID09IE5vbmU6DQogICAgICAgICAgI
 CAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVy
 bWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICA
 gIGlmIHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgic3VwZXJfZ2x1dV9yZXF1ZXN0Iik6DQ
 ogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZXAgMi4gUmVxd
 WVzdCB3YXMgZ2VuZXJhdGVkIGFscmVhZHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAg
 ICAgICAgICAgIA0KICAgICAgICAgICAgc2Vzc2lvbl9zdGF0ZSA9IFNlc3Npb25TdGF0ZVNlcnZpY2U
 uaW5zdGFuY2UoKS5nZXRTZXNzaW9uU3RhdGVGcm9tQ29va2llKCkNCiAgICAgICAgICAgIGlmIFN0cm
 luZ0hlbHBlci5pc0VtcHR5KHNlc3Npb25fc3RhdGUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTd
 XBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlcm1pbmUgc2Vzc2lvbl9z
 dGF0ZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgYXV0aF9tZXR
 ob2QgPSBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJzdXBlcl9nbHV1X2F1dGhfbWV0aG9kIikNCiAgIC
 AgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5KGF1dGhfbWV0aG9kKToNCiAgICAgICAgICAgI
 CAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJt
 aW5lIGF1dGhfbWV0aG9kIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICA
 gICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBhdXRoX21ldGhvZDogJyVzJy
 IgJSBhdXRoX21ldGhvZA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpc3N1ZXIgPSBDb25maWd1c
 mF0aW9uRmFjdG9yeS5pbnN0YW5jZSgpLmdldENvbmZpZ3VyYXRpb24oKS5nZXRJc3N1ZXIoKQ0KICAg
 ICAgICAgICAgc3VwZXJfZ2x1dV9yZXF1ZXN0X2RpY3Rpb25hcnkgPSB7J3VzZXJuYW1lJzogdXNlci5
 nZXRVc2VySWQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnYXBwJzogY2xpZW50X3
 JlZGlyZWN0X3VyaSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaXNzdWVyJzogaXNzd
 WVyLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtZXRob2QnOiBhdXRoX21ldGhvZCwN
 CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc3RhdGUnOiBzZXNzaW9uX3N0YXRlLA0KICA
 gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdjcmVhdGVkJzogZGF0ZXRpbWUuZGF0ZXRpbWUubm
 93KCkuaXNvZm9ybWF0KCl9DQoNCiAgICAgICAgICAgIHNlbGYuYWRkR2VvbG9jYXRpb25EYXRhKHNlc
 3Npb25fYXR0cmlidXRlcywgc3VwZXJfZ2x1dV9yZXF1ZXN0X2RpY3Rpb25hcnkpDQoNCiAgICAgICAg
 ICAgIHN1cGVyX2dsdXVfcmVxdWVzdCA9IGpzb24uZHVtcHMoc3VwZXJfZ2x1dV9yZXF1ZXN0X2RpY3R
 pb25hcnksIHNlcGFyYXRvcnM9KCcsJywnOicpKQ0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdX
 UuIFByZXBhcmUgZm9yIHN0ZXAgMi4gUHJlcGFyZWQgc3VwZXJfZ2x1dV9yZXF1ZXN0OiIsIHN1cGVyX
 2dsdXVfcmVxdWVzdA0KDQogICAgICAgICAgICBjb250ZXh0LnNldCgic3VwZXJfZ2x1dV9yZXF1ZXN0
 Iiwgc3VwZXJfZ2x1dV9yZXF1ZXN0KQ0KDQogICAgICAgICAgICBpZiBhdXRoX21ldGhvZCBpbiBbJ2F
 1dGhlbnRpY2F0ZSddOg0KICAgICAgICAgICAgICAgIHNlbGYuc2VuZFB1c2hOb3RpZmljYXRpb24oY2
 xpZW50X3JlZGlyZWN0X3VyaSwgdXNlciwgc3VwZXJfZ2x1dV9yZXF1ZXN0KQ0KDQogICAgICAgICAgI
 CByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAg
 ICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXR
 lcywgc3RlcCk6DQogICAgICAgIGlmIHN0ZXAgPT0gMToNCiAgICAgICAgICAgIGlmIHNlbGYub25lU3
 RlcDogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJzdXBlcl9nb
 HV1X3JlcXVlc3QiKQ0KICAgICAgICAgICAgZWxpZiBzZWxmLnR3b1N0ZXA6DQogICAgICAgICAgICAg
 ICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoImRpc3BsYXlfcmVnaXN0ZXJfYWN0aW9uIikNCiAgICAgICA
 gZWxpZiBzdGVwID09IDI6DQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgic3VwZXJfZ2
 x1dV9hdXRoX21ldGhvZCIsICJzdXBlcl9nbHV1X3JlcXVlc3QiKQ0KICAgICAgICANCiAgICAgICAgc
 mV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29u
 ZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnR
 Db250ZXh0KCkNCiAgICAgICAgaWYgY29udGV4dC5pc1NldCgic3VwZXJfZ2x1dV9jb3VudF9sb2dpbl
 9zdGVwcyIpOg0KICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ2V0KCJzdXBlcl9nbHV1X2NvdW50X
 2xvZ2luX3N0ZXBzIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiAyDQoNCiAgICBk
 ZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICA
 gICAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgICBpZiBzZWxmLm9uZVN0ZXA6ICAgICAgICANCi
 AgICAgICAgICAgICAgICByZXR1cm4gIi9hdXRoL3N1cGVyLWdsdXUvbG9naW4ueGh0bWwiDQogICAgI
 CAgIGVsaWYgc3RlcCA9PSAyOg0KICAgICAgICAgICAgaWYgc2VsZi5vbmVTdGVwOg0KICAgICAgICAg
 ICAgICAgIHJldHVybiAiL2xvZ2luLnhodG1sIg0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICA
 gICAgICByZXR1cm4gIi9hdXRoL3N1cGVyLWdsdXUvbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dX
 JuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1Z
 XN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgcHJvY2Vzc0Jhc2lj
 QXV0aGVudGljYXRpb24oc2VsZiwgY3JlZGVudGlhbHMpOg0KICAgICAgICB1c2VyU2VydmljZSA9IFV
 zZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZX
 RVc2VybmFtZSgpDQogICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZ
 CgpDQoNCiAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlz
 Tm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmc
 odXNlcl9wYXNzd29yZCk6DQogICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW
 50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgIGlmIG5vdCBsb2dnZWRfa
 W46DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1
 c2VyU2VydmljZS5nZXRVc2VyKHVzZXJfbmFtZSkNCiAgICAgICAgaWYgZmluZF91c2VyX2J5X3VpZCA
 9PSBOb25lOg0KICAgICAgICAgICAgcHJpbnQgIm94UHVzaC4gUHJvY2VzcyBiYXNpYyBhdXRoZW50aW
 NhdGlvbi4gRmFpbGVkIHRvIGZpbmQgdXNlciAnJXMnIiAlIHVzZXJfbmFtZQ0KICAgICAgICAgICAgc
 mV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiBmaW5kX3VzZXJfYnlfdWlkDQoNCiAg
 ICBkZWYgdmFsaWRhdGVTZXNzaW9uRGV2aWNlU3RhdHVzKHNlbGYsIGNsaWVudF9yZWRpcmVjdF91cmk
 sIHNlc3Npb25fZGV2aWNlX3N0YXR1cywgdXNlcl9uYW1lID0gTm9uZSk6DQogICAgICAgIHVzZXJTZX
 J2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb25TZ
 XJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgdTJm
 X2RldmljZV9pZCA9IHNlc3Npb25fZGV2aWNlX3N0YXR1c1snZGV2aWNlX2lkJ10NCg0KICAgICAgICB
 1MmZfZGV2aWNlID0gTm9uZQ0KICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ2Vucm9sbC
 ddIGFuZCBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ29uZV9zdGVwJ106DQogICAgICAgICAgICB1MmZfZ
 GV2aWNlID0gZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5maW5kT25lU3RlcFVzZXJEZXZpY2VSZWdp
 c3RyYXRpb24odTJmX2RldmljZV9pZCkNCiAgICAgICAgICAgIGlmIHUyZl9kZXZpY2UgPT0gTm9uZTo
 NCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gVmFsaWRhdGUgc2Vzc2lvbiBkZXZpY2
 Ugc3RhdHVzLiBUaGVyZSBpcyBubyBvbmUgc3RlcCB1MmZfZGV2aWNlICclcyciICUgdTJmX2RldmljZ
 V9pZA0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAg
 ICAgIyBWYWxpZGF0ZSBpZiB1c2VyIGhhcyBzcGVjaWZpZWQgZGV2aWNlX2lkIGVucm9sbG1lbnQNCiA
 gICAgICAgICAgIHVzZXJfaW51bSA9IHVzZXJTZXJ2aWNlLmdldFVzZXJJbnVtKHVzZXJfbmFtZSkNCg
 0KICAgICAgICAgICAgaWYgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydvbmVfc3RlcCddOg0KICAgICAgI
 CAgICAgICAgIHVzZXJfaW51bSA9IHNlc3Npb25fZGV2aWNlX3N0YXR1c1sndXNlcl9pbnVtJ10NCiAg
 ICANCiAgICAgICAgICAgIHUyZl9kZXZpY2UgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmR
 Vc2VyRGV2aWNlUmVnaXN0cmF0aW9uKHVzZXJfaW51bSwgdTJmX2RldmljZV9pZCkNCiAgICAgICAgIC
 AgIGlmIHUyZl9kZXZpY2UgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1d
 S4gVmFsaWRhdGUgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyB1MmZfZGV2aWNlICcl
 cycgYXNzb2NpYXRlZCB3aXRoIHVzZXIgJyVzJyIgJSAodTJmX2RldmljZV9pZCwgdXNlcl9pbnVtKQ0
 KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIGlmIG5vdCBTdHJpbmdIZWxwZX
 IuZXF1YWxzSWdub3JlQ2FzZShjbGllbnRfcmVkaXJlY3RfdXJpLCB1MmZfZGV2aWNlLmFwcGxpY2F0a
 W9uKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBWYWxpZGF0ZSBzZXNzaW9uIGRldmlj
 ZSBzdGF0dXMuIHUyZl9kZXZpY2UgJyVzJyBhc3NvY2lhdGVkIHdpdGggb3RoZXIgYXBwbGljYXRpb24
 gJyVzJyIgJSAodTJmX2RldmljZV9pZCwgdTJmX2RldmljZS5hcHBsaWNhdGlvbikNCiAgICAgICAgIC
 AgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZ
 XRTZXNzaW9uRGV2aWNlU3RhdHVzKHNlbGYsIHNlc3Npb25fYXR0cmlidXRlcywgdXNlcl9uYW1lKToN
 CiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEdldCBzZXNzaW9uIGRldmljZSBzdGF0dXMiDQoNCiA
 gICAgICAgaWYgbm90IHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgic3VwZXJfZ2x1dV9yZX
 F1ZXN0Iik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gR2V0IHNlc3Npb24gZGV2aWNlI
 HN0YXR1cy4gVGhlcmUgaXMgbm8gU3VwZXItR2x1dSByZXF1ZXN0IGluIHNlc3Npb24gYXR0cmlidXRl
 cyINCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgIyBDaGVjayBzZXNzaW9uIHN0YXR
 lIGV4dGVuZGVkDQogICAgICAgIGlmIG5vdCBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoIn
 Nlc3Npb25fY3VzdG9tX3N0YXRlIik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gR2V0I
 HNlc3Npb24gZGV2aWNlIHN0YXR1cy4gVGhlcmUgaXMgbm8gc2Vzc2lvbl9jdXN0b21fc3RhdGUgaW4g
 c2Vzc2lvbiBhdHRyaWJ1dGVzIg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICBzZXN
 zaW9uX2N1c3RvbV9zdGF0ZSA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoInNlc3Npb25fY3VzdG9tX3
 N0YXRlIikNCiAgICAgICAgaWYgbm90IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKCJhcHByb
 3ZlZCIsIHNlc3Npb25fY3VzdG9tX3N0YXRlKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1
 LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBVc2VyICclcycgbm90IGFwcHJvdmUgb3Igbm90IHB
 hc3MgVTJGIGF1dGhlbnRpY2F0aW9uLiBzZXNzaW9uX2N1c3RvbV9zdGF0ZTogJyVzJyIgJSAodXNlcl
 9uYW1lLCBzZXNzaW9uX2N1c3RvbV9zdGF0ZSkNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgI
 CAgICAgIyBUcnkgdG8gZmluZCBkZXZpY2VfaWQgaW4gc2Vzc2lvbiBhdHRyaWJ1dGUNCiAgICAgICAg
 aWYgbm90IHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgib3hwdXNoMl91MmZfZGV2aWNlX2l
 kIik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gR2V0IHNlc3Npb24gZGV2aWNlIHN0YX
 R1cy4gVGhlcmUgaXMgbm8gdTJmX2RldmljZSBhc3NvY2lhdGVkIHdpdGggdGhpcyByZXF1ZXN0Ig0KI
 CAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAjIFRyeSB0byBmaW5kIHVzZXJfaW51bSBp
 biBzZXNzaW9uIGF0dHJpYnV0ZQ0KICAgICAgICBpZiBub3Qgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnR
 haW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2VfdXNlcl9pbnVtIik6DQogICAgICAgICAgICBwcmludC
 AiU3VwZXItR2x1dS4gR2V0IHNlc3Npb24gZGV2aWNlIHN0YXR1cy4gVGhlcmUgaXMgbm8gdXNlcl9pb
 nVtIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJlcXVlc3QiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0K
 ICAgICAgICANCiAgICAgICAgZW5yb2xsID0gRmFsc2UNCiAgICAgICAgaWYgc2Vzc2lvbl9hdHRyaWJ
 1dGVzLmNvbnRhaW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2VfZW5yb2xsIik6DQogICAgICAgICAgIC
 BlbnJvbGwgPSBTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZSgidHJ1ZSIsIHNlc3Npb25fYXR0c
 mlidXRlcy5nZXQoIm94cHVzaDJfdTJmX2RldmljZV9lbnJvbGwiKSkNCg0KICAgICAgICBvbmVfc3Rl
 cCA9IEZhbHNlDQogICAgICAgIGlmIHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgib3hwdXN
 oMl91MmZfZGV2aWNlX29uZV9zdGVwIik6DQogICAgICAgICAgICBvbmVfc3RlcCA9IFN0cmluZ0hlbH
 Blci5lcXVhbHNJZ25vcmVDYXNlKCJ0cnVlIiwgc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNoM
 l91MmZfZGV2aWNlX29uZV9zdGVwIikpDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAg
 c3VwZXJfZ2x1dV9yZXF1ZXN0ID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgic3VwZXJfZ2x1dV9yZXF
 1ZXN0IikNCiAgICAgICAgdTJmX2RldmljZV9pZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoIm94cH
 VzaDJfdTJmX2RldmljZV9pZCIpDQogICAgICAgIHVzZXJfaW51bSA9IHNlc3Npb25fYXR0cmlidXRlc
 y5nZXQoIm94cHVzaDJfdTJmX2RldmljZV91c2VyX2ludW0iKQ0KDQogICAgICAgIHNlc3Npb25fZGV2
 aWNlX3N0YXR1cyA9IHsic3VwZXJfZ2x1dV9yZXF1ZXN0Ijogc3VwZXJfZ2x1dV9yZXF1ZXN0LCAiZGV
 2aWNlX2lkIjogdTJmX2RldmljZV9pZCwgInVzZXJfaW51bSIgOiB1c2VyX2ludW0sICJlbnJvbGwiID
 ogZW5yb2xsLCAib25lX3N0ZXAiIDogb25lX3N0ZXB9DQogICAgICAgIHByaW50ICJTdXBlci1HbHV1L
 iBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBzZXNzaW9uX2RldmljZV9zdGF0dXM6ICclcyciICUg
 KHNlc3Npb25fZGV2aWNlX3N0YXR1cykNCiAgICAgICAgDQogICAgICAgIHJldHVybiBzZXNzaW9uX2R
 ldmljZV9zdGF0dXMNCg0KICAgIGRlZiBpbml0UHVzaE5vdGlmaWNhdGlvblNlcnZpY2Uoc2VsZiwgY2
 9uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5pdGlhb
 Gl6ZSBub3RpZmljYXRpb24gc2VydmljZXMiDQogICAgICAgIGlmIG5vdCBjb25maWd1cmF0aW9uQXR0
 cmlidXRlcy5jb250YWluc0tleSgiY3JlZGVudGlhbHNfZmlsZSIpOg0KICAgICAgICAgICAgcmV0dXJ
 uIEZhbHNlDQoNCiAgICAgICAgc3VwZXJfZ2x1dV9jcmVkc19maWxlID0gY29uZmlndXJhdGlvbkF0dH
 JpYnV0ZXMuZ2V0KCJjcmVkZW50aWFsc19maWxlIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICAjIExvY
 WQgY3JlZGVudGlhbHMgZnJvbSBmaWxlDQogICAgICAgIGYgPSBvcGVuKHN1cGVyX2dsdXVfY3JlZHNf
 ZmlsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZHMoZi5
 yZWFkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbm
 l0aWFsaXplIG5vdGlmaWNhdGlvbiBzZXJ2aWNlcy4gRmFpbGVkIHRvIGxvYWQgY3JlZGVudGlhbHMgZ
 nJvbSBmaWxlOiIsIHN1cGVyX2dsdXVfY3JlZHNfZmlsZQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNl
 DQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBmLmNsb3NlKCkNCiAgICAgICAgDQogICAgICA
 gIHRyeToNCiAgICAgICAgICAgIGFuZHJvaWRfY3JlZHMgPSBjcmVkc1siYW5kcm9pZCJdWyJnY20iXQ
 0KICAgICAgICAgICAgaW9zX2NyZWFkcyA9IGNyZWRzWyJpb3MiXVsiYXBucyJdDQogICAgICAgIGV4Y
 2VwdDoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXplIG5vdGlmaWNhdGlv
 biBzZXJ2aWNlcy4gSW52YWxpZCBjcmVkZW50aWFscyBmaWxlICclcycgZm9ybWF0OiIgJSBzdXBlcl9
 nbHV1X2NyZWRzX2ZpbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgIC
 Agc2VsZi5wdXNoQW5kcm9pZFNlcnZpY2UgPSBOb25lDQogICAgICAgIHNlbGYucHVzaEFwcGxlU2Vyd
 mljZSA9IE5vbmUNCiAgICAgICAgaWYgYW5kcm9pZF9jcmVkc1siZW5hYmxlZCJdOg0KICAgICAgICAg
 ICAgc2VsZi5wdXNoQW5kcm9pZFNlcnZpY2UgPSBTZW5kZXIoYW5kcm9pZF9jcmVkc1siYXBpX2tleSJ
 dKSANCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXplIG5vdGlmaWNhdGlvbi
 BzZXJ2aWNlcy4gQ3JlYXRlZCBBbmRyb2lkIG5vdGlmaWNhdGlvbiBzZXJ2aWNlIg0KICAgICAgICAgI
 CAgDQogICAgICAgIGlmIGlvc19jcmVhZHNbImVuYWJsZWQiXToNCiAgICAgICAgICAgIHAxMl9maWxl
 X3BhdGggPSBpb3NfY3JlYWRzWyJwMTJfZmlsZV9wYXRoIl0NCiAgICAgICAgICAgIHAxMl9wYXNzb3d
 yZCA9IGlvc19jcmVhZHNbInAxMl9wYXNzd29yZCJdDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgIC
 AgICAgICAgICBzdHJpbmdFbmNyeXB0ZXIgPSBTdHJpbmdFbmNyeXB0ZXIuZGVmYXVsdEluc3RhbmNlK
 CkNCiAgICAgICAgICAgICAgICBwMTJfcGFzc293cmQgPSBzdHJpbmdFbmNyeXB0ZXIuZGVjcnlwdChw
 MTJfcGFzc293cmQpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgIyBJZ25vcmU
 gZXhjZXB0aW9uLiBQYXNzd29yZCBpcyBub3QgZW5jcnlwdGVkDQogICAgICAgICAgICAgICAgcHJpbn
 QgIlN1cGVyLUdsdXUuIEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBBc3N1bWluZyB0a
 GF0ICdwMTJfcGFzc293cmQnIHBhc3N3b3JkIGluIG5vdCBlbmNyeXB0ZWQiDQoNCiAgICAgICAgICAg
 IGFwbnNTZXJ2aWNlQnVpbGRlciA9ICBBUE5TLm5ld1NlcnZpY2UoKS53aXRoQ2VydChwMTJfZmlsZV9
 wYXRoLCBwMTJfcGFzc293cmQpDQogICAgICAgICAgICBpZiBpb3NfY3JlYWRzWyJwcm9kdWN0aW9uIl
 06DQogICAgICAgICAgICAgICAgc2VsZi5wdXNoQXBwbGVTZXJ2aWNlID0gYXBuc1NlcnZpY2VCdWlsZ
 GVyLndpdGhQcm9kdWN0aW9uRGVzdGluYXRpb24oKS5idWlsZCgpDQogICAgICAgICAgICBlbHNlOg0K
 ICAgICAgICAgICAgICAgIHNlbGYucHVzaEFwcGxlU2VydmljZSA9IGFwbnNTZXJ2aWNlQnVpbGRlci5
 3aXRoU2FuZGJveERlc3RpbmF0aW9uKCkuYnVpbGQoKQ0KDQogICAgICAgICAgICBwcmludCAiU3VwZX
 ItR2x1dS4gSW5pdGlhbGl6ZSBub3RpZmljYXRpb24gc2VydmljZXMuIENyZWF0ZWQgaU9TIG5vdGlma
 WNhdGlvbiBzZXJ2aWNlIg0KDQogICAgICAgIGVuYWJsZWQgPSBzZWxmLnB1c2hBbmRyb2lkU2Vydmlj
 ZSAhPSBOb25lIG9yIHNlbGYucHVzaEFwcGxlU2VydmljZSAhPSBOb25lDQoNCiAgICAgICAgcmV0dXJ
 uIGVuYWJsZWQNCg0KICAgIGRlZiBzZW5kUHVzaE5vdGlmaWNhdGlvbihzZWxmLCBjbGllbnRfcmVkaX
 JlY3RfdXJpLCB1c2VyLCBzdXBlcl9nbHV1X3JlcXVlc3QpOg0KICAgICAgICBpZiBub3Qgc2VsZi5lb
 mFibGVkUHVzaE5vdGlmaWNhdGlvbnM6DQogICAgICAgICAgICByZXR1cm4NCg0KICAgICAgICB1c2Vy
 X25hbWUgPSB1c2VyLmdldFVzZXJJZCgpDQogICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBTZW5kIHB
 1c2ggbm90aWZpY2F0aW9uLiBMb2FkaW5nIHVzZXIgJyVzJyBkZXZpY2VzIiAlIHVzZXJfbmFtZQ0KDQ
 ogICAgICAgIHNlbmRfbm90aWZpY2F0aW9uID0gRmFsc2UNCiAgICAgICAgc2VuZF9ub3RpZmljYXRpb
 25fcmVzdWx0ID0gVHJ1ZQ0KDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFu
 Y2UoKQ0KICAgICAgICBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlID0gRGV2aWNlUmVnaXN0cmF0aW9
 uU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgdXNlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VX
 NlckludW0odXNlcl9uYW1lKQ0KDQogICAgICAgIHUyZl9kZXZpY2VzX2xpc3QgPSBkZXZpY2VSZWdpc
 3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyRGV2aWNlUmVnaXN0cmF0aW9ucyh1c2VyX2ludW0sIGNsaWVu
 dF9yZWRpcmVjdF91cmksICJveElkIiwgIm94RGV2aWNlRGF0YSIpDQogICAgICAgIGlmIHUyZl9kZXZ
 pY2VzX2xpc3Quc2l6ZSgpID4gMDoNCiAgICAgICAgICAgIGZvciB1MmZfZGV2aWNlIGluIHUyZl9kZX
 ZpY2VzX2xpc3Q6DQogICAgICAgICAgICAgICAgZGV2aWNlX2RhdGEgPSB1MmZfZGV2aWNlLmdldERld
 mljZURhdGEoKQ0KDQogICAgICAgICAgICAgICAgIyBEZXZpY2UgZGF0YSB3aGljaCBTdXBlci1HbHV1
 IGdldHMgZHVyaW5nIGVucm9sbG1lbnQNCiAgICAgICAgICAgICAgICBpZiBkZXZpY2VfZGF0YSA9PSB
 Ob25lOg0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgICAgICAgICAgcGxhdG
 Zvcm0gPSBkZXZpY2VfZGF0YS5nZXRQbGF0Zm9ybSgpDQogICAgICAgICAgICAgICAgcHVzaF90b2tlb
 iA9IGRldmljZV9kYXRhLmdldFB1c2hUb2tlbigpDQogICAgICAgICAgICAgICAgZGVidWcgPSBGYWxz
 ZQ0KDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UocGxhdGZ
 vcm0sICJpb3MiKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHkocHVzaF90b2tlbik6DQogICAgIC
 AgICAgICAgICAgICAgICMgU2VuZGluZyBub3RpZmljYXRpb24gdG8gaU9TIHVzZXIncyBkZXZpY2UNC
 iAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5wdXNoQXBwbGVTZXJ2aWNlID09IE5vbmU6DQogICAg
 ICAgICAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gU2VuZCBwdXNoIG5vdGlmaWNhdGl
 vbi4gQXBwbGUgcHVzaCBub3RpZmljYXRpb24gc2VydmljZSBpcyBub3QgZW5hYmxlZCINCiAgICAgIC
 AgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfbm90aWZpY2F0a
 W9uID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAg
 ICB0aXRsZSA9ICJTdXBlci1HbHV1Ig0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9ICJ
 TdXBlci1HbHV1IGxvZ2luIHJlcXVlc3QgdG86ICVzIiAlIGNsaWVudF9yZWRpcmVjdF91cmkNCg0KIC
 AgICAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbF9maWVsZHMgPSB7ICJyZXF1ZXN0IiA6IHN1c
 GVyX2dsdXVfcmVxdWVzdCB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0J1aWxkZXIgPSBB
 UE5TLm5ld1BheWxvYWQoKS5hbGVydEJvZHkobWVzc2FnZSkuYWxlcnRUaXRsZSh0aXRsZSkuc291bmQ
 oImRlZmF1bHQiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbXNnQnVpbGRlci5jYXRlZ29yeSgnQU
 NUSU9OQUJMRScpLmJhZGdlKDApDQogICAgICAgICAgICAgICAgICAgICAgICBtc2dCdWlsZGVyLmZvc
 k5ld3NzdGFuZCgpDQogICAgICAgICAgICAgICAgICAgICAgICBtc2dCdWlsZGVyLmN1c3RvbUZpZWxk
 cyhhZGRpdGlvbmFsX2ZpZWxkcykNCiAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hfbWVzc2FnZSA
 9IG1zZ0J1aWxkZXIuYnVpbGQoKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kX25vdGlmaW
 NhdGlvbl9yZXN1bHQgPSBzZWxmLnB1c2hBcHBsZVNlcnZpY2UucHVzaChwdXNoX3Rva2VuLCBwdXNoX
 21lc3NhZ2UpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1ZzoNCiAgICAgICAgICAgICAg
 ICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gU2VuZCBpT1MgcHVzaCBub3RpZmljYXRpb24
 uIHRva2VuOiAnJXMnLCBtZXNzYWdlOiAnJXMnLCBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQ6ICclcy
 ciICUgKHB1c2hfdG9rZW4sIHB1c2hfbWVzc2FnZSwgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0KQ0KD
 QogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UocGxhdGZvcm0s
 ICJhbmRyb2lkIikgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHB1c2hfdG9rZW4pOg0KICAgICA
 gICAgICAgICAgICAgICAjIFNlbmRpbmcgbm90aWZpY2F0aW9uIHRvIEFuZHJvaWQgdXNlcidzIGRldm
 ljZQ0KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnB1c2hBbmRyb2lkU2VydmljZSA9PSBOb25lO
 g0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFNlbmQgcHVzaCBub3Rp
 ZmljYXRpb24uIEFuZHJvaWQgcHVzaCBub3RpZmljYXRpb24gc2VydmljZSBpcyBub3QgZW5hYmxlZCI
 NCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfbm
 90aWZpY2F0aW9uID0gVHJ1ZQ0KDQogICAgICAgICAgICAgICAgICAgICAgICB0aXRsZSA9ICJTdXBlc
 i1HbHV1Ig0KICAgICAgICAgICAgICAgICAgICAgICAgbXNnQnVpbGRlciA9IE1lc3NhZ2UuQnVpbGRl
 cigpLmFkZERhdGEoIm1lc3NhZ2UiLCBzdXBlcl9nbHV1X3JlcXVlc3QpLmFkZERhdGEoInRpdGxlIiw
 gdGl0bGUpLmNvbGxhcHNlS2V5KCJzaW5nbGUiKS5jb250ZW50QXZhaWxhYmxlKFRydWUpDQogICAgIC
 AgICAgICAgICAgICAgICAgICBwdXNoX21lc3NhZ2UgPSBtc2dCdWlsZGVyLmJ1aWxkKCkNCg0KICAgI
 CAgICAgICAgICAgICAgICAgICAgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0ID0gc2VsZi5wdXNoQW5k
 cm9pZFNlcnZpY2Uuc2VuZChwdXNoX21lc3NhZ2UsIHB1c2hfdG9rZW4sIDMpDQogICAgICAgICAgICA
 gICAgICAgICAgICBpZiBkZWJ1ZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiU3
 VwZXItR2x1dS4gU2VuZCBBbmRyb2lkIHB1c2ggbm90aWZpY2F0aW9uLiB0b2tlbjogJyVzJywgbWVzc
 2FnZTogJyVzJywgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0OiAnJXMnIiAlIChwdXNoX3Rva2VuLCBw
 dXNoX21lc3NhZ2UsIHNlbmRfbm90aWZpY2F0aW9uX3Jlc3VsdCkNCg0KDQogICAgICAgIHByaW50ICJ
 TdXBlci1HbHV1LiBTZW5kIHB1c2ggbm90aWZpY2F0aW9uLiBzZW5kX25vdGlmaWNhdGlvbjogJyVzJy
 wgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0OiAnJXMnIiAlIChzZW5kX25vdGlmaWNhdGlvbiwgc2VuZ
 F9ub3RpZmljYXRpb25fcmVzdWx0KQ0KDQogICAgZGVmIGdldENsaWVudFJlZGlyZWNVcmkoc2VsZiwg
 c2Vzc2lvbl9hdHRyaWJ1dGVzKToNCiAgICAgICAgaWYgbm90IHNlc3Npb25fYXR0cmlidXRlcy5jb25
 0YWluc0tleSgicmVkaXJlY3RfdXJpIik6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgIC
 AgIHJldHVybiBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJyZWRpcmVjdF91cmkiKQ0KDQogICAgZGVmI
 HNldEV2ZW50Q29udGV4dFBhcmFtZXRlcnMoc2VsZiwgY29udGV4dCk6DQogICAgICAgIGlmIHNlbGYu
 cmVnaXN0cmF0aW9uVXJpICE9IE5vbmU6DQogICAgICAgICAgICBjb250ZXh0LnNldCgiZXh0ZXJuYWx
 fcmVnaXN0cmF0aW9uX3VyaSIsIHNlbGYucmVnaXN0cmF0aW9uVXJpKQ0KDQogICAgICAgIGlmIHNlbG
 YuY3VzdG9tTGFiZWwgIT0gTm9uZToNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X
 2xhYmVsIiwgc2VsZi5jdXN0b21MYWJlbCkNCg0KICAgICAgICBjb250ZXh0LnNldCgic3VwZXJfZ2x1
 dV9xcl9vcHRpb25zIiwgc2VsZi5jdXN0b21Rck9wdGlvbnMpDQoNCiAgICBkZWYgYWRkR2VvbG9jYXR
 pb25EYXRhKHNlbGYsIHNlc3Npb25fYXR0cmlidXRlcywgc3VwZXJfZ2x1dV9yZXF1ZXN0X2RpY3Rpb2
 5hcnkpOg0KICAgICAgICBpZiBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoInJlbW90ZV9pc
 CIpOg0KICAgICAgICAgICAgcmVtb3RlX2lwID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgicmVtb3Rl
 X2lwIikNCiAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHJlbW90ZV9pcCk6DQo
 gICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZXAgMi4gQWRkaW
 5nIHJlcV9pcCBhbmQgcmVxX2xvYyB0byBzdXBlcl9nbHV1X3JlcXVlc3QiDQogICAgICAgICAgICAgI
 CAgc3VwZXJfZ2x1dV9yZXF1ZXN0X2RpY3Rpb25hcnlbJ3JlcV9pcCddID0gcmVtb3RlX2lwDQoNCiAg
 ICAgICAgICAgICAgICByZW1vdGVfbG9jX2RpYyA9IHNlbGYuZGV0ZXJtaW5lR2VvbG9jYXRpb25EYXR
 hKHJlbW90ZV9pcCkNCiAgICAgICAgICAgICAgICBpZiByZW1vdGVfbG9jX2RpYyA9PSBOb25lOg0KIC
 AgICAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGY
 WlsZWQgdG8gZGV0ZXJtaW5lIHJlbW90ZSBsb2NhdGlvbiBieSByZW1vdGUgSVAgJyVzJyIgJSByZW1v
 dGVfaXANCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgICAgICAgICByZW1vdGV
 fbG9jID0gIiVzLCAlcywgJXMiICUgKCByZW1vdGVfbG9jX2RpY1snY291bnRyeSddLCByZW1vdGVfbG
 9jX2RpY1sncmVnaW9uTmFtZSddLCByZW1vdGVfbG9jX2RpY1snY2l0eSddICkNCiAgICAgICAgICAgI
 CAgICByZW1vdGVfbG9jX2VuY29kZWQgPSB1cmxsaWIucXVvdGUocmVtb3RlX2xvYykNCiAgICAgICAg
 ICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeVsncmVxX2xvYyddID0gcmVtb3RlX2x
 vY19lbmNvZGVkDQoNCiAgICBkZWYgZGV0ZXJtaW5lR2VvbG9jYXRpb25EYXRhKHNlbGYsIHJlbW90ZV
 9pcCk6DQogICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXRlcm1pbmUgcmVtb3RlIGxvY2F0aW9uL
 iByZW1vdGVfaXA6ICclcyciICUgcmVtb3RlX2lwDQogICAgICAgIGh0dHBTZXJ2aWNlID0gSHR0cFNl
 cnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgIGh0dHBfY2xpZW50ID0gaHR0cFNlcnZpY2UuZ2V0SHR
 0cHNDbGllbnQoKQ0KICAgICAgICBodHRwX2NsaWVudF9wYXJhbXMgPSBodHRwX2NsaWVudC5nZXRQYX
 JhbXMoKQ0KICAgICAgICBodHRwX2NsaWVudF9wYXJhbXMuc2V0SW50UGFyYW1ldGVyKENvcmVDb25uZ
 WN0aW9uUE5hbWVzLkNPTk5FQ1RJT05fVElNRU9VVCwgMTUgKiAxMDAwKQ0KICAgICAgICANCiAgICAg
 ICAgZ2VvbG9jYXRpb25fc2VydmljZV91cmwgPSAiaHR0cDovL2lwLWFwaS5jb20vanNvbi8lcz9maWV
 sZHM9NDkxNzciICUgcmVtb3RlX2lwDQogICAgICAgIGdlb2xvY2F0aW9uX3NlcnZpY2VfaGVhZGVycy
 A9IHsgIkFjY2VwdCIgOiAiYXBwbGljYXRpb24vanNvbiIgfQ0KDQogICAgICAgIHRyeToNCiAgICAgI
 CAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4ZWN1dGVHZXQoaHR0cF9j
 bGllbnQsIGdlb2xvY2F0aW9uX3NlcnZpY2VfdXJsLCAgZ2VvbG9jYXRpb25fc2VydmljZV9oZWFkZXJ
 zKQ0KICAgICAgICAgICAgaHR0cF9yZXNwb25zZSA9IGh0dHBfc2VydmljZV9yZXNwb25zZS5nZXRIdH
 RwUmVzcG9uc2UoKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1d
 S4gRGV0ZXJtaW5lIHJlbW90ZSBsb2NhdGlvbi4gRXhjZXB0aW9uOiAiLCBzeXMuZXhjX2luZm8oKVsx
 XQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiB
 ub3QgaHR0cFNlcnZpY2UuaXNSZXNwb25zZVN0YXN0dXNDb2RlT2soaHR0cF9yZXNwb25zZSk6DQogIC
 AgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIERldGVybWluZSByZW1vdGUgbG9jYXRpb24uI
 EdldCBpbnZhbGlkIHJlc3BvbnNlIGZyb20gdmFsaWRhdGlvbiBzZXJ2ZXI6ICIsIHN0cihodHRwX3Jl
 c3BvbnNlLmdldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXNDb2RlKCkpDQogICAgICAgICAgICAgICAgaHR
 0cFNlcnZpY2UuY29uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBOb2
 5lDQogICAgDQogICAgICAgICAgICByZXNwb25zZV9ieXRlcyA9IGh0dHBTZXJ2aWNlLmdldFJlc3Bvb
 nNlQ29udGVudChodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgcmVzcG9uc2Vfc3RyaW5nID0gaHR0
 cFNlcnZpY2UuY29udmVydEVudGl0eVRvU3RyaW5nKHJlc3BvbnNlX2J5dGVzKQ0KICAgICAgICAgICA
 gaHR0cFNlcnZpY2UuY29uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICBmaW5hbGx5Og0KICAgIC
 AgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmNsb3NlQ29ubmVjdGlvbigpDQoNCiAgICAgICAga
 WYgcmVzcG9uc2Vfc3RyaW5nID09IE5vbmU6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4g
 RGV0ZXJtaW5lIHJlbW90ZSBsb2NhdGlvbi4gR2V0IGVtcHR5IHJlc3BvbnNlIGZyb20gbG9jYXRpb24
 gc2VydmVyIg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJlc3Bvbn
 NlID0ganNvbi5sb2FkcyhyZXNwb25zZV9zdHJpbmcpDQogICAgICAgIA0KICAgICAgICBpZiBub3QgU
 3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UocmVzcG9uc2VbJ3N0YXR1cyddLCAic3VjY2VzcyIp
 Og0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIERldGVybWluZSByZW1vdGUgbG9jYXRpb24
 uIEdldCByZXNwb25zZSB3aXRoIHN0YXR1czogJyVzJyIgJSByZXNwb25zZVsnc3RhdHVzJ10NCiAgIC
 AgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!5018.F9CF,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: DUO authentication module
displayName: duo
gluuStatus: false
inum: %(inumOrg)s!0011!5018.F9CF
oxConfigurationProperty: {"value1":"duo_creds_file","value2":"/etc/certs/duo
 _creds.json","description":""}
oxConfigurationProperty: {"value1":"duo_host","value2":"api-random.duosecuri
 ty.com","description":""}
oxLevel: 20
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29ud
 GV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9t
 IG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGh
 lbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2
 VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyR3JvdXBTZXJ2a
 WNlDQpmcm9tIG9yZy54ZGkuc2VydmljZSBpbXBvcnQgTWFpbFNlcnZpY2UNCmZyb20gb3JnLnhk
 aS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJ
 heUhlbHBlcg0KDQppbXBvcnQgamF2YQ0KaW1wb3J0IGR1b193ZWINCnRyeToNCiAgICBpbXBvcn
 QganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb
 24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBl
 KToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbm
 l0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR1by4gS
 W5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgZHVvX2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9u
 QXR0cmlidXRlcy5nZXQoImR1b19jcmVkc19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgIyB
 Mb2FkIGNyZWRlbnRpYWxzIGZyb20gZmlsZQ0KICAgICAgICBmID0gb3BlbihkdW9fY3JlZHNfZm
 lsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZHMoZ
 i5yZWFkKCkpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRp
 YWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBjcmVkcyBmcm9tIGZpbGU6IiwgZHVvX2NyZWRzX2Z
 pbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgIC
 AgICAgZi5jbG9zZSgpDQoNCiAgICAgICAgc2VsZi5pa2V5ID0gc3RyKGNyZWRzWyJpa2V5Il0pD
 QogICAgICAgIHNlbGYuc2tleSA9IHN0cihjcmVkc1sic2tleSJdKQ0KICAgICAgICBzZWxmLmFr
 ZXkgPSBzdHIoY3JlZHNbImFrZXkiXSkNCg0KICAgICAgICBzZWxmLnVzZV9kdW9fZ3JvdXAgPSB
 GYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm
 R1b19ncm91cCIpKToNCiAgICAgICAgICAgIHNlbGYuZHVvX2dyb3VwID0gY29uZmlndXJhdGlvb
 kF0dHJpYnV0ZXMuZ2V0KCJkdW9fZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2Vs
 Zi51c2VfZHVvX2dyb3VwID0gVHJ1ZQ0KICAgICAgICAgICAgcHJpbnQgIkR1by4gSW5pdGlhbGl
 6YXRpb24uIFVzaW5nIER1byBvbmx5IGlmIHVzZXIgYmVsb25nIHRvIGdyb3VwOiIsIHNlbGYuZH
 VvX2dyb3VwDQoNCiAgICAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBGYWxzZQ0KICAgICAgI
 CBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImF1ZGl0X2dyb3VwIikp
 Og0KICAgICAgICAgICAgc2VsZi5hdWRpdF9ncm91cCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGV
 zLmdldCgiYXVkaXRfZ3JvdXAiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICAgICBpZiAobm90IG
 NvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhdWRpdF9ncm91cF9lbWFpbCIpK
 ToNCiAgICAgICAgICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkg
 YXVkaXRfZ3JvdXBfZW1haWwgaXMgbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR
 1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdWRpdF9lbWFpbCA9IGNvbmZpZ3VyYXRpb2
 5BdHRyaWJ1dGVzLmdldCgiYXVkaXRfZ3JvdXBfZW1haWwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgI
 CAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBUcnVlDQoNCiAgICAgICAgICAgIHByaW50ICJE
 dW8uIEluaXRpYWxpemF0aW9uLiBVc2luZyBhdWRpdG8gZ3JvdXA6Iiwgc2VsZi5hdWRpdF9ncm9
 1cA0KICAgICAgICAgICAgDQogICAgICAgIGlmIChzZWxmLnVzZV9kdW9fZ3JvdXAgb3Igc2VsZi
 51c2VfYXVkaXRfZ3JvdXApOg0KICAgICAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0c
 mlidXRlcy5jb250YWluc0tleSgiYXVkaXRfYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgICAg
 IHByaW50ICJEdW8uIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBhdWRpdF9hdHRyaWJ1dGUgaXM
 gbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgIC
 AgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5hdWRpdF9hdHRyaWJ1dGUgPSBjb25maWd1c
 mF0aW9uQXR0cmlidXRlcy5nZXQoImF1ZGl0X2F0dHJpYnV0ZSIpLmdldFZhbHVlMigpDQoNCg0K
 ICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJ
 ldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcyk6DQogICAgICAgIHByaW50ICJEdW8uIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJEd
 W8uIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBk
 ZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1Z
 hbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpd
 mVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCi
 AgICAgICAgZHVvX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImR1b19ob3N0I
 ikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNl
 KCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXR
 Vc2VybmFtZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludC
 AiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgdXNlcl9wYXNzd
 29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9
 IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXN
 lcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZC
 kpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoK
 Q0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1
 c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2l
 uKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdXNlciA9IG
 NyZWRlbnRpYWxzLmdldFVzZXIoKQ0KICAgICAgICAgICAgaWYgKHNlbGYudXNlX2R1b19ncm91c
 Ck6DQogICAgICAgICAgICAgICAgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEu
 IENoZWNraW5nIGlmIHVzZXIgYmVsb25nIHRvIER1byBncm91cCINCiAgICAgICAgICAgICAgICB
 pc19tZW1iZXJfZHVvX2dyb3VwID0gc2VsZi5pc1VzZXJNZW1iZXJPZkdyb3VwKHVzZXIsIHNlbG
 YuYXVkaXRfYXR0cmlidXRlLCBzZWxmLmR1b19ncm91cCkNCiAgICAgICAgICAgICAgICBpZiAoa
 XNfbWVtYmVyX2R1b19ncm91cCk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2VyICciICsgdXNlci5nZXRVc2VySWQoKSArICInIG1
 lbWJlciBvZiBEdW8gZ3JvdXAiDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpbl
 9zdGVwcyA9IDINCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZ
 WxmLnByb2Nlc3NBdWRpdEdyb3VwKHVzZXIpDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3Vu
 dF9sb2dpbl9zdGVwcyA9IDENCg0KICAgICAgICAgICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5
 nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fY291bn
 RfbG9naW5fc3RlcHMiLCBkdW9fY291bnRfbG9naW5fc3RlcHMpDQoNCiAgICAgICAgICAgIHJld
 HVybiBUcnVlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAi
 RHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgc2lnX3Jlc3BvbnN
 lX2FycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJzaWdfcmVzcG9uc2UiKQ0KICAgICAgIC
 AgICAgaWYgQXJyYXlIZWxwZXIuaXNFbXB0eShzaWdfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgI
 CAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBzaWdfcmVzcG9u
 c2UgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICA
 gIGR1b19zaWdfcmVzcG9uc2UgPSBzaWdfcmVzcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgIC
 AgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVzcG9uc2U6I
 CIgKyBkdW9fc2lnX3Jlc3BvbnNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlcm5h
 bWUgPSBkdW9fd2ViLnZlcmlmeV9yZXNwb25zZShzZWxmLmlrZXksIHNlbGYuc2tleSwgc2VsZi5
 ha2V5LCBkdW9fc2lnX3Jlc3BvbnNlKQ0KDQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW
 50aWNhdGUgZm9yIHN0ZXAgMi4gYXV0aGVudGljYXRlZF91c2VybmFtZTogIiArIGF1dGhlbnRpY
 2F0ZWRfdXNlcm5hbWUgKyAiLCBleHBlY3RlZCB1c2VyX25hbWU6ICIgKyB1c2VyX25hbWUNCg0K
 ICAgICAgICAgICAgaWYgKG5vdCBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbmFtZSwgYXV0aGV
 udGljYXRlZF91c2VybmFtZSkpOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogIC
 AgICAgICAgICBzZWxmLnByb2Nlc3NBdWRpdEdyb3VwKGNyZWRlbnRpYWxzLmdldFVzZXIoKSkNC
 g0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJl
 dHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPS
 BDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KDQogICAgICAgIGR1b19ob3N0ID0gY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJkdW9faG9zdCIpLmdldFZhbHVlMigpDQoNCiAgICAgICAg
 Y3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICA
 gICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGlmIC
 hzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAxI
 g0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDIpOg0K
 ICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICA
 gICBkdW9fc2lnX3JlcXVlc3QgPSBkdW9fd2ViLnNpZ25fcmVxdWVzdChzZWxmLmlrZXksIHNlbG
 Yuc2tleSwgc2VsZi5ha2V5LCB1c2VyX25hbWUpDQogICAgICAgICAgICBwcmludCAiRHVvLiBQc
 mVwYXJlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVxdWVzdDogIiArIGR1b19zaWdfcmVxdWVzdA0K
 ICAgICAgICAgICAgDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZHVvX2hvc3QiLCBkdW9faG9
 zdCkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fc2lnX3JlcXVlc3QiLCBkdW9fc2lnX3
 JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgI
 CAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVw
 KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5
 vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb
 250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoImR1b19jb3VudF9sb2dpbl9zdGVw
 cyIpKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldCgiZHVvX2NvdW50X2xvZ2luX3N
 0ZXBzIikNCg0KICAgICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbG
 YsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gM
 ik6DQogICAgICAgICAgICByZXR1cm4gIi9hdXRoL2R1by9kdW9sb2dpbi54aHRtbCINCiAgICAg
 ICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZW
 YgaXNVc2VyTWVtYmVyT2ZHcm91cChzZWxmLCB1c2VyLCBhdHRyaWJ1dGUsIGdyb3VwKToNCiAgI
 CAgICAgaXNfbWVtYmVyID0gRmFsc2UNCiAgICAgICAgbWVtYmVyX29mX2xpc3QgPSB1c2VyLmdl
 dEF0dHJpYnV0ZVZhbHVlcyhhdHRyaWJ1dGUpDQogICAgICAgIGlmIChtZW1iZXJfb2ZfbGlzdCA
 hPSBOb25lKToNCiAgICAgICAgICAgIGZvciBtZW1iZXJfb2YgaW4gbWVtYmVyX29mX2xpc3Q6DQ
 ogICAgICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGdyb3VwL
 CBtZW1iZXJfb2YpKToNCiAgICAgICAgICAgICAgICAgICAgaXNfbWVtYmVyID0gVHJ1ZQ0KICAg
 ICAgICAgICAgICAgICAgICBicmVhaw0KDQogICAgICAgIHJldHVybiBpc19tZW1iZXINCg0KICA
 gIGRlZiBwcm9jZXNzQXVkaXRHcm91cChzZWxmLCB1c2VyKToNCiAgICAgICAgaWYgKHNlbGYudX
 NlX2F1ZGl0X2dyb3VwKToNCiAgICAgICAgICAgIGlzX21lbWJlciA9IHNlbGYuaXNVc2VyTWVtY
 mVyT2ZHcm91cCh1c2VyLCBzZWxmLmF1ZGl0X2F0dHJpYnV0ZSwgc2VsZi5hdWRpdF9ncm91cCkN
 CiAgICAgICAgICAgIGlmIChpc19tZW1iZXIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8
 uIEF1dGhlbnRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFVzZXIgJyIgKyB1c2VyLmdldF
 VzZXJJZCgpICsgIicgbWVtYmVyIG9mIGF1ZGl0IGdyb3VwIg0KICAgICAgICAgICAgICAgIHBya
 W50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3IgcHJvY2Vzc0F1ZGl0R3JvdXAuIFNlbmRpbmcgZS1t
 YWlsIGFib3V0IHVzZXIgJyIgKyB1c2VyLmdldFVzZXJJZCgpICsgIicgbG9naW4gdG8iLCBzZWx
 mLmF1ZGl0X2VtYWlsDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBTZW5kIG
 UtbWFpbCB0byBhZG1pbmlzdHJhdG9yDQogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHVzZXIuZ
 2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBtYWlsU2VydmljZSA9IE1haWxTZXJ2aWNlLmlu
 c3RhbmNlKCkNCiAgICAgICAgICAgICAgICBzdWJqZWN0ID0gIlVzZXIgbG9nIGluOiAiICsgdXN
 lcl9pZA0KICAgICAgICAgICAgICAgIGJvZHkgPSAiVXNlciBsb2cgaW46ICIgKyB1c2VyX2lkDQ
 ogICAgICAgICAgICAgICAgbWFpbFNlcnZpY2Uuc2VuZE1haWwoc2VsZi5hdWRpdF9lbWFpbCwgc
 3ViamVjdCwgYm9keSkNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!2124.0CF1,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Cert authentication module
displayName: cert
gluuStatus: false
inum: %(inumOrg)s!2124.0CF1
oxConfigurationProperty: {"value1":"chain_cert_file_path","value2":"/etc/certs/c
 hain_cert.pem","description":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/cert_
 creds.json","description":""}
oxConfigurationProperty: {"value1":"map_user_cert","value2":"true","description"
 :""}
oxConfigurationProperty: {"value1":"use_generic_validator","value2":"true","desc
 ription":""}
oxConfigurationProperty: {"value1":"use_path_validator","value2":"true","descrip
 tion":""}
oxConfigurationProperty: {"value1":"use_ocsp_validator","value2":"true","descrip
 tion":""}
oxConfigurationProperty: {"value1":"use_crl_validator","value2":"false","descript
 ion":""}
oxConfigurationProperty: {"value1":"crl_max_response_size","value2":"10485760","
 description":""}
oxLevel: 25
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: Iw0KIyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQoj
 IENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0
 KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdX
 RoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMgaW1wb3J0IENvbnRle
 HQsIENvbnRleHRzDQpmcm9tIGphdmF4LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0K
 ZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gb3JnLnhkaS5
 veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydC
 BTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJheUhlbHBlcg0KZnJvbSBvc
 mcueGRpLm94YXV0aC51dGlsIGltcG9ydCBTZXJ2ZXJVdGlsDQpmcm9tIG9yZy54ZGkudXRpbC5zZWN1
 cml0eSBpbXBvcnQgU3RyaW5nRW5jcnlwdGVyIA0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEhhc2hNYXA
 sIEFycmF5cw0KZnJvbSBqYXZhLnNlY3VyaXR5IGltcG9ydCBNZXNzYWdlRGlnZXN0DQpmcm9tIG9yZy
 5hcGFjaGUuY29tbW9ucy5jb2RlYy5iaW5hcnkgaW1wb3J0IEhleA0KZnJvbSBvcmcueGRpLm94YXV0a
 C5jZXJ0LmZpbmdlcnByaW50IGltcG9ydCBGaW5nZXJwcmludEhlbHBlcg0KZnJvbSBvcmcueGRpLm94
 YXV0aC5jZXJ0LnZhbGlkYXRpb24gaW1wb3J0IEdlbmVyaWNDZXJ0aWZpY2F0ZVZlcmlmaWVyLCBQYXR
 oQ2VydGlmaWNhdGVWZXJpZmllciwgT0NTUENlcnRpZmljYXRlVmVyaWZpZXIsIENSTENlcnRpZmljYX
 RlVmVyaWZpZXINCmZyb20gb3JnLnhkaS5veGF1dGguY2VydC52YWxpZGF0aW9uLm1vZGVsIGltcG9yd
 CBWYWxpZGF0aW9uU3RhdHVzDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IENlcnRVdGls
 DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UubmV0IGltcG9ydCBIdHRwU2VydmljZQ0KZnJvbSB
 vcmcuYXBhY2hlLmh0dHAucGFyYW1zIGltcG9ydCBDb3JlQ29ubmVjdGlvblBOYW1lcw0KDQppbXBvcn
 QgamF2YQ0KaW1wb3J0IHN5cw0KaW1wb3J0IGJhc2U2NA0KaW1wb3J0IHVybGxpYg0KDQp0cnk6DQogI
 CAgaW1wb3J0IGpzb24NCmV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICBpbXBvcnQgc2ltcGxlanNvbiBh
 cyBqc29uDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHl
 wZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2
 VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFs
 aXphdGlvbiINCg0KICAgICAgICBpZiBub3QgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5
 zS2V5KCJjaGFpbl9jZXJ0X2ZpbGVfcGF0aCIpKToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbm
 l0aWFsaXphdGlvbi4gUHJvcGVydHkgY2hhaW5fY2VydF9maWxlX3BhdGggaXMgbWFuZGF0b3J5Ig0KI
 CAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgaWYgbm90IChjb25maWd1cmF0aW9uQXR0
 cmlidXRlcy5jb250YWluc0tleSgibWFwX3VzZXJfY2VydCIpKToNCiAgICAgICAgICAgIHByaW50ICJ
 DZXJ0LiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkgbWFwX3VzZXJfY2VydCBpcyBtYW5kYXRvcnkiDQ
 ogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBjaGFpbl9jZXJ0X2ZpbGVfcGF0aCA9I
 GNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2hhaW5fY2VydF9maWxlX3BhdGgiKS5nZXRWYWx1
 ZTIoKQ0KDQogICAgICAgIHNlbGYuY2hhaW5fY2VydHMgPSBDZXJ0VXRpbC5sb2FkWDUwOUNlcnRpZml
 jYXRlRnJvbUZpbGUoY2hhaW5fY2VydF9maWxlX3BhdGgpDQogICAgICAgIHByaW50ICJDZXJ0LiBJbm
 l0aWFsaXphdGlvbi4gTG9hZGVkICclZCcgY2hhaW4gY2VydGlmaWNhdGVzIiAlIHNlbGYuY2hhaW5fY
 2VydHMuc2l6ZSgpDQogICAgICAgIA0KICAgICAgICBjcmxfbWF4X3Jlc3BvbnNlX3NpemUgPSA1ICog
 MTAyNCAqIDEwMjQgICMgMTBNYg0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb25
 0YWluc0tleSgiY3JsX21heF9yZXNwb25zZV9zaXplIik6DQogICAgICAgICAgICBjcmxfbWF4X3Jlc3
 BvbnNlX3NpemUgPSBTdHJpbmdIZWxwZXIudG9JbnRlZ2VyKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 mdldCgiY3JsX21heF9yZXNwb25zZV9zaXplIikuZ2V0VmFsdWUyKCksIGNybF9tYXhfcmVzcG9uc2Vf
 c2l6ZSkNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXphdGlvbi4gQ1JMIG1heCByZXN
 wb25zZSBzaXplIGlzICclZCciICUgY3JsX21heF9yZXNwb25zZV9zaXplDQoNCiAgICAgICAgIyBEZW
 ZpbmUgYXJyYXkgdG8gb3JkZXIgbWV0aG9kcyBjb3JyZWN0bHkNCiAgICAgICAgc2VsZi52YWxpZGF0b
 3JfdHlwZXMgPSBbICdnZW5lcmljJywgJ3BhdGgnLCAnb2NzcCcsICdjcmwnXQ0KICAgICAgICBzZWxm
 LnZhbGlkYXRvcnMgPSB7ICdnZW5lcmljJyA6IFtHZW5lcmljQ2VydGlmaWNhdGVWZXJpZmllcigpLCB
 GYWxzZV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnIDogW1BhdGhDZXJ0aWZpY2
 F0ZVZlcmlmaWVyKEZhbHNlKSwgRmFsc2VdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICdvY
 3NwJyA6IFtPQ1NQQ2VydGlmaWNhdGVWZXJpZmllcigpLCBGYWxzZV0sDQogICAgICAgICAgICAgICAg
 ICAgICAgICAgICAgJ2NybCcgOiBbQ1JMQ2VydGlmaWNhdGVWZXJpZmllcihjcmxfbWF4X3Jlc3BvbnN
 lX3NpemUpLCBGYWxzZV0gfQ0KDQogICAgICAgIGZvciB0eXBlIGluIHNlbGYudmFsaWRhdG9yX3R5cG
 VzOg0KICAgICAgICAgICAgdmFsaWRhdG9yX3BhcmFtX25hbWUgPSAidXNlXyVzX3ZhbGlkYXRvciIgJ
 SB0eXBlDQogICAgICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSh2
 YWxpZGF0b3JfcGFyYW1fbmFtZSk6DQogICAgICAgICAgICAgICAgdmFsaWRhdG9yX3N0YXR1cyA9IFN
 0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KHZhbGlkYXRvcl
 9wYXJhbV9uYW1lKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQogICAgICAgICAgICAgICAgc2VsZi52YWxpZ
 GF0b3JzW3R5cGVdWzFdID0gdmFsaWRhdG9yX3N0YXR1cw0KDQogICAgICAgICAgICBwcmludCAiQ2Vy
 dC4gSW5pdGlhbGl6YXRpb24uIFZhbGlkYXRpb24gbWV0aG9kICclcycgc3RhdHVzOiAnJXMnIiAlICh
 0eXBlLCBzZWxmLnZhbGlkYXRvcnNbdHlwZV1bMV0pDQoNCiAgICAgICAgc2VsZi5tYXBfdXNlcl9jZX
 J0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoIm1hc
 F91c2VyX2NlcnQiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQogICAgICAgIHByaW50ICJDZXJ0LiBJbml0
 aWFsaXphdGlvbi4gbWFwX3VzZXJfY2VydDogJyVzJyIgJSBzZWxmLm1hcF91c2VyX2NlcnQNCg0KICA
 gICAgICBzZWxmLmVuYWJsZWRfcmVjYXB0Y2hhID0gc2VsZi5pbml0UmVjYXB0Y2hhKGNvbmZpZ3VyYX
 Rpb25BdHRyaWJ1dGVzKQ0KICAgICAgICBwcmludCAiQ2VydC4gSW5pdGlhbGl6YXRpb24uIGVuYWJsZ
 WRfcmVjYXB0Y2hhOiAnJXMnIiAlIHNlbGYuZW5hYmxlZF9yZWNhcHRjaGENCg0KICAgICAgICBwcmlu
 dCAiQ2VydC4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICA
 gDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgIC
 AgIHByaW50ICJDZXJ0LiBEZXN0cm95Ig0KDQogICAgICAgIGZvciB0eXBlIGluIHNlbGYudmFsaWRhd
 G9yX3R5cGVzOg0KICAgICAgICAgICAgc2VsZi52YWxpZGF0b3JzW3R5cGVdWzBdLmRlc3Ryb3koKQ0K
 DQogICAgICAgIHByaW50ICJDZXJ0LiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJ
 ldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuID
 ENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb
 25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0
 QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdG
 Uoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNC
 iAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkN
 CiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGN
 vbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICB1c2VyU2VydmljZSA9IF
 VzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgI
 CBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQogICAgICAgICAgICBsb2dpbl9i
 dXR0b24gPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVzdFBhcmFtZXRlcnMsICJsb2dpbkZ
 vcm06bG9naW5CdXR0b24iKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkobG9naW
 5fYnV0dG9uKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzd
 GVwIDEuIEZvcm0gd2VyZSBzdWJtaXR0ZWQgaW5jb3JyZWN0bHkiDQogICAgICAgICAgICAgICAgcmV0
 dXJuIEZhbHNlDQogICAgICAgICAgICBpZiBzZWxmLmVuYWJsZWRfcmVjYXB0Y2hhOg0KICAgICAgICA
 gICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVmFsaWRhdGluZyByZW
 NhcHRjaGEgcmVzcG9uc2UiDQogICAgICAgICAgICAgICAgcmVjYXB0Y2hhX3Jlc3BvbnNlID0gU2Vyd
 mVyVXRpbC5nZXRGaXJzdFZhbHVlKHJlcXVlc3RQYXJhbWV0ZXJzLCAiZy1yZWNhcHRjaGEtcmVzcG9u
 c2UiKQ0KDQogICAgICAgICAgICAgICAgcmVjYXB0Y2hhX3Jlc3VsdCA9IHNlbGYudmFsaWRhdGVSZWN
 hcHRjaGEocmVjYXB0Y2hhX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcmVjYXB0Y2hhX3Jlc3VsdDogJyVzJyIgJSByZWNhcHRjaGFfc
 mVzdWx0DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIHJlY2FwdGNoYV9y
 ZXN1bHQNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiBzdGVwID09IDI6DQo
 gICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIiDQoNCiAgICAgIC
 AgICAgICMgVmFsaWRhdGUgaWYgdXNlciBzZWxlY3RlZCBjZXJ0aWZpY2F0ZQ0KICAgICAgICAgICAgY
 2VydF94NTA5ID0gc2VsZi5nZXRTZXNzaW9uQXR0cmlidXRlKCJjZXJ0X3g1MDkiKQ0KICAgICAgICAg
 ICAgaWYgY2VydF94NTA5ID09IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyLiBVc2VyIG5vdCBzZWxlY3RlZCBhbnkgY2VydHMiDQogICAgICAgIC
 AgICAgICAgY29udGV4dC5zZXQoImNlcnRfc2VsZWN0ZWQiLCBGYWxzZSkNCiAgICAgICAgICAgICAgI
 CAgICAgDQogICAgICAgICAgICAgICAgIyBSZXR1cm4gVHJ1ZSB0byBpbmZvcm0gdXNlciBob3cgdG8g
 cmVzZXQgd29ya2Zsb3cNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWx
 zZToNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF9zZWxlY3RlZCIsIFRydWUpDQogIC
 AgICAgICAgICAgICAgeDUwOUNlcnRpZmljYXRlID0gc2VsZi5jZXJ0RnJvbVN0cmluZyhjZXJ0X3g1M
 DkpDQoNCiAgICAgICAgICAgIHN1YmplY3RYNTAwUHJpbmNpcGFsID0geDUwOUNlcnRpZmljYXRlLmdl
 dFN1YmplY3RYNTAwUHJpbmNpcGFsKCkNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWN
 hdGUgZm9yIHN0ZXAgMi4gVXNlciBzZWxlY3RlZCBjZXJ0aWZpY2F0ZSB3aXRoIEROICclcyciICUgc3
 ViamVjdFg1MDBQcmluY2lwYWwNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBWYWxpZGF0ZSBjZ
 XJ0aWZpY2F0ZXMgd2hpY2ggdXNlciBzZWxlY3RlZA0KICAgICAgICAgICAgdmFsaWQgPSBzZWxmLnZh
 bGlkYXRlQ2VydGlmaWNhdGUoeDUwOUNlcnRpZmljYXRlKQ0KICAgICAgICAgICAgaWYgbm90IHZhbGl
 kOg0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gQ2
 VydGlmaWNhdGUgRE4gJyVzJyBpcyBub3QgdmFsaWQiICUgc3ViamVjdFg1MDBQcmluY2lwYWwNCiAgI
 CAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF92YWxpZCIsIEZhbHNlKQ0KICAgICAgICAgICAg
 ICAgIA0KICAgICAgICAgICAgICAgICMgUmV0dXJuIFRydWUgdG8gaW5mb3JtIHVzZXIgaG93IHRvIHJ
 lc2V0IHdvcmtmbG93DQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgY2
 9udGV4dC5zZXQoImNlcnRfdmFsaWQiLCBUcnVlKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjI
 ENhbGN1bGF0ZSBjZXJ0aWZpY2F0ZSBmaW5nZXJwcmludA0KICAgICAgICAgICAgeDUwOUNlcnRpZmlj
 YXRlRmluZ2VycHJpbnQgPSBzZWxmLmNhbGN1bGF0ZUNlcnRpZmljYXRlRmluZ2VycHJpbnQoeDUwOUN
 lcnRpZmljYXRlKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoImNlcnRfeDUwOV9maW5nZXJwcmludC
 IsIHg1MDlDZXJ0aWZpY2F0ZUZpbmdlcnByaW50KQ0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1d
 GhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGaW5nZXJwcmludCBpcyAnJXMnIG9mIGNlcnRpZmljYXRlIHdp
 dGggRE4gJyVzJyIgJSAoeDUwOUNlcnRpZmljYXRlRmluZ2VycHJpbnQsIHN1YmplY3RYNTAwUHJpbmN
 pcGFsKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIEF0dGVtcHQgdG8gZmluZCB1c2VyIGJ5IG
 NlcnRpZmljYXRlIGZpbmdlcnByaW50DQogICAgICAgICAgICBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkI
 D0gImNlcnQ6ICVzIiAlIHg1MDlDZXJ0aWZpY2F0ZUZpbmdlcnByaW50DQogICAgICAgICAgICBwcmlu
 dCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ
 5IG94RXh0ZXJuYWxVaWQgYXR0cmlidXRlIHZhbHVlICVzIiAlIGNlcnRfdXNlcl9leHRlcm5hbF91aW
 QNCg0KICAgICAgICAgICAgZmluZF91c2VyX2J5X2V4dGVybmFsX3VpZCA9IHVzZXJTZXJ2aWNlLmdld
 FVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsIGNlcnRfdXNlcl9leHRlcm5hbF91aWQpDQog
 ICAgICAgICAgICBpZiBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID09IE5vbmU6DQogICAgICAgICA
 gICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZmluZC
 B1c2VyIg0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIHNlbGYubWFwX3VzZXJfY
 2VydDoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3Rl
 cCAyLiBTdG9yaW5nIGNlcnRfdXNlcl9leHRlcm5hbF91aWQgZm9yIHN0ZXAgMyINCiAgICAgICAgICA
 gICAgICAgICAgY29udGV4dC5zZXQoImNlcnRfdXNlcl9leHRlcm5hbF91aWQiLCBjZXJ0X3VzZXJfZX
 h0ZXJuYWxfdWlkKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgI
 CAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9y
 IHN0ZXAgMi4gTWFwcGluZyBjZXQgdG8gdXNlciBhY2NvdW50IGlzIG5vdCBhbGxvd2VkIg0KICAgICA
 gICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF9jb3VudF9sb2dpbl9zdGVwcyIsIDIpDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBmb3VuZFVzZXJOYW1lI
 D0gZmluZF91c2VyX2J5X2V4dGVybmFsX3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgcHJpbnQg
 IkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBmb3VuZFVzZXJOYW1lOiAiICsgZm91bmRVc2V
 yTmFtZQ0KDQogICAgICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgdXNlclNlcn
 ZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU
 2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRVc2VyTmFtZSkNCiAgICAgICAgDQogICAgICAgICAgICBw
 cmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIFNldHRpbmcgY291bnQgc3RlcHMgdG8
 gMiINCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjZXJ0X2NvdW50X2xvZ2luX3N0ZXBzIiwgMikNCg
 0KICAgICAgICAgICAgcmV0dXJuIGxvZ2dlZF9pbg0KICAgICAgICBlbGlmIHN0ZXAgPT0gMzoNCiAgI
 CAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMyINCg0KICAgICAgICAg
 ICAgY2VydF91c2VyX2V4dGVybmFsX3VpZCA9IHNlbGYuZ2V0U2Vzc2lvbkF0dHJpYnV0ZSgiY2VydF9
 1c2VyX2V4dGVybmFsX3VpZCIpDQogICAgICAgICAgICBpZiBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkID
 09IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3Rlc
 CAzLiBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkIGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVy
 biBGYWxzZQ0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V
 0Q3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm
 5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkK
 CkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgICAgICAgICAgIGlmIChTdHJpbmdI
 ZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB
 0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICAgICAgICAgICAgICAgbG9nZ2VkX2luID0gdXNlcl
 NlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJfbmFtZSwgdXNlcl9wYXNzd29yZCkNCg0KICAgICAgICAgI
 CAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAg
 ICAgICAgICAjIERvdWJsZSBjaGVjayBqdXN0IHRvIG1ha2Ugc3VyZS4gV2UgZGlkIGNoZWNraW5nIGl
 uIHByZXZpb3VzIHN0ZXANCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aGljaC
 BoYXMgY2VydF91c2VyX2V4dGVybmFsX3VpZA0KICAgICAgICAgICAgIyBBdm9pZCBtYXBwaW5nIHVzZ
 XIgY2VydCB0byBtb3JlIHRoYW4gb25lIElEUCBhY2NvdW50DQogICAgICAgICAgICBmaW5kX3VzZXJf
 YnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmF
 sVWlkIiwgY2VydF91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgIGlmIGZpbmRfdXNlcl9ieV
 9leHRlcm5hbF91aWQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAjIEFkZCBjZXJ0X3VzZXJfZXh0Z
 XJuYWxfdWlkIHRvIHVzZXIncyBleHRlcm5hbCBHVUlEIGxpc3QNCiAgICAgICAgICAgICAgICBmaW5k
 X3VzZXJfYnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UuYWRkVXNlckF0dHJpYnV0ZSh1c2VyX25
 hbWUsICJveEV4dGVybmFsVWlkIiwgY2VydF91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgIC
 AgICBpZiBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID09IE5vbmU6DQogICAgICAgICAgICAgICAgI
 CAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMy4gRmFpbGVkIHRvIHVwZGF0ZSBj
 dXJyZW50IHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICA
 gICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0Z
 XAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToN
 CiAgICAgICAgcHJpbnQgIkNlcnQuIFByZXBhcmUgZm9yIHN0ZXAgJWQiICUgc3RlcA0KICAgICAgICB
 jb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgDQogICAgICAgIGlmIH
 N0ZXAgPT0gMToNCiAgICAgICAgICAgIGlmIHNlbGYuZW5hYmxlZF9yZWNhcHRjaGE6DQogICAgICAgI
 CAgICAgICAgY29udGV4dC5zZXQoInJlY2FwdGNoYV9zaXRlX2tleSIsIHNlbGYucmVjYXB0Y2hhX2Ny
 ZWRzWydzaXRlX2tleSddKQ0KICAgICAgICBlbGlmIHN0ZXAgPT0gMjoNCiAgICAgICAgICAgICMgU3R
 vcmUgY2VydGlmaWNhdGUgaW4gc2Vzc2lvbg0KICAgICAgICAgICAgcmVxdWVzdCA9IEZhY2VzQ29udG
 V4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleHQoKS5nZXRSZXF1ZXN0KCkNC
 iAgICAgICAgICAgIHg1MDlDZXJ0aWZpY2F0ZXMgPSByZXF1ZXN0LmdldEF0dHJpYnV0ZSgnamF2YXgu
 c2VydmxldC5yZXF1ZXN0Llg1MDlDZXJ0aWZpY2F0ZScpDQogICAgICAgICAgICBpZiAoeDUwOUNlcnR
 pZmljYXRlcyAhPSBOb25lKSBhbmQgKGxlbih4NTA5Q2VydGlmaWNhdGVzKSA+IDApOg0KICAgICAgIC
 AgICAgICAgIGNvbnRleHQuc2V0KCJjZXJ0X3g1MDkiLCBzZWxmLmNlcnRUb1N0cmluZyh4NTA5Q2Vyd
 GlmaWNhdGVzKSkNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gUHJlcGFyZSBmb3Igc3RlcCAy
 LiBTdG9yaW5nIHVzZXIgY2VydGlmaWNhdGUiDQoNCiAgICAgICAgaWYgc3RlcCA8IDQ6DQogICAgICA
 gICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQ
 oNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0c
 mlidXRlcywgc3RlcCk6DQogICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJjZXJ0X3NlbGVjdGVk
 IiwgImNlcnRfdmFsaWQiLCAiY2VydF94NTA5IiwgImNlcnRfeDUwOV9maW5nZXJwcmludCIsICJjZXJ
 0X2NvdW50X2xvZ2luX3N0ZXBzIiwgImNlcnRfdXNlcl9leHRlcm5hbF91aWQiKQ0KDQogICAgZGVmIG
 dldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6D
 QogICAgICAgIGNlcnRfY291bnRfbG9naW5fc3RlcHMgPSBzZWxmLmdldFNlc3Npb25BdHRyaWJ1dGUo
 ImNlcnRfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICBpZiBjZXJ0X2NvdW50X2xvZ2luX3N0ZXB
 zICE9IE5vbmU6DQogICAgICAgICAgICByZXR1cm4gY2VydF9jb3VudF9sb2dpbl9zdGVwcw0KICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIDMNCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIHN0ZXAgPT0gMToN
 CiAgICAgICAgICAgIHJldHVybiAiL2F1dGgvY2VydC9sb2dpbi54aHRtbCINCiAgICAgICAgaWYgc3R
 lcCA9PSAyOg0KICAgICAgICAgICAgcmV0dXJuICIvY2VydC1sb2dpbi54aHRtbCINCiAgICAgICAgZW
 xpZiBzdGVwID09IDM6DQogICAgICAgICAgICBjZXJ0X3NlbGVjdGVkID0gc2VsZi5nZXRTZXNzaW9uQ
 XR0cmlidXRlKCJjZXJ0X3NlbGVjdGVkIikNCiAgICAgICAgICAgIGlmIFRydWUgIT0gY2VydF9zZWxl
 Y3RlZDoNCiAgICAgICAgICAgICAgICByZXR1cm4gIi9hdXRoL2NlcnQvY2VydC1ub3Qtc2VsZWN0ZWQ
 ueGh0bWwiDQoNCiAgICAgICAgICAgIGNlcnRfdmFsaWQgPSBzZWxmLmdldFNlc3Npb25BdHRyaWJ1dG
 UoImNlcnRfdmFsaWQiKQ0KICAgICAgICAgICAgaWYgVHJ1ZSAhPSBjZXJ0X3ZhbGlkOg0KICAgICAgI
 CAgICAgICAgIHJldHVybiAiL2F1dGgvY2VydC9jZXJ0LWludmFsaWQueGh0bWwiDQogICAgICAgICAg
 ICANCiAgICAgICAgICAgIHJldHVybiAiL2xvZ2luLnhodG1sIg0KDQogICAgICAgIHJldHVybiAiIg0
 KDQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcm
 FtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIHByb2Nlc3NCYXNpY0F1dGhlb
 nRpY2F0aW9uKHNlbGYsIGNyZWRlbnRpYWxzKToNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2Vy
 dmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5
 hbWUoKQ0KICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQ
 ogICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFb
 XB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2Vy
 X3Bhc3N3b3JkKSk6DQogICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWN
 hdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgIGlmIChub3QgbG9nZ2VkX2luKT
 oNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZ
 XJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiAoZmluZF91c2VyX2J5X3VpZCA9
 PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBQcm9jZXNzIGJhc2ljIGF1dGhlbnRpY2F
 0aW9uLiBGYWlsZWQgdG8gZmluZCB1c2VyICclcyciICUgdXNlcl9uYW1lDQogICAgICAgICAgICByZX
 R1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGZpbmRfdXNlcl9ieV91aWQNCg0KICAgI
 GRlZiBnZXRTZXNzaW9uQXR0cmlidXRlKHNlbGYsIGF0dHJpYnV0ZV9uYW1lKToNCiAgICAgICAgY29u
 dGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQoNCiAgICAgICAgIyBUcnkgdG8gZ2V0IGF
 0dHJpYnV0ZSB2YWx1ZSBmcm9tIFNlYW0gZXZlbnQgY29udGV4dA0KICAgICAgICBpZiBjb250ZXh0Lm
 lzU2V0KGF0dHJpYnV0ZV9uYW1lKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldChhdHRya
 WJ1dGVfbmFtZSkNCiAgICAgICAgDQogICAgICAgICMgVHJ5IHRvIGdldCBhdHRyaWJ1dGUgZnJvbSBw
 ZXJzaXN0ZW50IHNlc3Npb24NCiAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQ
 oInNlc3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgaWYgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW
 5zS2V5KGF0dHJpYnV0ZV9uYW1lKToNCiAgICAgICAgICAgIHJldHVybiBzZXNzaW9uX2F0dHJpYnV0Z
 XMuZ2V0KGF0dHJpYnV0ZV9uYW1lKQ0KDQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgY2Fs
 Y3VsYXRlQ2VydGlmaWNhdGVGaW5nZXJwcmludChzZWxmLCB4NTA5Q2VydGlmaWNhdGUpOg0KICAgICA
 gICBwcmludCAiQ2VydC4gQ2FsY3VsYXRlIGZpbmdlcnByaW50IGZvciBjZXJ0aWZpY2F0ZSBETiAnJX
 MnIiAlIHg1MDlDZXJ0aWZpY2F0ZS5nZXRTdWJqZWN0WDUwMFByaW5jaXBhbCgpDQogICAgICAgIA0KI
 CAgICAgICBwdWJsaWNLZXkgPSB4NTA5Q2VydGlmaWNhdGUuZ2V0UHVibGljS2V5KCkNCiAgICAgICAg
 DQogICAgICAgICMgVXNlIG94QXV0aCBpbXBsZW1lbnRhdGlvbg0KICAgICAgICBmaW5nZXJwcmludCA
 9IEZpbmdlcnByaW50SGVscGVyLmdldFB1YmxpY0tleVNzaEZpbmdlcnByaW50KHB1YmxpY0tleSkNCi
 AgICAgICAgDQogICAgICAgIHJldHVybiBmaW5nZXJwcmludCAgICAgIA0KDQogICAgZGVmIHZhbGlkY
 XRlQ2VydGlmaWNhdGUoc2VsZiwgeDUwOUNlcnRpZmljYXRlKToNCiAgICAgICAgc3ViamVjdFg1MDBQ
 cmluY2lwYWwgPSB4NTA5Q2VydGlmaWNhdGUuZ2V0U3ViamVjdFg1MDBQcmluY2lwYWwoKQ0KDQogICA
 gICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0aW5nIGNlcnRpZmljYXRlIHdpdGggRE4gJyVzJyIgJSBzdW
 JqZWN0WDUwMFByaW5jaXBhbA0KICAgICAgICANCiAgICAgICAgdmFsaWRhdGlvbl9kYXRlID0gamF2Y
 S51dGlsLkRhdGUoKQ0KDQogICAgICAgIGZvciB0eXBlIGluIHNlbGYudmFsaWRhdG9yX3R5cGVzOg0K
 ICAgICAgICAgICAgaWYgc2VsZi52YWxpZGF0b3JzW3R5cGVdWzFdOg0KICAgICAgICAgICAgICAgIHJ
 lc3VsdCA9IHNlbGYudmFsaWRhdG9yc1t0eXBlXVswXS52YWxpZGF0ZSh4NTA5Q2VydGlmaWNhdGUsIH
 NlbGYuY2hhaW5fY2VydHMsIHZhbGlkYXRpb25fZGF0ZSkNCiAgICAgICAgICAgICAgICBwcmludCAiQ
 2VydC4gVmFsaWRhdGUgY2VydGlmaWNhdGU6ICclcycuIFZhbGlkYXRpb24gbWV0aG9kICclcycgcmVz
 dWx0OiAnJXMnIiAlIChzdWJqZWN0WDUwMFByaW5jaXBhbCwgdHlwZSwgcmVzdWx0KQ0KICAgICAgICA
 gICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZ2V0VmFsaWRpdHkoKSAhPSBWYWxpZG
 F0aW9uU3RhdHVzLkNlcnRpZmljYXRlVmFsaWRpdHkuVkFMSUQpOg0KICAgICAgICAgICAgICAgICAgI
 CBwcmludCAiQ2VydC4gQ2VydGlmaWNhdGU6ICclcycgaXMgaW52YWxpZCIgJSBzdWJqZWN0WDUwMFBy
 aW5jaXBhbA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICA
 gIHJldHVybiBUcnVlDQoNCiAgICBkZWYgY2VydFRvU3RyaW5nKHNlbGYsIHg1MDlDZXJ0aWZpY2F0ZX
 MpOg0KICAgICAgICByZXR1cm4gYmFzZTY0LmI2NGVuY29kZSh4NTA5Q2VydGlmaWNhdGVzWzBdLmdld
 EVuY29kZWQoKSkNCg0KICAgIGRlZiBjZXJ0RnJvbVN0cmluZyhzZWxmLCB4NTA5Q2VydGlmaWNhdGVF
 bmNvZGVkKToNCiAgICAgICAgeDUwOUNlcnRpZmljYXRlRGVjb2RlZCA9IGJhc2U2NC5iNjRkZWNvZGU
 oeDUwOUNlcnRpZmljYXRlRW5jb2RlZCkNCg0KICAgICAgICByZXR1cm4gQ2VydFV0aWwueDUwOUNlcn
 RpZmljYXRlRnJvbUJ5dGVzKHg1MDlDZXJ0aWZpY2F0ZURlY29kZWQpDQoNCiAgICBkZWYgaW5pdFJlY
 2FwdGNoYShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDZXJ0
 LiBJbml0aWFsaXplIHJlY2FwdGNoYSINCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzLmNvbnRhaW5zS2V5KCJjcmVkZW50aWFsc19maWxlIik6DQogICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCg0KICAgICAgICBjZXJ0X2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZ
 XQoImNyZWRlbnRpYWxzX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICMgTG9hZCBjcmVkZW50
 aWFscyBmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4oY2VydF9jcmVkc19maWxlLCAncicpDQogICA
 gICAgIHRyeToNCiAgICAgICAgICAgIGNyZWRzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkNCiAgICAgIC
 AgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemUgcmVjYXB0Y2hhLiBGY
 WlsZWQgdG8gbG9hZCBjcmVkZW50aWFscyBmcm9tIGZpbGU6ICVzIiAlIGNlcnRfY3JlZHNfZmlsZQ0K
 ICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBmLmN
 sb3NlKCkNCiAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHJlY2FwdGNoYV9jcmVkcy
 A9IGNyZWRzWyJyZWNhcHRjaGEiXQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludCAiQ
 2VydC4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIEludmFsaWQgY3JlZGVudGlhbHMgZmlsZSAnJXMnIGZv
 cm1hdDoiICUgY2VydF9jcmVkc19maWxlDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICA
 gDQogICAgICAgIHNlbGYucmVjYXB0Y2hhX2NyZWRzID0gTm9uZQ0KICAgICAgICBpZiByZWNhcHRjaG
 FfY3JlZHNbImVuYWJsZWQiXToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY
 2FwdGNoYS4gUmVjYXB0Y2hhIGlzIGVuYWJsZWQiDQoNCiAgICAgICAgICAgIHN0cmluZ0VuY3J5cHRl
 ciA9IFN0cmluZ0VuY3J5cHRlci5kZWZhdWx0SW5zdGFuY2UoKQ0KDQogICAgICAgICAgICBzaXRlX2t
 leSA9IHJlY2FwdGNoYV9jcmVkc1sic2l0ZV9rZXkiXQ0KICAgICAgICAgICAgc2VjcmV0X2tleSA9IH
 JlY2FwdGNoYV9jcmVkc1sic2VjcmV0X2tleSJdDQoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgI
 CAgICAgICBzaXRlX2tleSA9IHN0cmluZ0VuY3J5cHRlci5kZWNyeXB0KHNpdGVfa2V5KQ0KICAgICAg
 ICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICMgSWdub3JlIGV4Y2VwdGlvbi4gVmFsdWUgaXM
 gbm90IGVuY3J5cHRlZA0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY2
 FwdGNoYS4gQXNzdW1pbmcgdGhhdCAnc2l0ZV9rZXknIGluIG5vdCBlbmNyeXB0ZWQiDQoNCiAgICAgI
 CAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzZWNyZXRfa2V5ID0gc3RyaW5nRW5jcnlwdGVyLmRl
 Y3J5cHQoc2VjcmV0X2tleSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAjIEl
 nbm9yZSBleGNlcHRpb24uIFZhbHVlIGlzIG5vdCBlbmNyeXB0ZWQNCiAgICAgICAgICAgICAgICBwcm
 ludCAiQ2VydC4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIEFzc3VtaW5nIHRoYXQgJ3NlY3JldF9rZXknI
 GluIG5vdCBlbmNyeXB0ZWQiDQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc2VsZi5yZWNhcHRj
 aGFfY3JlZHMgPSB7ICdzaXRlX2tleScgOiBzaXRlX2tleSwgInNlY3JldF9rZXkiIDogc2VjcmV0X2t
 leSB9DQogICAgICAgICAgICBwcmludCAib3hQdXNoMi4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIFJlY2
 FwdGNoYSBpcyBjb25maWd1cmVkIGNvcnJlY3RseSINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNC
 iAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50ICJveFB1c2gyLiBJbml0aWFsaXplIHJlY2Fw
 dGNoYS4gUmVjYXB0Y2hhIGlzIGRpc2FibGVkIg0KDQogICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIHZhbGlkYXRlUmVjYXB0Y2hhKHNlbGYsIHJlY2FwdGNoYV9yZXNwb25zZSk6DQogICAgICAgIH
 ByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVzcG9uc2UiDQoNCiAgICAgICAgcmVxdWVzd
 CA9IEZhY2VzQ29udGV4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleHQoKS5n
 ZXRSZXF1ZXN0KCkNCiAgICAgICAgcmVtb3RlaXAgPSByZXF1ZXN0LmdldEhlYWRlcigiWC1GT1JXQVJ
 ERUQtRk9SIikNCiAgICAgICAgaWYgcmVtb3RlaXAgPT0gTm9uZToNCiAgICAgICAgICAgIHJlbW90ZW
 lwID0gcmVxdWVzdC5nZXRSZW1vdGVBZGRyKCkNCiAgICAgICAgcHJpbnQgIkNlcnQuIFZhbGlkYXRlI
 HJlY2FwdGNoYSByZXNwb25zZS4gcmVtb3RlaXA6ICclcyciICUgcmVtb3RlaXANCg0KICAgICAgICBo
 dHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgICAgICAgaHR0cF9jbGllbnQ
 gPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgICBodHRwX2NsaWVudF9wYXJhbX
 MgPSBodHRwX2NsaWVudC5nZXRQYXJhbXMoKTsNCiAgICAgICAgaHR0cF9jbGllbnRfcGFyYW1zLnNld
 EludFBhcmFtZXRlcihDb3JlQ29ubmVjdGlvblBOYW1lcy5DT05ORUNUSU9OX1RJTUVPVVQsIDE1ICog
 MTAwMCk7DQogICAgICAgIA0KICAgICAgICByZWNhcHRjaGFfdmFsaWRhdGlvbl91cmwgPSAiaHR0cHM
 6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL3NpdGV2ZXJpZnkiDQogICAgICAgIHJlY2FwdG
 NoYV92YWxpZGF0aW9uX3JlcXVlc3QgPSB1cmxsaWIudXJsZW5jb2RlKHsgInNlY3JldCIgOiBzZWxmL
 nJlY2FwdGNoYV9jcmVkc1snc2VjcmV0X2tleSddLCAicmVzcG9uc2UiIDogcmVjYXB0Y2hhX3Jlc3Bv
 bnNlLCAicmVtb3RlaXAiIDogcmVtb3RlaXAgfSkNCiAgICAgICAgcmVjYXB0Y2hhX3ZhbGlkYXRpb25
 faGVhZGVycyA9IHsgIkNvbnRlbnQtdHlwZSIgOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbm
 NvZGVkIiwgIkFjY2VwdCIgOiAiYXBwbGljYXRpb24vanNvbiIgfQ0KDQogICAgICAgIHRyeToNCiAgI
 CAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4ZWN1dGVQb3N0KGh0
 dHBfY2xpZW50LCByZWNhcHRjaGFfdmFsaWRhdGlvbl91cmwsIE5vbmUsIHJlY2FwdGNoYV92YWxpZGF
 0aW9uX2hlYWRlcnMsIHJlY2FwdGNoYV92YWxpZGF0aW9uX3JlcXVlc3QpDQogICAgICAgICAgICBodH
 RwX3Jlc3BvbnNlID0gaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmdldEh0dHBSZXNwb25zZSgpDQogICAgI
 CAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVz
 cG9uc2UuIEV4Y2VwdGlvbjogIiwgc3lzLmV4Y19pbmZvKClbMV0NCiAgICAgICAgICAgIHJldHVybiB
 GYWxzZQ0KDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBodHRwU2VydmljZS5pc1Jlc3
 BvbnNlU3Rhc3R1c0NvZGVPayhodHRwX3Jlc3BvbnNlKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ
 2VydC4gVmFsaWRhdGUgcmVjYXB0Y2hhIHJlc3BvbnNlLiBHZXQgaW52YWxpZCByZXNwb25zZSBmcm9t
 IHZhbGlkYXRpb24gc2VydmVyOiAiLCBzdHIoaHR0cF9yZXNwb25zZS5nZXRTdGF0dXNMaW5lKCkuZ2V
 0U3RhdHVzQ29kZSgpKQ0KICAgICAgICAgICAgICAgIGh0dHBTZXJ2aWNlLmNvbnN1bWUoaHR0cF9yZX
 Nwb25zZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAgICAgICAgIHJlc
 3BvbnNlX2J5dGVzID0gaHR0cFNlcnZpY2UuZ2V0UmVzcG9uc2VDb250ZW50KGh0dHBfcmVzcG9uc2Up
 DQogICAgICAgICAgICByZXNwb25zZV9zdHJpbmcgPSBodHRwU2VydmljZS5jb252ZXJ0RW50aXR5VG9
 TdHJpbmcocmVzcG9uc2VfYnl0ZXMpDQogICAgICAgICAgICBodHRwU2VydmljZS5jb25zdW1lKGh0dH
 BfcmVzcG9uc2UpDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzc
 G9uc2UuY2xvc2VDb25uZWN0aW9uKCkNCg0KICAgICAgICBpZiByZXNwb25zZV9zdHJpbmcgPT0gTm9u
 ZToNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVzcG9uc2UuIEd
 ldCBlbXB0eSByZXNwb25zZSBmcm9tIHZhbGlkYXRpb24gc2VydmVyIg0KICAgICAgICAgICAgcmV0dX
 JuIEZhbHNlDQogICAgICAgIA0KICAgICAgICByZXNwb25zZSA9IGpzb24ubG9hZHMocmVzcG9uc2Vfc
 3RyaW5nKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJlc3BvbnNlWyJzdWNjZXNzIl0NCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!14AF.A70C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: CAS authentication module
displayName: cas
gluuStatus: false
inum: %(inumOrg)s!0011!14AF.A70C
oxConfigurationProperty: {"value1":"cas_map_user","value2":"true","description":""}
oxConfigurationProperty: {"value1":"cas_renew_opt","value2":"false","description":""}
oxConfigurationProperty: {"value1":"cas_host","value2":"https://%(hostname)s/cas","description":""}
oxLevel: 30
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuI
 FNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQojIENv
 cHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJ
 vbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4dHMNCmZyb20gb3
 JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIG9yZy5qYm9zcy5zZWFtI
 GltcG9ydCBDb21wb25lbnQNCmZyb20gamF2YXguZmFjZXMuY29udGV4dCBpbXBvcnQgRmFjZXNDb250
 ZXh0DQpmcm9tIG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb25lbnQNCmZyb20gb3JnLmFwYWNoZS5
 odHRwLmVudGl0eSBpbXBvcnQgQ29udGVudFR5cGUgDQpmcm9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLn
 NjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcue
 GRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5z
 ZXJ2aWNlIGltcG9ydCBBdXRoZW50aWNhdGlvblNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2V
 ydmljZS5uZXQgaW1wb3J0IEh0dHBTZXJ2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW
 5nSGVscGVyDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLmFwY
 WNoZS5odHRwLnBhcmFtcyBpbXBvcnQgQ29yZUNvbm5lY3Rpb25QTmFtZXMNCmZyb20gamF2YS51dGls
 IGltcG9ydCBBcnJheXMNCmZyb20gamF2YS51dGlsIGltcG9ydCBIYXNoTWFwDQoNCmltcG9ydCBqYXZ
 hDQppbXBvcnQgc3lzDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2
 F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgI
 CAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYg
 aW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDQVMyLiB
 Jbml0aWFsaXphdGlvbiINCiAgICAgICAgcHJpbnQgIkNBUzIuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdW
 xseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ
 3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNBUzIuIERlc3Ryb3kiDQogICAgICAg
 IHByaW50ICJDQVMyLiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0
 KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZW
 YgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvb
 kF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aGVudGljYXRlIGlz
 VmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZCINCg0KICAgICAgICBpZiAobm90IChjb25maWd1cmF0aW9
 uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fdXJpIikgYW5kDQogICAgICAgIC
 AgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fcGF0d
 GVybiIpIGFuZA0KICAgICAgICAgICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXko
 ImNhc192YWxpZGF0aW9uX3RpbWVvdXQiKSkpOg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICA
 gICAgICBjYXNfdmFsaWRhdGlvbl91cmkgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc1
 92YWxpZGF0aW9uX3VyaSIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc192YWxpZGF0aW9uX3BhdHRlc
 m4gPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc192YWxpZGF0aW9uX3BhdHRlcm4iKS5n
 ZXRWYWx1ZTIoKQ0KICAgICAgICBjYXNfdmFsaWRhdGlvbl90aW1lb3V0ID0gaW50KGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzLmdldCgiY2FzX3ZhbGlkYXRpb25fdGltZW91dCIpLmdldFZhbHVlMigpKSAqID
 EwMDANCg0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgI
 CAgICAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpOw0KICAgICAgICBo
 dHRwX2NsaWVudF9wYXJhbXMgPSBodHRwX2NsaWVudC5nZXRQYXJhbXMoKTsNCiAgICAgICAgaHR0cF9
 jbGllbnRfcGFyYW1zLnNldEludFBhcmFtZXRlcihDb3JlQ29ubmVjdGlvblBOYW1lcy5DT05ORUNUSU
 9OX1RJTUVPVVQsIGNhc192YWxpZGF0aW9uX3RpbWVvdXQpOw0KDQogICAgICAgIHRyeToNCiAgICAgI
 CAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZSA9IGh0dHBTZXJ2aWNlLmV4ZWN1dGVHZXQoaHR0cF9j
 bGllbnQsIGNhc192YWxpZGF0aW9uX3VyaSkNCiAgICAgICAgICAgIGh0dHBfcmVzcG9uc2UgPSBodHR
 wX3NlcnZpY2VfcmVzcG9uc2UuZ2V0SHR0cFJlc3BvbnNlKCkNCiAgICAgICAgZXhjZXB0Og0KICAgIC
 AgICAgICAgcHJpbnQgIkNBUzIuIFJlc3QgQVBJIGF1dGhlbnRpY2F0ZSBpc1ZhbGlkQXV0aGVudGljY
 XRpb25NZXRob2QuIEV4Y2VwdGlvbjogIiwgc3lzLmV4Y19pbmZvKClbMV0NCiAgICAgICAgICAgIHJl
 dHVybiBGYWxzZQ0KDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIChodHRwX3Jlc3BvbnNlLmd
 ldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXNDb2RlKCkgIT0gMjAwKToNCiAgICAgICAgICAgICAgICBwcm
 ludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aGVudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZ
 C4gR2V0IGludmFsaWQgcmVzcG9uc2UgZnJvbSBDQVMyIHNlcnZlcjogIiwgc3RyKGh0dHBfcmVzcG9u
 c2UuZ2V0U3RhdHVzTGluZSgpLmdldFN0YXR1c0NvZGUoKSkNCiAgICAgICAgICAgICAgICBodHRwU2V
 ydmljZS5jb25zdW1lKGh0dHBfcmVzcG9uc2UpDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQ
 ogICAgDQogICAgICAgICAgICB2YWxpZGF0aW9uX3Jlc3BvbnNlX2J5dGVzID0gaHR0cFNlcnZpY2UuZ
 2V0UmVzcG9uc2VDb250ZW50KGh0dHBfcmVzcG9uc2UpDQogICAgICAgICAgICB2YWxpZGF0aW9uX3Jl
 c3BvbnNlX3N0cmluZyA9IGh0dHBTZXJ2aWNlLmNvbnZlcnRFbnRpdHlUb1N0cmluZyh2YWxpZGF0aW9
 uX3Jlc3BvbnNlX2J5dGVzKQ0KICAgICAgICAgICAgaHR0cFNlcnZpY2UuY29uc3VtZShodHRwX3Jlc3
 BvbnNlKQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlL
 mNsb3NlQ29ubmVjdGlvbigpDQoNCiAgICAgICAgaWYgKHZhbGlkYXRpb25fcmVzcG9uc2Vfc3RyaW5n
 ID09IE5vbmUgb3IgdmFsaWRhdGlvbl9yZXNwb25zZV9zdHJpbmcuZmluZChjYXNfdmFsaWRhdGlvbl9
 wYXR0ZXJuKSA9PSAtMSk6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkgYXV0aGVudG
 ljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZC4gR2V0IGludmFsaWQgbG9naW4gcGFnZSBmc
 m9tIENBUzIgc2VydmVyOiINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHJldHVy
 biBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB
 1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgY2FzX2FsdF9hdXRoX2
 1vZGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc19hbHRfYXV0aF9tb2RlIikuZ2V0V
 mFsdWUyKCkNCiAgICAgICAgcmV0dXJuIGNhc19hbHRfYXV0aF9tb2RlDQoNCiAgICBkZWYgYXV0aGVu
 dGljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3R
 lcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgIC
 BhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KI
 CAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgaHR0cFNl
 cnZpY2UgPSBIdHRwU2VydmljZS5pbnN0YW5jZSgpOw0KDQogICAgICAgIGNhc19ob3N0ID0gY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXNfaG9zdCIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc1
 9tYXBfdXNlciA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ
 2V0KCJjYXNfbWFwX3VzZXIiKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQogICAgICAgIGNhc19yZW5ld19v
 cHQgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2F
 zX3JlbmV3X29wdCIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0KICAgICAgICBjYXNfZXh0cmFfb3B0cy
 A9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjY
 XNfZXh0cmFfb3B0cyIpKToNCiAgICAgICAgICAgIGNhc19leHRyYV9vcHRzID0gY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMuZ2V0KCJjYXNfZXh0cmFfb3B0cyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgaWY
 gKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdG
 VwIDEiDQogICAgICAgICAgICB0aWNrZXRfYXJyYXkgPSByZXF1ZXN0UGFyYW1ldGVycy5nZXQoInRpY
 2tldCIpDQogICAgICAgICAgICBpZiBBcnJheUhlbHBlci5pc0VtcHR5KHRpY2tldF9hcnJheSk6DQog
 ICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB0aWNrZXQ
 gaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHRpY2
 tldCA9IHRpY2tldF9hcnJheVswXQ0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0Z
 SBmb3Igc3RlcCAxLiB0aWNrZXQ6ICIgKyB0aWNrZXQNCg0KICAgICAgICAgICAgaWYgKFN0cmluZ0hl
 bHBlci5pc0VtcHR5U3RyaW5nKHRpY2tldCkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiB
 BdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdGlja2V0IGlzIGludmFsaWQiDQogICAgICAgICAgICAgIC
 AgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgVmFsaWRhdGUgdGlja2V0DQogICAgICAgICAgI
 CByZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29u
 dGV4dCgpLmdldFJlcXVlc3QoKQ0KDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwID0gSGFzaE1hcCg
 pDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgic2VydmljZSIsIGh0dHBTZXJ2aWNlLmNvbn
 N0cnVjdFNlcnZlclVybChyZXF1ZXN0KSArICIvcG9zdGxvZ2luIikNCiAgICAgICAgICAgIGlmIChjY
 XNfcmVuZXdfb3B0KToNCiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgicmVuZXciLCAi
 dHJ1ZSIpDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgidGlja2V0IiwgdGlja2V0KQ0KICA
 gICAgICAgICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UucG
 FyYW1ldGVyc0FzU3RyaW5nKHBhcmFtZXRlcnNNYXApDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZ
 XF1ZXN0X3VyaSA9IGNhc19ob3N0ICsgIi9zZXJ2aWNlVmFsaWRhdGU/IiArIGNhc19zZXJ2aWNlX3Jl
 cXVlc3RfdXJpDQogICAgICAgICAgICBpZiAoY2FzX2V4dHJhX29wdHMgIT0gTm9uZSk6DQogICAgICA
 gICAgICAgICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaS
 ArICImIiArIGNhc19leHRyYV9vcHRzDQoNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50a
 WNhdGUgZm9yIHN0ZXAgMS4gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmk6ICIgKyBjYXNfc2VydmljZV9y
 ZXF1ZXN0X3VyaQ0KDQogICAgICAgICAgICBodHRwX2NsaWVudCA9IGh0dHBTZXJ2aWNlLmdldEh0dHB
 zQ2xpZW50KCk7DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzcG9uc2UgPSBodHRwU2VydmljZS
 5leGVjdXRlR2V0KGh0dHBfY2xpZW50LCBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSkNCiAgICAgICAgI
 CAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fY29udGVudCA9
 IGh0dHBTZXJ2aWNlLmNvbnZlcnRFbnRpdHlUb1N0cmluZyhodHRwU2VydmljZS5nZXRSZXNwb25zZUN
 vbnRlbnQoaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmdldEh0dHBSZXNwb25zZSgpKSkNCiAgICAgICAgIC
 AgIGZpbmFsbHk6DQogICAgICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlLmNsb3NlQ29ub
 mVjdGlvbigpDQoNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAg
 MS4gdmFsaWRhdGlvbl9jb250ZW50OiAiICsgdmFsaWRhdGlvbl9jb250ZW50DQogICAgICAgICAgICB
 pZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh2YWxpZGF0aW9uX2NvbnRlbnQpOg0KICAgICAgICAgICAgIC
 AgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGlja2V0IHZhbGlkYXRpb24gc
 mVzcG9uc2UgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAg
 ICAgICAgY2FzMl9hdXRoX2ZhaWx1cmUgPSBzZWxmLnBhcnNlX3RhZyh2YWxpZGF0aW9uX2NvbnRlbnQ
 sICJjYXM6YXV0aGVudGljYXRpb25GYWlsdXJlIikNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gY2FzMl9hdXRoX2ZhaWx1cmU6ICIsIGNhczJfYXV0aF9mYWlsd
 XJlDQoNCiAgICAgICAgICAgIGNhczJfdXNlcl91aWQgPSBzZWxmLnBhcnNlX3RhZyh2YWxpZGF0aW9u
 X2NvbnRlbnQsICJjYXM6dXNlciIpDQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXR
 lIGZvciBzdGVwIDEuIGNhczJfdXNlcl91aWQ6ICIsIGNhczJfdXNlcl91aWQNCiAgICAgICAgICAgIA
 0KICAgICAgICAgICAgaWYgKChjYXMyX2F1dGhfZmFpbHVyZSAhPSBOb25lKSBvciAoY2FzMl91c2VyX
 3VpZCA9PSBOb25lKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBm
 b3Igc3RlcCAxLiBUaWNrZXQgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2U
 NCg0KICAgICAgICAgICAgaWYgKGNhc19tYXBfdXNlcik6DQogICAgICAgICAgICAgICAgcHJpbnQgIk
 NBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBve
 EV4dGVybmFsVWlkOiBjYXMyOiIgKyBjYXMyX3VzZXJfdWlkDQoNCiAgICAgICAgICAgICAgICAjIENo
 ZWNrIGlmIHRoZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGNhczJfdXNlcl91aWQNCiAgICAgICAgICA
 gICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveE
 V4dGVybmFsVWlkIiwgImNhczI6IiArIGNhczJfdXNlcl91aWQpDQoNCiAgICAgICAgICAgICAgICBpZ
 iAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNB
 UzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgICA
 gICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY2
 91bnQgc3RlcHMgdG8gMiINCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImNhczJfY291b
 nRfbG9naW5fc3RlcHMiLCAyKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl91
 c2VyX3VpZCIsIGNhczJfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQo
 NCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZX
 JJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxL
 iBmb3VuZF91c2VyX25hbWU6ICIgKyBmb3VuZF91c2VyX25hbWUNCg0KICAgICAgICAgICAgICAgIGNy
 ZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICA
 gICAgICAgY3JlZGVudGlhbHMuc2V0VXNlcm5hbWUoZm91bmRfdXNlcl9uYW1lKQ0KICAgICAgICAgIC
 AgICAgIGNyZWRlbnRpYWxzLnNldFVzZXIoZmluZF91c2VyX2J5X3VpZCkNCiAgICAgICAgICAgIA0KI
 CAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGlu
 ZyBjb3VudCBzdGVwcyB0byAxIg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjYXMyX2NvdW5
 0X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIC
 AgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiIgKyBjYXMyX3VzZXJfdWlkDQoNCiAg
 ICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGNhczJfdXN
 lcl91aWQNCiAgICAgICAgICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VX
 NlcihjYXMyX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09I
 E5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBz
 dGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWx
 zZQ0KDQogICAgICAgICAgICAgICAgZm91bmRfdXNlcl9uYW1lID0gZmluZF91c2VyX2J5X3VpZC5nZX
 RVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0Z
 XAgMS4gZm91bmRfdXNlcl9uYW1lOiAiICsgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAg
 ICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICA
 gICAgICAgICAgIGNyZWRlbnRpYWxzLnNldFVzZXJuYW1lKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgIC
 AgICAgICAgICBjcmVkZW50aWFscy5zZXRVc2VyKGZpbmRfdXNlcl9ieV91aWQpDQoNCiAgICAgICAgI
 CAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQg
 c3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl9jb3VudF9sb2dpbl9
 zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdG
 VwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyI
 g0KDQogICAgICAgICAgICBzZXNzaW9uQXR0cmlidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0
 cmlidXRlcyIpDQogICAgICAgICAgICBpZiAoc2Vzc2lvbkF0dHJpYnV0ZXMgPT0gTm9uZSkgb3Igbm9
 0IHNlc3Npb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjYXMyX3VzZXJfdWlkIik6DQogICAgICAgIC
 AgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBjYXMyX3VzZXJfdWlkI
 GlzIGVtcHR5Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBjYXMy
 X3VzZXJfdWlkID0gc2Vzc2lvbkF0dHJpYnV0ZXMuZ2V0KCJjYXMyX3VzZXJfdWlkIikNCiAgICAgICA
 gICAgIHBhc3NlZF9zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKGNhczJfdXNlcl
 91aWQpDQogICAgICAgICAgICBpZiAobm90IHBhc3NlZF9zdGVwMSk6DQogICAgICAgICAgICAgICAgc
 mV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2Uo
 KS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXR
 Vc2VybmFtZSgpDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3
 dvcmQoKQ0KDQogICAgICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0c
 mluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05v
 dEVtcHR5U3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB
 1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgIC
 AgICAgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aGljaCBoYXMgY2FzMl91c2VyX3Vp
 ZA0KICAgICAgICAgICAgIyBBdm9pZCBtYXBwaW5nIENBUzIgYWNjb3VudCB0byBtb3JlIHRoYW4gb25
 lIElEUCBhY2NvdW50DQogICAgICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2
 V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImNhczI6IiArIGNhczJfdXNlcl91aWQpD
 QoNCiAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAg
 ICAgICMgQWRkIGNhczJfdXNlcl91aWQgdG8gdXNlciBvbmUgaWQgVUlEcw0KICAgICAgICAgICAgICA
 gIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJfbmFtZS
 wgIm94RXh0ZXJuYWxVaWQiLCAiY2FzMjoiICsgY2FzMl91c2VyX3VpZCkNCiAgICAgICAgICAgICAgI
 CBpZiAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQg
 IkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQgdXN
 lciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICByZX
 R1cm4gVHJ1ZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hb
 WUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkNB
 UzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBmb3VuZF91c2VyX25hbWU6ICIgKyBmb3VuZF91c2V
 yX25hbWUNCiAgICANCiAgICAgICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbm
 FtZSwgZm91bmRfdXNlcl9uYW1lKToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgI
 CAgICAgDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb2
 50ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBd
 XRoZW50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBT
 ZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgICAgICAgY2FzX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cml
 idXRlcy5nZXQoImNhc19ob3N0IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgY2FzX3JlbmV3X29wdCA9IF
 N0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXNfcmVuZ
 Xdfb3B0IikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgIGNhc19leHRyYV9vcHRzID0gTm9u
 ZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNhc19leHR
 yYV9vcHRzIikpOg0KICAgICAgICAgICAgY2FzX2V4dHJhX29wdHMgPSBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5nZXQoImNhc19leHRyYV9vcHRzIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBpZiAoc3Rlc
 CA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBQcmVwYXJlIGZvciBzdGVwIDEiDQoNCiAg
 ICAgICAgICAgIHJlcXVlc3QgPSBGYWNlc0NvbnRleHQuZ2V0Q3VycmVudEluc3RhbmNlKCkuZ2V0RXh
 0ZXJuYWxDb250ZXh0KCkuZ2V0UmVxdWVzdCgpDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwID0gSG
 FzaE1hcCgpDQogICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgic2VydmljZSIsIGh0dHBTZXJ2a
 WNlLmNvbnN0cnVjdFNlcnZlclVybChyZXF1ZXN0KSArICIvcG9zdGxvZ2luIikNCiAgICAgICAgICAg
 IGlmIChjYXNfcmVuZXdfb3B0KToNCiAgICAgICAgICAgICAgICBwYXJhbWV0ZXJzTWFwLnB1dCgicmV
 uZXciLCAidHJ1ZSIpDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9IGF1dGhlbn
 RpY2F0aW9uU2VydmljZS5wYXJhbWV0ZXJzQXNTdHJpbmcocGFyYW1ldGVyc01hcCkNCiAgICAgICAgI
 CAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gY2FzX2hvc3QgKyAiL2xvZ2luPyIgKyBjYXNfc2Vy
 dmljZV9yZXF1ZXN0X3VyaQ0KICAgICAgICAgICAgaWYgY2FzX2V4dHJhX29wdHMgIT0gTm9uZToNCiA
 gICAgICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9IGNhc19zZXJ2aWNlX3JlcXVlc3
 RfdXJpICsgIiYiICsgY2FzX2V4dHJhX29wdHMNCg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIFByZ
 XBhcmUgZm9yIHN0ZXAgMS4gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmk6ICIgKyBjYXNfc2VydmljZV9y
 ZXF1ZXN0X3VyaQ0KDQogICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzX3NlcnZpY2VfcmVxdWVzdF9
 1cmkiLCBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCi
 AgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBQcmVwYXJlI
 GZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAg
 ICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHN
 lbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMi
 k6DQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgiY2FzMl91c2VyX3VpZCIpDQogICAgI
 CAgIA0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25T
 dGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNvbnRleHQgPSBDb25
 0ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBpZiAoY29udGV4dC5pc1NldCgiY2FzMl9jb3
 VudF9sb2dpbl9zdGVwcyIpKToNCiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmdldCgiY2FzMl9jb
 3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdl
 dFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICA
 gaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZXR1cm4gIi9hdXRoL2NhczIvY2FzMmxvZ2luLn
 hodG1sIg0KICAgICAgICByZXR1cm4gIi9hdXRoL2NhczIvY2FzMnBvc3Rsb2dpbi54aHRtbCINCg0KI
 CAgIGRlZiBwYXJzZV90YWcoc2VsZiwgc3RyLCB0YWcpOg0KICAgICAgICB0YWcxX3BvczEgPSBzdHIu
 ZmluZCgiPCIgKyB0YWcpDQogICAgICAgICMgIE5vIHRhZyBmb3VuZCwgcmV0dXJuIGVtcHR5IHN0cml
 uZy4NCiAgICAgICAgaWYgdGFnMV9wb3MxID09IC0xOiByZXR1cm4gTm9uZQ0KICAgICAgICB0YWcxX3
 BvczIgPSBzdHIuZmluZCgiPiIsIHRhZzFfcG9zMSkNCiAgICAgICAgaWYgdGFnMV9wb3MyID09IC0xO
 iByZXR1cm4gTm9uZQ0KICAgICAgICB0YWcyX3BvczEgPSBzdHIuZmluZCgiPC8iICsgdGFnLCB0YWcx
 X3BvczIpDQogICAgICAgIGlmIHRhZzJfcG9zMSA9PSAtMTogcmV0dXJuIE5vbmUNCg0KICAgICAgICB
 yZXR1cm4gc3RyW3RhZzFfcG9zMisxOnRhZzJfcG9zMV0uc3RyaXAoKQ0KDQogICAgZGVmIGxvZ291dC
 hzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgI
 CByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!7523.8F2D,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Google+ authentication module
displayName: gplus
gluuStatus: false
inum: %(inumOrg)s!0011!7523.8F2D
oxConfigurationProperty: {"value1":"gplus_client_secrets_file","value2":"/et
 c/certs/gplus_client_secrets.json","description":""}
oxConfigurationProperty: {"value1":"gplus_deployment_type","value2":"enroll"
 ,"description":""}
oxConfigurationProperty: {"value1":"gplus_remote_attributes_list","value2":"
 email, email, name, family_name, given_name, locale","description":""}
oxConfigurationProperty: {"value1":"gplus_local_attributes_list","value2":"u
 id, mail, givenName, sn, cn, preferredLanguage","description":""}
oxLevel: 40
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4d
 HMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4
 LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3R
 vbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3
 JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudFNlcnZpY2UsIEF1d
 GhlbnRpY2F0aW9uU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwg
 QXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdCwgSGFzaE1
 hcCwgSWRlbnRpdHlIYXNoTWFwDQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBpbXBvcn
 QgVXNlcg0KZnJvbSBvcmcueGRpLm94YXV0aC5jbGllbnQgaW1wb3J0IFRva2VuQ2xpZW50LCBUb2tlb
 lJlcXVlc3QsIFVzZXJJbmZvQ2xpZW50DQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBp
 bXBvcnQgR3JhbnRUeXBlLCBBdXRoZW50aWNhdGlvbk1ldGhvZA0KZnJvbSBvcmcueGRpLm94YXV0aC5
 tb2RlbC5qd3QgaW1wb3J0IEp3dCwgSnd0Q2xhaW1OYW1lDQoNCmltcG9ydCBqYXZhDQoNCnRyeToNCi
 AgICBpbXBvcnQganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uI
 GFzIGpzb24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25U
 eXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICB
 zZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KH
 NlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pd
 GlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250
 YWluc0tleSgiZ3BsdXNfY2xpZW50X3NlY3JldHNfZmlsZSIpKToNCiAgICAgICAgICAgIHByaW50ICJ
 Hb29nbGUrIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgZ3BsdXNfY2xpZW50X3NlY3JldHNfZm
 lsZSBpcyBlbXB0eSINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgI
 CAgIGNsaWVudFNlY3JldHNGaWxlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19j
 bGllbnRfc2VjcmV0c19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgc2VsZi5jbGllbnRTZWNyZXR
 zID0gc2VsZi5sb2FkQ2xpZW50U2VjcmV0cyhjbGllbnRTZWNyZXRzRmlsZSkNCiAgICAgICAgaWYgKH
 NlbGYuY2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIElua
 XRpYWxpemF0aW9uLiBGaWxlIHdpdGggR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBzaG91bGQgYmUgbm90
 IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5hdHRyaWJ1dGV
 zTWFwcGluZyA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW
 5zS2V5KCJncGx1c19yZW1vdGVfYXR0cmlidXRlc19saXN0IikgYW5kDQogICAgICAgICAgICBjb25ma
 Wd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfbG9jYWxfYXR0cmlidXRlc19saXN0
 IikpOg0KDQogICAgICAgICAgICByZW1vdGVBdHRyaWJ1dGVzTGlzdCA9IGNvbmZpZ3VyYXRpb25BdHR
 yaWJ1dGVzLmdldCgiZ3BsdXNfcmVtb3RlX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogIC
 AgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkocmVtb3RlQXR0cmlidXRlc0xpc3QpKToNC
 iAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5
 IGdwbHVzX3JlbW90ZV9hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV
 0dXJuIEZhbHNlICAgIA0KDQogICAgICAgICAgICBsb2NhbEF0dHJpYnV0ZXNMaXN0ID0gY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1Z
 TIoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KGxvY2FsQXR0cmlidXRlc0xp
 c3QpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHB
 yb3BlcnR5IGdwbHVzX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9IHNlb
 GYucHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5nKHJlbW90ZUF0dHJpYnV0ZXNMaXN0LCBsb2NhbEF0dHJp
 YnV0ZXNMaXN0KQ0KICAgICAgICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk
 6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIFRoZSBhdHRyaW
 J1dGVzIG1hcHBpbmcgaXNuJ3QgdmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgc2VsZi5leHRlbnNpb25Nb2R1bGUgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0
 aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZXh0ZW5zaW9uX21vZHVsZSIpKToNCiAgICAgICAgICA
 gIGV4dGVuc2lvbk1vZHVsZU5hbWUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImV4dGVuc2
 lvbl9tb2R1bGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgI
 HNlbGYuZXh0ZW5zaW9uTW9kdWxlID0gX19pbXBvcnRfXyhleHRlbnNpb25Nb2R1bGVOYW1lKQ0KICAg
 ICAgICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZUluaXRSZXN1bHQgPSBzZWxmLmV4dGVuc2lvbk1vZHV
 sZS5pbml0KGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3QgZX
 h0ZW5zaW9uTW9kdWxlSW5pdFJlc3VsdCk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZ
 Q0KICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yLCBleDoNCiAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gRmFpbGVkIHRvIGxvYWQgZ3BsdXNfZXh0ZW5zaW9uX21
 vZHVsZToiLCBleHRlbnNpb25Nb2R1bGVOYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZS
 sgSW5pdGlhbGl6YXRpb24uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiAgICAgICAgICAgICAgICByZ
 XR1cm4gRmFsc2UNCg0KICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXplZCBzdWNjZXNzZnVs
 bHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBhdXRoQ29
 uZmlndXJhdGlvbik6DQogICAgICAgIHByaW50ICJHb29nbGUrIERlc3Ryb3kiDQogICAgICAgIHByaW
 50ICJHb29nbGUrIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvb
 ihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25N
 ZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJ
 ldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZW
 xmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vb
 mUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJl
 cXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW5
 0Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2
 VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY
 2UoKQ0KDQogICAgICAgIG1hcFVzZXJEZXBsb3ltZW50ID0gRmFsc2UNCiAgICAgICAgZW5yb2xsVXNl
 ckRlcGxveW1lbnQgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29
 udGFpbnNLZXkoImdwbHVzX2RlcGxveW1lbnRfdHlwZSIpKToNCiAgICAgICAgICAgIGRlcGxveW1lbn
 RUeXBlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdld
 CgiZ3BsdXNfZGVwbG95bWVudF90eXBlIikuZ2V0VmFsdWUyKCkpDQogICAgICAgICAgICANCiAgICAg
 ICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgIm1
 hcCIpKToNCiAgICAgICAgICAgICAgICBtYXBVc2VyRGVwbG95bWVudCA9IFRydWUNCiAgICAgICAgIC
 AgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgImVucm9sb
 CIpKToNCiAgICAgICAgICAgICAgICBlbnJvbGxVc2VyRGVwbG95bWVudCA9IFRydWUNCg0KICAgICAg
 ICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxIg0KIA0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZUFycmF5ID0gcmVxdWVzdFBhcm
 FtZXRlcnMuZ2V0KCJncGx1c19hdXRoX2NvZGUiKQ0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZSA9I
 GdwbHVzQXV0aENvZGVBcnJheVswXQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHVzZXIgdXNlcyBi
 YXNpYyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBGYWxzZQ0KICA
 gICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5U3RyaW5nKGdwbHVzQXV0aENvZGUpKToNCi
 AgICAgICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBUcnVlDQoNCiAgICAgICAgICAgICMgVXNlIGJhc
 2ljIG1ldGhvZCB0byBsb2cgaW4NCiAgICAgICAgICAgIGlmICh1c2VCYXNpY0F1dGgpOg0KICAgICAg
 ICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBCYXNpYyBhdXR
 oZW50aWNhdGlvbiINCiAgICAgICAgDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2
 NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCiAgICAgICAgDQogICAgICAgICAgICAgICAgY3JlZGVudGlhb
 HMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICB1
 c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgICAgICB1c2VyUGF
 zc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQogICAgICAgIA0KICAgICAgICAgICAgIC
 AgIGxvZ2dlZEluID0gRmFsc2UNCiAgICAgICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90R
 W1wdHlTdHJpbmcodXNlck5hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2Vy
 UGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5
 pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlZEluID0gdXNlclNlcnZpY2UuYXV0aG
 VudGljYXRlKHVzZXJOYW1lLCB1c2VyUGFzc3dvcmQpDQogICAgICAgIA0KICAgICAgICAgICAgICAgI
 GlmIChub3QgbG9nZ2VkSW4pOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAg
 ICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgIyBVc2UgR29vZ2x
 lKyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdG
 UgZm9yIHN0ZXAgMS4gZ3BsdXNBdXRoQ29kZToiLCBncGx1c0F1dGhDb2RlDQoNCiAgICAgICAgICAgI
 GN1cnJlbnRDbGllbnRTZWNyZXRzID0gc2VsZi5nZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLmNs
 aWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCiA
 gICAgICAgICAgIGlmIChjdXJyZW50Q2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIC
 AgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQ2xpZW50IHNlY3JldHMgY
 29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAg
 ICAgICAgICAgDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXA
 gMS4gQXR0ZW1wdGluZyB0byBnZXRzIHRva2VucyINCiAgICAgICAgICAgIHRva2VuUmVzcG9uc2UgPS
 BzZWxmLmdldFRva2Vuc0J5Q29kZShzZWxmLmNsaWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRya
 WJ1dGVzLCBncGx1c0F1dGhDb2RlKTsNCiAgICAgICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBO
 b25lKSBvciAodG9rZW5SZXNwb25zZS5nZXRJZFRva2VuKCkgPT0gTm9uZSkgb3IgKHRva2VuUmVzcG9
 uc2UuZ2V0QWNjZXNzVG9rZW4oKSA9PSBOb25lKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2
 dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdG9rZW5zIg0KICAgICAgI
 CAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdG9
 rZW5zIg0KDQogICAgICAgICAgICBqd3QgPSBKd3QucGFyc2UodG9rZW5SZXNwb25zZS5nZXRJZFRva2
 VuKCkpDQogICAgICAgICAgICAjIFRPRE86IFZhbGlkYXRlIElEIFRva2VuIFNpZ25hdHVyZSAgDQoNC
 iAgICAgICAgICAgIGdwbHVzVXNlclVpZCA9IGp3dC5nZXRDbGFpbXMoKS5nZXRDbGFpbUFzU3RyaW5n
 KEp3dENsYWltTmFtZS5TVUJKRUNUX0lERU5USUZJRVIpOw0KICAgICAgICAgICAgcHJpbnQgIkdvb2d
 sZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZvdW5kIEdvb2dsZSB1c2VyIElEIGluIHRoZSBJRC
 B0b2tlbjogIiwgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChtYXBVc
 2VyRGVwbG95bWVudCk6DQogICAgICAgICAgICAgICAgIyBVc2UgbWFwcGluZyB0byBsb2NhbCBJRFAg
 dXNlcg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCA
 xLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBncGx1czoiLCBncGx1c1
 VzZXJVaWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aXRoIHNwZ
 WNpZmllZCBncGx1c1VzZXJVaWQNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2Vydmlj
 ZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclV
 pZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgIC
 AgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZ
 mluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUg
 Zm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgICAgICAgICAgICAgICB
 jb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAyKQ0KICAgICAgICAgICAgICAgIC
 AgICBjb250ZXh0LnNldCgiZ3BsdXNfdXNlcl91aWQiLCBncGx1c1VzZXJVaWQpDQogICAgICAgICAgI
 CAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXJOYW1lID0gZm91
 bmRVc2VyLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGl
 jYXRlIGZvciBzdGVwIDEuIGZvdW5kVXNlck5hbWU6IiwgZm91bmRVc2VyTmFtZQ0KICAgICAgICAgIC
 AgICAgIA0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZ
 XJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2Vy
 QXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGU
 rIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgI
 CAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3Rl
 cHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3R
 lcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb2
 5Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgI
 CAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0
 OiIsIHBvc3RMb2dpblJlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3V
 sdA0KICAgICAgICAgICAgZWxpZiAoZW5yb2xsVXNlckRlcGxveW1lbnQpOg0KICAgICAgICAgICAgIC
 AgICMgVXNlIGF1dG8gZW5yb2xsbWVudCB0byBsb2NhbCBJRFANCiAgICAgICAgICAgICAgICBwcmlud
 CAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIg
 Ynkgb3hFeHRlcm5hbFVpZDogZ3BsdXM6IiwgZ3BsdXNVc2VyVWlkDQogDQogICAgICAgICAgICAgICA
 gIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGdwbHVzVXNlclVpZA0KICAgIC
 AgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFe
 HRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgIGlm
 IChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICMgQXV0byB1c2VyIGVucm9
 sbGVtbnQNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvci
 BzdGVwIDEuIFRoZXJlIGlzIG5vIHVzZXIgaW4gTERBUC4gQWRkaW5nIHVzZXIgdG8gbG9jYWwgTERBU
 CINCg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0
 ZXAgMS4gQXR0ZW1wdGluZyB0byBnZXRzIHVzZXIgaW5mbyINCiAgICAgICAgICAgICAgICAgICAgdXN
 lckluZm9SZXNwb25zZSA9IHNlbGYuZ2V0VXNlckluZm8oY3VycmVudENsaWVudFNlY3JldHMsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB0b2tlblJlc3BvbnNlLmdldEFjY2Vzc1Rva2VuKCkpDQogICAgI
 CAgICAgICAgICAgICAgIGlmICgodXNlckluZm9SZXNwb25zZSA9PSBOb25lKSBvciAodXNlckluZm9S
 ZXNwb25zZS5nZXRDbGFpbXMoKS5zaXplKCkgPT0gMCkpOg0KICAgICAgICAgICAgICAgICAgICAgICA
 gcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdXNlci
 BpbmZvIg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgI
 CAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50
 aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdXNlciBpbmZvIg0KICAgICAgICAgICA
 gICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZ3BsdXNSZXNwb25zZUF0dHJpYnV0ZXMgPSB1c2
 VySW5mb1Jlc3BvbnNlLmdldENsYWltcygpDQogDQogICAgICAgICAgICAgICAgICAgICMgQ29udmVyd
 CBHb29nbGUrIHVzZXIgY2xhaW1zIHRvIGxvdmVyIGNhc2UNCiAgICAgICAgICAgICAgICAgICAgZ3Bs
 dXNSZXNwb25zZU5vcm1hbGl6ZWRBdHRyaWJ1dGVzID0gSGFzaE1hcCgpDQogICAgICAgICAgICAgICA
 gICAgIGZvciBncGx1c1Jlc3BvbnNlQXR0cmlidXRlRW50cnkgaW4gZ3BsdXNSZXNwb25zZUF0dHJpYn
 V0ZXMuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdwbHVzUmVzcG9uc2VOb3JtY
 WxpemVkQXR0cmlidXRlcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVs
 cGVyLnRvTG93ZXJDYXNlKGdwbHVzUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRLZXkoKSksIGdwbHV
 zUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRWYWx1ZSgpKQ0KIA0KICAgICAgICAgICAgICAgICAgIC
 BjdXJyZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLmdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZ
 yhzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBh
 cmFtZXRlcnMpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBVc2luZyBuZXh0IGF0dHJpYnV0ZXMgbWFwcGluZyIsIGN1cnJlbnRBdHRyaWJ1dG
 VzTWFwcGluZw0KIA0KICAgICAgICAgICAgICAgICAgICBuZXdVc2VyID0gVXNlcigpDQogICAgICAgI
 CAgICAgICAgICAgIGZvciBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5IGluIGN1cnJlbnRBdHRyaWJ1dGVz
 TWFwcGluZy5lbnRyeVNldCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3RlQXR0cmlidXR
 lID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRLZXkoKQ0KICAgICAgICAgICAgICAgICAgICAgIC
 AgbG9jYWxBdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5LmdldFZhbHVlKCkNCiANCiAgI
 CAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBncGx1c1Jlc3BvbnNlTm9y
 bWFsaXplZEF0dHJpYnV0ZXMuZ2V0KHJlbW90ZUF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICAgICA
 gICAgIGlmIChsb2NhbEF0dHJpYnV0ZSAhPSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIC
 AgICBuZXdVc2VyLnNldEF0dHJpYnV0ZShsb2NhbEF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGVWYWx1Z
 SkNCiANCiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1VzZXIuZ2V0QXR0cmlidXRlKCJzbiIpID09
 IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5zZXRBdHRyaWJ1dGUoInNuIiw
 gZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgICAgICBpZiAobmV3VXNlci5nZXRBdHRyaW
 J1dGUoImNuIikgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEF0d
 HJpYnV0ZSgiY24iLCBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5z
 ZXRBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclVpZCkNCiAgICA
 gICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dG
 VtcHRpbmcgdG8gYWRkIHVzZXIiLCBncGx1c1VzZXJVaWQsICIgd2l0aCBuZXh0IGF0dHJpYnV0ZXMiL
 CBuZXdVc2VyLmdldEN1c3RvbUF0dHJpYnV0ZXMoKQ0KIA0KICAgICAgICAgICAgICAgICAgICBmb3Vu
 ZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZXIsIFRydWUpDQogICAgICAgICAgICAgICA
 gICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBZGRlZCBuZXcgdXNlci
 B3aXRoIFVJRCIsIGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KDQogICAgICAgICAgICAgICAgZm91bmRVc
 2VyTmFtZSA9IGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29n
 bGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZFVzZXJOYW1lOiIsIGZvdW5kVXNlck5hbWU
 NCg0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZXJ2aW
 NlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2VyQXV0a
 GVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1
 dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICA
 gICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZS
 sgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgI
 CAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAg
 ICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb25Qb3N0TG9naW4oY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2
 xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0OiIsIHBvc3RMb2dpblJlc
 3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICAgICAg
 ZWxzZToNCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIHVzZXIgd2l0aCBzcGVjaWZ
 pZWQgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYX
 RlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IHVpZDoiLCBncGx1c1VzZXJVa
 WQNCg0KICAgICAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXIoZ3BsdXNV
 c2VyVWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICA
 gICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG
 8gZmluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgI
 CAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAg
 ICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRVc2VyTmFtZToiLCB
 mb3VuZFVzZXJOYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyQXV0aGVudGljYXRlZCA9IGF1dGhlbn
 RpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRVc2VyTmFtZSkNCiAgICAgICAgICAgICAgI
 CBpZiAodXNlckF1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICAgICAgICAgICAgICAgICBwcmlu
 dCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB
 1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIH
 ByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzI
 HRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBz
 IiwgMSkNCg0KICAgICAgICAgICAgICAgIHBvc3RMb2dpblJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9
 zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3VuZFVzZXIpDQogICAgICAgICAgICAgIC
 AgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RMb2dpblJlc3VsdDoiL
 CBwb3N0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQN
 CiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZXNzaW9uQXR0cm
 lidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0cmlidXRlcyIpDQogICAgICAgICAgICBpZiAoc
 2Vzc2lvbkF0dHJpYnV0ZXMgPT0gTm9uZSkgb3Igbm90IHNlc3Npb25BdHRyaWJ1dGVzLmNvbnRhaW5z
 S2V5KCJncGx1c191c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGh
 lbnRpY2F0ZSBmb3Igc3RlcCAyLiBncGx1c191c2VyX3VpZCBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgZ3BsdXNVc2VyVWlkID0gc2Vzc2lvbkF0dHJpY
 nV0ZXMuZ2V0KCJncGx1c191c2VyX3VpZCIpDQogICAgICAgICAgICBwYXNzZWRfc3RlcDEgPSBTdHJp
 bmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhncGx1c1VzZXJVaWQpDQogICAgICAgICAgICBpZiAobm9
 0IHBhc3NlZF9zdGVwMSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgIC
 AgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgI
 CAgICAgICB1c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVz
 ZXJQYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2V
 kSW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKH
 VzZXJOYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlclBhc3N3b3JkKSk6D
 QogICAgICAgICAgICAgICAgbG9nZ2VkSW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlck5h
 bWUsIHVzZXJQYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRJbik6DQogICAgICA
 gICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdX
 NlciB3aGljaCBoYXMgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgR29vZ
 2xlIGFjY291bnQgdG8gbW9yZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAgICAgICAgICAgZm91bmRV
 c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImdwbHV
 zOiIgKyBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQ
 ogICAgICAgICAgICAgICAgIyBBZGQgZ3BsdXNVc2VyVWlkIHRvIHVzZXIgb25lIGlkIFVJRHMNCiAgI
 CAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJO
 YW1lLCAib3hFeHRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KICAgICAgICAgICA
 gICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb2
 9nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQgdXNlc
 iINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBwb3N0
 TG9naW5SZXN1bHQgPSBzZWxmLmV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXR
 lcywgZm91bmRVc2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZS
 Bmb3Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQoNCiAgICAgICAgI
 CAgICAgICByZXR1cm4gcG9zdExvZ2luUmVzdWx0DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAg
 ICAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICA
 gICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gZm91bmRVc2VyTmFtZToiLC
 Bmb3VuZFVzZXJOYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFsc
 yh1c2VyTmFtZSwgZm91bmRVc2VyTmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RMb2dpblJl
 c3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3V
 uZFVzZXIpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3
 Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdWx0DQogICAgDQogICAgICAgI
 CAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgICAgICAgDQogICAgICAgICAgICBy
 ZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UG
 FyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRle
 HQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2Uu
 aW5zdGFuY2UoKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkd
 vb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBjdXJyZW
 50Q2xpZW50U2VjcmV0cyA9IHNlbGYuZ2V0Q3VycmVudENsaWVudFNlY3JldHMoc2VsZi5jbGllbnRTZ
 WNyZXRzLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAg
 ICAgICBpZiAoY3VycmVudENsaWVudFNlY3JldHMgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJ
 pbnQgIkdvb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxLiBHb29nbGUrIGNsaWVudCBjb25maWd1cmF0aW
 9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICANC
 iAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jbGllbnRfaWQiLCBjdXJyZW50Q2xpZW50U2Vj
 cmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2N
 saWVudF9zZWNyZXQiLCBjdXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9zZWNyZXQiXS
 kNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgI
 CAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAg
 cmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICA
 gZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZX
 MsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHJldHVybiBBcnJhe
 XMuYXNMaXN0KCJncGx1c191c2VyX3VpZCIpDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRl
 ZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 pOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaW
 YgKGNvbnRleHQuaXNTZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIikpOg0KICAgICAgICAgICAgc
 mV0dXJuIGNvbnRleHQuZ2V0KCJncGx1c19jb3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAg
 ICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZX
 R1cm4gIi9hdXRoL2dwbHVzL2dwbHVzbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0a
 C9ncGx1cy9ncGx1c3Bvc3Rsb2dpbi54aHRtbCINCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmln
 dXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgIyBUT0RPIFJldm9
 rZSB0b2tlbg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGxvYWRDbGllbnRTZWNyZXRzKH
 NlbGYsIGNsaWVudFNlY3JldHNGaWxlKToNCiAgICAgICAgY2xpZW50U2VjcmV0cyA9IE5vbmUNCg0KI
 CAgICAgICAjIExvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlDQogICAgICAgIGYgPSBvcGVuKGNsaWVu
 dFNlY3JldHNGaWxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNsaWVudFNlY3JldHM
 gPSBqc29uLmxvYWRzKGYucmVhZCgpKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludC
 AiRmFpbGVkIHRvIGxvYWQgR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBmcm9tIGZpbGU6IiwgY2xpZW50U
 2VjcmV0cw0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxseToNCiAgICAgICAg
 ICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGNsaWVudFNlY3JldHMNCg0KICA
 gIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLC
 ByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVudCBjb25maWd1cmF0aW9uDQogI
 CAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfY2xpZW50
 X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRlIikpOg0KICAgICAgICAgICAgY2xpZW50Q29uZmlndXJhdGl
 vbkF0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZ3BsdXNfY2xpZW50X2Nvbm
 ZpZ3VyYXRpb25fYXR0cmlidXRlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHByaW50ICJHb29nb
 GUrIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhdHRyaWJ1dGU6IiwgY2xpZW50
 Q29uZmlndXJhdGlvbkF0dHJpYnV0ZQ0KDQogICAgICAgICAgICBpZiAocmVxdWVzdFBhcmFtZXRlcnM
 gPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW
 50SWQgPSBOb25lDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pb
 mUgY2xpZW50X2lkIGZyb20gcmVxdWVzdA0KICAgICAgICAgICAgY2xpZW50SWRBcnJheSA9IHJlcXVl
 c3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmIChBcnJheUhlbHBlci5
 pc05vdEVtcHR5KGNsaWVudElkQXJyYXkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZy
 hjbGllbnRJZEFycmF5WzBdKSk6DQogICAgICAgICAgICAgICAgY2xpZW50SWQgPSBjbGllbnRJZEFyc
 mF5WzBdDQoNCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pbmUgY2xpZW50X2lkIGZyb20g
 ZXZlbnQgY29udGV4dA0KICAgICAgICAgICAgaWYgKGNsaWVudElkID09IE5vbmUpOg0KICAgICAgICA
 gICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIC
 AgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKSk6DQogICAgI
 CAgICAgICAgICAgICAgIGNsaWVudElkID0gZXZlbnRDb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0
 ZXMiKS5nZXQoImNsaWVudF9pZCIpDQoNCiAgICAgICAgICAgIGlmIChjbGllbnRJZCA9PSBOb25lKTo
 NCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBjbG
 llbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgI
 CAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgY2xp
 ZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50SWQpDQogICAgICAgICAgICBpZiAoY2x
 pZW50ID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldENsaWVudENvbm
 ZpZ3VyYXRpb24uIEZhaWxlZCB0byBmaW5kIGNsaWVudCIsIGNsaWVudElkLCAiIGluIGxvY2FsIExEQ
 VAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50Q29uZmln
 dXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGNsaWVudCwgY2xpZW50Q29
 uZmlndXJhdGlvbkF0dHJpYnV0ZSkNCiAgICAgICAgICAgIGlmICgoY2xpZW50Q29uZmlndXJhdGlvbi
 A9PSBOb25lKSBvciBTdHJpbmdIZWxwZXIuaXNFbXB0eShjbGllbnRDb25maWd1cmF0aW9uLmdldFZhb
 HVlKCkpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0
 aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhdHRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR
 0cmlidXRlLCAiIGlzIGVtcHR5Ig0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcm
 ludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhd
 HRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlLCAiIGlzIiwgY2xpZW50Q29uZmln
 dXJhdGlvbg0KICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRDb25maWd1cmF0aW9uDQoNCiAgICA
 gICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLCBjdX
 JyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0Z
 XJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJh
 dGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGl
 mIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbn
 RDbGllbnRTZWNyZXRzDQogICAgICAgIA0KICAgICAgICBjbGllbnRDb25maWd1cmF0aW9uVmFsdWUgP
 SBqc29uLmxvYWRzKGNsaWVudENvbmZpZ3VyYXRpb24uZ2V0VmFsdWUoKSkNCg0KICAgICAgICByZXR1
 cm4gY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1cyJdDQoNCiAgICBkZWYgZ2V0Q3VycmVudEF
 0dHJpYnV0ZXNNYXBwaW5nKHNlbGYsIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdG
 lvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhd
 GlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywg
 cmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmU
 pOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KDQogICAgICAgIG
 NsaWVudENvbmZpZ3VyYXRpb25WYWx1ZSA9IGpzb24ubG9hZHMoY2xpZW50Q29uZmlndXJhdGlvbi5nZ
 XRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJl
 QXR0cmlidXRlc01hcHBpbmcoY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1c19yZW1vdGVfYXR
 0cmlidXRlc19saXN0Il0sIGNsaWVudENvbmZpZ3VyYXRpb25WYWx1ZVsiZ3BsdXNfbG9jYWxfYXR0cm
 lidXRlc19saXN0Il0pDQogICAgICAgIGlmIChjbGllbnRBdHRyaWJ1dGVzTWFwcGluZyA9PSBOb25lK
 ToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy4g
 Q2xpZW50IGF0dHJpYnV0ZXMgbWFwcGluZyBpcyBpbnZhbGlkLiBVc2luZyBkZWZhdWx0IG9uZSINCiA
 gICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICByZXR1cm
 4gY2xpZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgIGRlZiBwcmVwYXJlQXR0cmlidXRlc01hcHBpb
 mcoc2VsZiwgcmVtb3RlQXR0cmlidXRlc0xpc3QsIGxvY2FsQXR0cmlidXRlc0xpc3QpOg0KICAgICAg
 ICByZW1vdGVBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KHJlbW90ZUF0dHJ
 pYnV0ZXNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KHJlbW90ZUF0dH
 JpYnV0ZXNMaXN0QXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmVBdHRya
 WJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gcmVtb3RlQXR0
 cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiA
 gICAgICAgbG9jYWxBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KGxvY2FsQX
 R0cmlidXRlc0xpc3QsICIsIikNCiAgICAgICAgaWYgKEFycmF5SGVscGVyLmlzRW1wdHkobG9jYWxBd
 HRyaWJ1dGVzTGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQXR0
 cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIGxvY2FsQXR
 0cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIG
 lmIChsZW4ocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkgIT0gbGVuKGxvY2FsQXR0cmlidXRlc0xpc
 3RBcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZUF0dHJpYnV0ZXNNYXBw
 aW5nLiBUaGUgbnVtYmVyIG9mIGF0dHJpYnV0ZXMgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgYW5kIGx
 vY2FsQXR0cmlidXRlc0xpc3QgaXNuJ3QgZXF1YWwiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KIC
 AgICAgICANCiAgICAgICAgYXR0cmlidXRlTWFwcGluZyA9IElkZW50aXR5SGFzaE1hcCgpDQogICAgI
 CAgIGNvbnRhaW5zVWlkID0gRmFsc2UNCiAgICAgICAgaSA9IDANCiAgICAgICAgY291bnQgPSBsZW4o
 cmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkNCiAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICA
 gICAgICAgICByZW1vdGVBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UocmVtb3RlQX
 R0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0gU3RyaW5nS
 GVscGVyLnRvTG93ZXJDYXNlKGxvY2FsQXR0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAg
 IGF0dHJpYnV0ZU1hcHBpbmcucHV0KHJlbW90ZUF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGUpDQoNCiA
 gICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShsb2NhbEF0dHJpYnV0ZS
 wgInVpZCIpKToNCiAgICAgICAgICAgICAgICBjb250YWluc1VpZCA9IFRydWUNCg0KICAgICAgICAgI
 CAgaSA9IGkgKyAxDQoNCiAgICAgICAgaWYgKG5vdCBjb250YWluc1VpZCk6DQogICAgICAgICAgICBw
 cmludCAiR29vZ2xlKyBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIG1hcHBpbmc
 gdG8gbWFuZGF0b3J5ICd1aWQnIGF0dHJpYnV0ZSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogIC
 AgICAgIA0KICAgICAgICByZXR1cm4gYXR0cmlidXRlTWFwcGluZw0KDQogICAgZGVmIGdldFRva2Vuc
 0J5Q29kZShzZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMs
 IGNvZGUpOg0KICAgICAgICB0b2tlblJlcXVlc3QgPSBUb2tlblJlcXVlc3QoR3JhbnRUeXBlLkNMSUV
 OVF9DUkVERU5USUFMUykNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhlbnRpY2F0aW9uTWV0aG
 9kKEF1dGhlbnRpY2F0aW9uTWV0aG9kLkNMSUVOVF9TRUNSRVRfUE9TVCkNCiAgICAgICAgdG9rZW5SZ
 XF1ZXN0LnNldENvZGUoY29kZSkNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhVc2VybmFtZShj
 dXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICB0b2tlblJlcXV
 lc3Quc2V0QXV0aFBhc3N3b3JkKGN1cnJlbnRDbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xpZW50X3NlY3
 JldCJdKQ0KICAgICAgICB0b2tlblJlcXVlc3Quc2V0UmVkaXJlY3RVcmkoInBvc3RtZXNzYWdlIikNC
 iAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEdyYW50VHlwZShHcmFudFR5cGUuQVVUSE9SSVpBVElPTl9D
 T0RFKQ0KDQogICAgICAgIHRva2VuQ2xpZW50ID0gVG9rZW5DbGllbnQoY3VycmVudENsaWVudFNlY3J
 ldHNbIndlYiJdWyJ0b2tlbl91cmkiXSkNCiAgICAgICAgdG9rZW5DbGllbnQuc2V0UmVxdWVzdCh0b2
 tlblJlcXVlc3QpDQogICAgICAgIA0KICAgICAgICB0b2tlblJlc3BvbnNlID0gdG9rZW5DbGllbnQuZ
 XhlYygpDQogICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBOb25lKSBvciAodG9rZW5SZXNwb25z
 ZS5nZXRTdGF0dXMoKSAhPSAyMDApKToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICA
 gcmV0dXJuIHRva2VuUmVzcG9uc2UNCg0KICAgIGRlZiBnZXRVc2VySW5mbyhzZWxmLCBjdXJyZW50Q2
 xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGFjY2Vzc1Rva2VuKToNCiAgICAgI
 CAgdXNlckluZm9DbGllbnQgPSBVc2VySW5mb0NsaWVudCgiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5j
 b20vcGx1cy92MS9wZW9wbGUvbWUvb3BlbklkQ29ubmVjdCIpDQoNCiAgICAgICAgdXNlckluZm9SZXN
 wb25zZSA9IHVzZXJJbmZvQ2xpZW50LmV4ZWNVc2VySW5mbyhhY2Nlc3NUb2tlbikNCiAgICAgICAgaW
 YgKCh1c2VySW5mb1Jlc3BvbnNlID09IE5vbmUpIG9yICh1c2VySW5mb1Jlc3BvbnNlLmdldFN0YXR1c
 ygpICE9IDIwMCkpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICByZXR1cm4gdXNl
 ckluZm9SZXNwb25zZQ0KDQogICAgZGVmIGV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcywgdXNlcik6DQogICAgICAgIGlmIChzZWxmLmV4dGVuc2lvbk1vZHVsZSAhPS
 BOb25lKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQgP
 SBzZWxmLmV4dGVuc2lvbk1vZHVsZS5wb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHVz
 ZXIpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUG9zdExvZ2luIHJlc3VsdDoiLCBwb3N
 0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgIC
 AgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nb
 GUrIFBvc3RMb2dpbi4gRmFpbGVkIHRvIGV4ZWN1dGUgcG9zdExvZ2luIG1ldGhvZCINCiAgICAgICAg
 ICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiA
 gICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGV4Y2VwdCBqYXZhLmxhbmcuVG
 hyb3dhYmxlLCBleDoNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIEZha
 WxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAgZXgucHJpbnRT
 dGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICA
 gICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!D40C.1CA3,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Inbound SAML via Asimba authentication module
displayName: asimba
gluuStatus: false
inum: %(inumOrg)s!0011!D40C.1CA3
oxConfigurationProperty: {"value1":"asimba_saml_certificate_file","value2":"/etc/certs/saml.pem","description":""}
oxConfigurationProperty: {"value1":"asimba_entity_id","value2":"https://%(hostname)s/saml","description":""}
oxConfigurationProperty: {"value1":"saml_deployment_type","value2":"enroll","description":""}
oxConfigurationProperty: {"value1":"saml_name_identifier_format","value2":"urn:oasis:names:tc:SAML:2.0:nameid-format:persistent","description":""}
oxConfigurationProperty: {"value1":"saml_use_authn_context","value2":"true","description":""}
oxConfigurationProperty: {"value1":"saml_idp_sso_target_url","value2":"https://%(hostname)s/asimba/profiles/saml2/sso/web","description":""}
oxConfigurationProperty: {"value1":"user_object_classes","value2":"inetOrgPerson, eduPerson, ox-%(inumOrgFN)s","description":""}
oxConfigurationProperty: {"value1":"saml_idp_attributes_list","value2":"urn:oid:0.9.2342.19200300.100.1.1, urn:oid:0.9.2342.19200300.100.1.3","description":""}
oxConfigurationProperty: {"value1":"saml_local_attributes_list","value2":"uid, mail","description":""}
oxConfigurationProperty: {"value1":"enforce_uniqueness_attr_list","value2":"uid, mail","description":""}
oxLevel: 50
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuDQojIENvcHlyaWdodCAoYykgM
 jAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1w
 b3J0IElkZW50aXR5DQpmcm9tIG9yZy5qYm9zcy5zZWFtIGltcG9ydCBDb21wb25lbnQNCmZyb20gamF2YXguZmFjZXMuY29udGV4dCBpbXBvcnQgRmFjZXNDb250ZXh0DQpmcm9tIG9yZy5qYm9zcy5zZWFtLmZhY2VzIGltcG9ydCB
 GYWNlc01lc3NhZ2VzDQpmcm9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2
 VydmljZSwgQ2xpZW50U2VydmljZSwgQXV0aGVudGljYXRpb25TZXJ2aWNlLCBBdHRyaWJ1dGVTZXJ2aWNlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UubmV0IGltcG9ydCBIdHRwU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0a
 WwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlIZWxwZXIsIFV0aWwNCmZyb20gb3JnLmdsdXUuc2FtbCBpbXBvcnQgU2FtbENvbmZpZ3VyYXRpb24sIEF1dGhSZXF1ZXN0LCBSZXNwb25zZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0
 IEFycmF5cywgQXJyYXlMaXN0LCBIYXNoTWFwLCBJZGVudGl0eUhhc2hNYXANCmZyb20gb3JnLnhkaS5veGF1dGgubW9kZWwuY29tbW9uIGltcG9ydCBVc2VyDQpmcm9tIG9yZy54ZGkubGRhcC5tb2RlbCBpbXBvcnQgQ3VzdG9tQXR
 0cmlidXRlDQpmcm9tIGphdmEubGFuZyBpbXBvcnQgU3RyaW5nDQoNCmZyb20gamFycmF5IGltcG9ydCBhcnJheQ0KaW1wb3J0IGphdmENCg0KdHJ5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW
 1wb3J0IHNpbXBsZWpzb24gYXMganNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgI
 CAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2FtbC4gSW5pdGlhbGl6YXRpb24i
 DQoNCiAgICAgICAgYXNpbWJhX3NhbWxfY2VydGlmaWNhdGVfZmlsZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiYXNpbWJhX3NhbWxfY2VydGlmaWNhdGVfZmlsZSIpLmdldFZhbHVlMigpDQogICAgICAgIHNhbWxfaWR
 wX3Nzb190YXJnZXRfdXJsID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2lkcF9zc29fdGFyZ2V0X3VybCIpLmdldFZhbHVlMigpDQogICAgICAgIGFzaW1iYV9lbnRpdHlfaWQgPSBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5nZXQoImFzaW1iYV9lbnRpdHlfaWQiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzYW1sX3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhb
 WxfdXNlX2F1dGhuX2NvbnRleHQiKS5nZXRWYWx1ZTIoKSwgVHJ1ZSkNCiAgICAgICAgaWYgKHNhbWxfdXNlX2F1dGhuX2NvbnRleHQpOg0KICAgICAgICAgICAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gY29uZmlndXJh
 dGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX25hbWVfaWRlbnRpZmllcl9mb3JtYXQiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gTm9uZQ0KDQogICA
 gICAgIGFzaW1iYV9zYW1sX2NlcnRpZmljYXRlID0gc2VsZi5sb2FkQ2VyaXRpZmljYXRlKGFzaW1iYV9zYW1sX2NlcnRpZmljYXRlX2ZpbGUpDQogICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNFbXB0eShhc2ltYmFfc2FtbF9jZX
 J0aWZpY2F0ZSkpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBGaWxlIHdpdGggeDUwOSBjZXJ0aWZpY2F0ZSBzaG91bGQgYmUgbm90IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNC
 iAgICAgICAgc2FtbENvbmZpZ3VyYXRpb24gPSBTYW1sQ29uZmlndXJhdGlvbigpDQoNCiAgICAgICAgIyBTZXQgdGhlIGlzc3VlciBvZiB0aGUgYXV0aGVudGljYXRpb24gcmVxdWVzdC4gVGhpcyB3b3VsZCB1c3VhbGx5IGJlIHRo
 ZSBVUkwgb2YgdGhlIGlzc3Vpbmcgd2ViIGFwcGxpY2F0aW9uDQogICAgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldElzc3Vlcihhc2ltYmFfZW50aXR5X2lkKQ0KDQogICAgICAgICMgVGVsbHMgdGhlIElkUCB0byByZXR1cm4gYSB
 wZXJzaXN0ZW50IGlkZW50aWZpZXIgZm9yIHRoZSB1c2VyDQogICAgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldE5hbWVJZGVudGlmaWVyRm9ybWF0KHNhbWxfbmFtZV9pZGVudGlmaWVyX2Zvcm1hdCkNCiAgDQogICAgICAgICMgVG
 hlIFVSTCBhdCB0aGUgSWRlbnRpdHkgUHJvdmlkZXIgd2hlcmUgdG8gdGhlIGF1dGhlbnRpY2F0aW9uIHJlcXVlc3Qgc2hvdWxkIGJlIHNlbnQNCiAgICAgICAgc2FtbENvbmZpZ3VyYXRpb24uc2V0SWRwU3NvVGFyZ2V0VXJsKHNhb
 WxfaWRwX3Nzb190YXJnZXRfdXJsKQ0KDQogICAgICAgICMgRW5hYmxlZGlhYmxlIFJlcXVlc3RlZEF1dGhuQ29udGV4dA0KICAgICAgICBzYW1sQ29uZmlndXJhdGlvbi5zZXRVc2VSZXF1ZXN0ZWRBdXRobkNvbnRleHQoc2FtbF91
 c2VfYXV0aG5fY29udGV4dCkNCiAgICAgICAgDQogICAgICAgICMgTG9hZCB4NTA5IGNlcnRpZmljYXRlDQogICAgICAgIHNhbWxDb25maWd1cmF0aW9uLmxvYWRDZXJ0aWZpY2F0ZUZyb21TdHJpbmcoYXNpbWJhX3NhbWxfY2VydGl
 maWNhdGUpDQogICAgICAgIA0KICAgICAgICBzZWxmLnNhbWxDb25maWd1cmF0aW9uID0gc2FtbENvbmZpZ3VyYXRpb24NCg0KICAgICAgICBzZWxmLnVzZXJPYmplY3RDbGFzc2VzID0gTm9uZQ0KICAgICAgICBpZiBjb25maWd1cm
 F0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgidXNlcl9vYmplY3RfY2xhc3NlcyIpOg0KICAgICAgICAgICAgc2VsZi51c2VyT2JqZWN0Q2xhc3NlcyA9IHNlbGYucHJlcGFyZVVzZXJPYmplY3RDbGFzc2VzKGNvbmZpZ3VyYXRpb
 25BdHRyaWJ1dGVzKQ0KDQogICAgICAgIHNlbGYudXNlckVuZm9yY2VBdHRyaWJ1dGVzVW5pcXVlbmVzcyA9IE5vbmUNCiAgICAgICAgaWYgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImVuZm9yY2VfdW5pcXVl
 bmVzc19hdHRyX2xpc3QiKToNCiAgICAgICAgICAgIHNlbGYudXNlckVuZm9yY2VBdHRyaWJ1dGVzVW5pcXVlbmVzcyA9IHNlbGYucHJlcGFyZVVzZXJFbmZvcmNlVW5pcXVlbmVzc0F0dHJpYnV0ZXMoY29uZmlndXJhdGlvbkF0dHJ
 pYnV0ZXMpDQoNCiAgICAgICAgc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QiKSBhbmQNCi
 AgICAgICAgICAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCIpKToNCg0KICAgICAgICAgICAgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0ID0gY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCkpOg0KICAgICAg
 ICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5IHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICA
 gc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaX
 NFbXB0eShzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5IHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IGlzIGVtcHR5I
 g0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJlQXR0cmlidXRlc01hcHBpbmcoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0LCBzYW1s
 X2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCkNCiAgICAgICAgICAgIGlmIChzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXphdGlvbi4gVGhlIGF0dHJpYnV
 0ZXMgbWFwcGluZyBpc24ndCB2YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidX
 Rlcy5jb250YWluc0tleSgic2FtbF9leHRlbnNpb25fbW9kdWxlIikpOg0KICAgICAgICAgICAgc2FtbF9leHRlbnNpb25fbW9kdWxlX25hbWUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfZXh0ZW5zaW9uX21vZ
 HVsZSIpLmdldFZhbHVlMigpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgc2VsZi5zYW1sRXh0ZW5zaW9uTW9kdWxlID0gX19pbXBvcnRfXyhzYW1sX2V4dGVuc2lvbl9tb2R1bGVfbmFtZSkNCiAgICAgICAgICAg
 ICAgICBzYW1sX2V4dGVuc2lvbl9tb2R1bGVfaW5pdF9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUuaW5pdChjb25maWd1cmF0aW9uQXR0cmlidXRlcykNCiAgICAgICAgICAgICAgICBpZiAobm90IHNhbWxfZXh0ZW5
 zaW9uX21vZHVsZV9pbml0X3Jlc3VsdCk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yLCBleDoNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gSW5pdG
 lhbGl6YXRpb24uIEZhaWxlZCB0byBsb2FkIHNhbWxfZXh0ZW5zaW9uX21vZHVsZTogJyVzJyIgJSBzYW1sX2V4dGVuc2lvbl9tb2R1bGVfbmFtZQ0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXphdGlvbi4gV
 W5leHBlY3RlZCBlcnJvcjoiLCBleA0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAg
 ICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJTYW1sLiBEZXN0cm95Ig0KICAgICAgICBwcmludCAiU2FtbC4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICA
 gcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb2
 5BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgI
 CByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRD
 b250ZXh0KCkNCiAgICAgICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICA
 gc2FtbF9tYXBfdXNlciA9IEZhbHNlDQogICAgICAgIHNhbWxfZW5yb2xsX3VzZXIgPSBGYWxzZQ0KICAgICAgICBzYW1sX2Vucm9sbF9hbGxfdXNlcl9hdHRyID0gRmFsc2UNCiAgICAgICAgIyBVc2Ugc2FtbF9kZXBsb3ltZW50X3
 R5cGUgb25seSBpZiB0aGVyZSBpcyBubyBhdHRyaWJ1dGVzIG1hcHBpbmcNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2RlcGxveW1lbnRfdHlwZSIpKToNCiAgICAgICAgICAgI
 HNhbWxfZGVwbG95bWVudF90eXBlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF9kZXBsb3ltZW50X3R5cGUiKS5nZXRWYWx1ZTIoKSkNCiAgICAgICAgICAgIA0KICAg
 ICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHNhbWxfZGVwbG95bWVudF90eXBlLCAibWFwIikpOg0KICAgICAgICAgICAgICAgIHNhbWxfbWFwX3VzZXIgPSBUcnVlDQoNCiAgICAgICAgICAgIGlmICh
 TdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShzYW1sX2RlcGxveW1lbnRfdHlwZSwgImVucm9sbCIpKToNCiAgICAgICAgICAgICAgICBzYW1sX2Vucm9sbF91c2VyID0gVHJ1ZQ0KDQogICAgICAgICAgICBpZiAoU3RyaW5nSG
 VscGVyLmVxdWFsc0lnbm9yZUNhc2Uoc2FtbF9kZXBsb3ltZW50X3R5cGUsICJlbnJvbGxfYWxsX2F0dHIiKSk6DQogICAgICAgICAgICAgICAgc2FtbF9lbnJvbGxfYWxsX3VzZXJfYXR0ciA9IFRydWUNCg0KICAgICAgICBzYW1sX
 2FsbG93X2Jhc2ljX2xvZ2luID0gRmFsc2UNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2FsbG93X2Jhc2ljX2xvZ2luIikpOg0KICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNp
 Y19sb2dpbiA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2FsbG93X2Jhc2ljX2xvZ2luIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgIHVzZV9iYXNpY19hdXR
 oID0gRmFsc2UNCiAgICAgICAgaWYgKHNhbWxfYWxsb3dfYmFzaWNfbG9naW4pOg0KICAgICAgICAgICAgIyBEZXRlY3QgaWYgdXNlciB1c2VkIGJhc2ljIGF1dGhuZXRpY2F0aW9uIG1ldGhvZA0KICAgICAgICAgICAgY3JlZGVudG
 lhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCg0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlb
 nRpYWxzLmdldFBhc3N3b3JkKCkNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eSh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eSh1c2VyX3Bhc3N3b3JkKSk6DQogICAgICAgICAgICAg
 ICAgdXNlX2Jhc2ljX2F1dGggPSBUcnVlDQoNCiAgICAgICAgaWYgKChzdGVwID09IDEpIGFuZCBzYW1sX2FsbG93X2Jhc2ljX2xvZ2luIGFuZCB1c2VfYmFzaWNfYXV0aCk6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGV
 udGljYXRlIGZvciBzdGVwIDEuIEJhc2ljIGF1dGhlbnRpY2F0aW9uIg0KDQogICAgICAgICAgICBjb250ZXh0LnNldCgic2FtbF9jb3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbn
 RpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc
 3dvcmQoKQ0KDQogICAgICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5n
 KHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9
 uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgICAgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgaWYgKHN0ZX
 AgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgICAgICAgIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0a
 W9uKHNlbGYuc2FtbENvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24gPT0gTm9uZSk6DQogICAgICAg
 ICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gQ2xpZW50IHNhbWwgY29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBzYW1sX3J
 lc3BvbnNlX2FycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJTQU1MUmVzcG9uc2UiKQ0KICAgICAgICAgICAgaWYgQXJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX3Jlc3BvbnNlX2FycmF5KToNCiAgICAgICAgICAgICAgICBwcm
 ludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2UgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfcmVzcG9uc2UgPSBzYW1sX3Jlc3Bvb
 nNlX2FycmF5WzBdDQoNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gc2FtbF9yZXNwb25zZTogJyVzJyIgJSBzYW1sX3Jlc3BvbnNlDQoNCiAgICAgICAgICAgIHNhbWxSZXNwb25zZSA9
 IFJlc3BvbnNlKGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbikNCiAgICAgICAgICAgIHNhbWxSZXNwb25zZS5sb2FkWG1sRnJvbUJhc2U2NChzYW1sX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBzYW1sX3ZhbGl
 kYXRlX3Jlc3BvbnNlID0gVHJ1ZQ0KICAgICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX3ZhbGlkYXRlX3Jlc3BvbnNlIikpOg0KICAgICAgICAgICAgICAgIHNhbWxfdmFsaWRhdG
 VfcmVzcG9uc2UgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF92YWxpZGF0ZV9yZXNwb25zZSIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0KICAgICAgICAgICAgaWYgKHNhb
 WxfdmFsaWRhdGVfcmVzcG9uc2UpOg0KICAgICAgICAgICAgICAgIGlmIChub3Qgc2FtbFJlc3BvbnNlLmlzVmFsaWQoKSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4g
 c2FtbF9yZXNwb25zZSBpc24ndCB2YWxpZCINCg0KICAgICAgICAgICAgc2FtbF9yZXNwb25zZV9uYW1lX2lkID0gc2FtbFJlc3BvbnNlLmdldE5hbWVJZCgpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoc2F
 tbF9yZXNwb25zZV9uYW1lX2lkKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBzYW1sX3Jlc3BvbnNlX25hbWVfaWQgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZX
 R1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBzYW1sX3Jlc3BvbnNlX25hbWVfaWQ6ICclcyciICUgc2FtbF9yZXNwb25zZV9uYW1lX2lkDQoNCiAgICAgICAgICAgI
 HNhbWxfcmVzcG9uc2VfYXR0cmlidXRlcyA9IHNhbWxSZXNwb25zZS5nZXRBdHRyaWJ1dGVzKCkNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gYXR0cmlidXRlczogJyVzJyIgJSBzYW1s
 X3Jlc3BvbnNlX2F0dHJpYnV0ZXMNCg0KICAgICAgICAgICAgIyBVc2UgcGVyc2lzdGVudCBJZCBhcyBzYW1sX3VzZXJfdWlkDQogICAgICAgICAgICBzYW1sX3VzZXJfdWlkID0gc2FtbF9yZXNwb25zZV9uYW1lX2lkDQogICAgICA
 gICAgICANCiAgICAgICAgICAgIGlmIChzYW1sX21hcF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBtYXBwaW5nIHRvIGxvY2FsIElEUCB1c2VyDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZS
 Bmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBzYW1sOiAnJXMnIiAlIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzc
 GVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkN
 Cg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQo
 gICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2FtbF9jb3VudF9sb2
 dpbl9zdGVwcyIsIDIpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzYW1sX3VzZXJfdWlkIiwgc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgICAgI
 GZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZTogJyVzJyIgJSBmb3Vu
 ZF91c2VyX25hbWUNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICA
 gICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgI
 CAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDogJyVzJyIgJSBwb3N0X2xvZ2luX3Jlc3VsdA0
 KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICAgICBlbGlmIChzYW1sX2Vucm9sbF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBhdXRvIGVucm9sbG1lbnQgdG8gbG9jYWwgSU
 RQDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBzYW1sOiAnJXMnIiAlIHNhbWxfdXNlcl91aWQNCg0KI
 CAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1
 dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAjIEF1dG8gdXNlciBlbnJ
 vbGxlbW50DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGhlcmUgaXMgbm8gdXNlciBpbiBMREFQLiBBZGRpbmcgdXNlciB0byBsb2NhbCBMREFQIg0KDQogICAgICAgIC
 AgICAgICAgICAgICMgQ29udmVydCBzYW1sIHJlc3VsdCBhdHRyaWJ1dGVzIGtleXMgdG8gbG92ZXIgY2FzZQ0KICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cmlidXRlcyA9IEhhc2hNYXAoK
 Q0KICAgICAgICAgICAgICAgICAgICBmb3Igc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVfZW50cnkgaW4gc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVzLmVudHJ5U2V0KCk6DQogICAgICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3Bv
 bnNlX25vcm1hbGl6ZWRfYXR0cmlidXRlcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKHNhbWxfcmVzcG9uc2VfYXR0cmlidXRlX2VudHJ5LmdldEtleSgpKSwgc2FtbF9
 yZXNwb25zZV9hdHRyaWJ1dGVfZW50cnkuZ2V0VmFsdWUoKSkNCg0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVDdXJyZW50QXR0cmlidXRlc01hcHBpbmcoc2VsZi5hdH
 RyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFVzaW5nIG5leHQgY
 XR0cmlidXRlcyBtYXBwaW5nICclcyciICUgY3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBuZXdVc2VyID0gVXNlcigpDQogICAgICAgICAgICAgICAgICAg
 IA0KICAgICAgICAgICAgICAgICAgICAjIFNldCBjdXN0b20gb2JqZWN0IGNsYXNzZXMNCiAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi51c2VyT2JqZWN0Q2xhc3NlcyAhPSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICA
 gcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2VyIGN1c3RvbSBvYmplY3RDbGFzc2VzIHRvIGFkZCBwZXJzb25zOiAnJXMnIiAlIFV0aWwuYXJyYXkyQXJyYXlMaXN0KHNlbGYudXNlck9iamVjdENsYXNzZX
 MpDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEN1c3RvbU9iamVjdENsYXNzZXMoc2VsZi51c2VyT2JqZWN0Q2xhc3NlcykNCg0KICAgICAgICAgICAgICAgICAgICBmb3IgYXR0cmlidXRlc01hcHBpbmdFbnRye
 SBpbiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkcEF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNNYXBwaW5nRW50cnkuZ2V0S2V5KCkNCiAgICAgICAgICAgICAgICAg
 ICAgICAgIGxvY2FsQXR0cmlidXRlID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRWYWx1ZSgpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWR
 fYXR0cmlidXRlcy5nZXQoaWRwQXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2FsQXR0cmlidXRlICE9IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidX
 RlKGxvY2FsQXR0cmlidXRlLCBsb2NhbEF0dHJpYnV0ZVZhbHVlKQ0KDQogICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgInNhbWw6IiArIHNhbWxfdXNlcl91aWQpDQogICAgI
 CAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBhZGQgdXNlciAnJXMnIHdpdGggbmV4dCBhdHRyaWJ1dGVzOiAnJXMnIiAlICggc2FtbF91c2VyX3VpZCwgbmV3
 VXNlci5nZXRDdXN0b21BdHRyaWJ1dGVzKCkgKQ0KDQogICAgICAgICAgICAgICAgICAgIHVzZXJfdW5pcXVlID0gc2VsZi5jaGVja1VzZXJVbmlxdWVuZXNzKG5ld1VzZXIpDQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCB1c2V
 yX3VuaXF1ZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGFkZCB1c2VyOiAnJXMnLiBVc2VyIG5vdCB1bmlxdWUiICUgbmV3VXNlci5nZXRBdH
 RyaWJ1dGUoInVpZCIpDQogICAgICAgICAgICAgICAgICAgICAgICBmYWNlc01lc3NhZ2VzID0gRmFjZXNNZXNzYWdlcy5pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAgICAgICAgICBmYWNlc01lc3NhZ2VzLmFkZChTdGF0dXNNZ
 XNzYWdlLlNldmVyaXR5LkVSUk9SLCAiRmFpbGVkIHRvIGVucm9sbC4gVXNlciB3aXRoIHNhbWUga2V5IGF0dHJpYnV0ZXMgZXhpc3QgYWxyZWFkeSIpDQogICAgICAgICAgICAgICAgICAgICAgICBGYWNlc0NvbnRleHQuZ2V0Q3Vy
 cmVudEluc3RhbmNlKCkuZ2V0RXh0ZXJuYWxDb250ZXh0KCkuZ2V0Rmxhc2goKS5zZXRLZWVwTWVzc2FnZXMoVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgICAgIGZ
 pbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZXIsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aC
 BVSUQ6ICclcyciICUgZmluZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KDQogICAgICAgICAgICAgICAgZm91bmRfdXNlcl9uYW1lID0gZmluZF91c2VyX2J5X3VpZC5nZXRVc2VySWQoKQ0KICAgICAgICAgICAgICAgIHByaW50I
 CJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZm91bmRfdXNlcl9uYW1lOiAnJXMnIiAlIGZvdW5kX3VzZXJfbmFtZQ0KDQogICAgICAgICAgICAgICAgdXNlcl9hdXRoZW50aWNhdGVkID0gYXV0aGVudGljYXRpb25TZXJ2
 aWNlLmF1dGhlbnRpY2F0ZShmb3VuZF91c2VyX25hbWUpDQogICAgICAgICAgICAgICAgaWYgKHVzZXJfYXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGU
 gZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB1c2VyOiAnJXMnIiAlIGZvdW5kX3VzZXJfbmFtZQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLi
 BBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAxIg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzYW1sX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgICAgIHBvc
 3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUg
 Zm9yIHN0ZXAgMS4gcG9zdF9sb2dpbl9yZXN1bHQ6ICclcyciICUgcG9zdF9sb2dpbl9yZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICAgICAgICAgICAgZWxpZiAoc2FtbF9lbnJvbGx
 fYWxsX3VzZXJfYXR0cik6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBzYW1sOiIgKyBzYW1sX3VzZX
 JfdWlkDQoNCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIHNhbWxfdXNlcl91aWQNCiAgICAgICAgICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlc
 kJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgInNhbWw6IiArIHNhbWxfdXNlcl91aWQpDQoNCiAgICAgICAgICAgICAgICBpZiAoZmluZF91c2VyX2J5X3VpZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQg
 IlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KDQogICAgICAgICAgICAgICAgICAgIHVzZXIgPSBVc2VyKCkNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICA
 gICMgU2V0IGN1c3RvbSBvYmplY3QgY2xhc3Nlcw0KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnVzZXJPYmplY3RDbGFzc2VzICE9IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudG
 ljYXRlIGZvciBzdGVwIDEuIFVzZXIgY3VzdG9tIG9iamVjdENsYXNzZXMgdG8gYWRkIHBlcnNvbnM6ICclcyciICUgVXRpbC5hcnJheTJBcnJheUxpc3Qoc2VsZi51c2VyT2JqZWN0Q2xhc3NlcykNCiAgICAgICAgICAgICAgICAgI
 CAgICAgIHVzZXIuc2V0Q3VzdG9tT2JqZWN0Q2xhc3NlcyhzZWxmLnVzZXJPYmplY3RDbGFzc2VzKQ0KDQogICAgICAgICAgICAgICAgICAgIGN1c3RvbUF0dHJpYnV0ZXMgPSBBcnJheUxpc3QoKQ0KICAgICAgICAgICAgICAgICAg
 ICBmb3Iga2V5IGluIGF0dHJpYnV0ZXMua2V5U2V0KCk6DQogICAgICAgICAgICAgICAgICAgICAgICBsZGFwQXR0cmlidXRlcyA9IGF0dHJpYnV0ZVNlcnZpY2UuZ2V0QWxsQXR0cmlidXRlcygpDQogICAgICAgICAgICAgICAgICA
 gICAgICBmb3IgbGRhcEF0dHJpYnV0ZSBpbiBsZGFwQXR0cmlidXRlczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1sMlVyaSA9IGxkYXBBdHRyaWJ1dGUuZ2V0U2FtbDJVcmkoKQ0KICAgICAgICAgICAgICAgICAgIC
 AgICAgICAgIGlmKHNhbWwyVXJpID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1sMlVyaSA9IGF0dHJpYnV0ZVNlcnZpY2UuZ2V0RGVmYXVsdFNhbWwyVXJpKGxkYXBBdHRyaWJ1dGUuZ2V0TmFtZ
 SgpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNhbWwyVXJpID09IGtleSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZShsZGFwQXR0cmlidXRlLmdl
 dE5hbWUoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlcyhhdHRyaWJ1dGVzLmdldChrZXkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGV
 zLmFkZChhdHRyaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlID0gQ3VzdG9tQXR0cmlidXRlKCJveEV4dGVybmFsVWlkIikNCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlKCJzYW1sOi
 IgKyBzYW1sX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhdHRyaWJ1dGUpDQogICAgICAgICAgICAgICAgICAgIHVzZXIuc2V0Q3VzdG9tQXR0cmlidXRlcyhjdXN0b21BdHRyaWJ1d
 GVzKQ0KDQogICAgICAgICAgICAgICAgICAgIGlmKHVzZXIuZ2V0QXR0cmlidXRlKCJzbiIpID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlID0gQ3VzdG9tQXR0cmlidXRlKCJzbiIpDQogICAgICAg
 ICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUuc2V0VmFsdWUoc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbUF0dHJpYnV0ZXMuYWRkKGF0dHJpYnV0ZSkNCg0KICAgICAgICAgICAgICAgICAgICB
 pZih1c2VyLmdldEF0dHJpYnV0ZSgiY24iKSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZSgiY24iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLn
 NldFZhbHVlKHNhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhdHRyaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgdXNlcl91bmlxdWUgPSBzZWxmLmNoZWNrVXNlc
 lVuaXF1ZW5lc3ModXNlcikNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHVzZXJfdW5pcXVlOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8g
 YWRkIHVzZXI6ICclcycuIFVzZXIgbm90IHVuaXF1ZSIgJSBuZXdVc2VyLmdldEF0dHJpYnV0ZSgidWlkIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGZhY2VzTWVzc2FnZXMgPSBGYWNlc01lc3NhZ2VzLmluc3RhbmNlKCkNCiA
 gICAgICAgICAgICAgICAgICAgICAgIGZhY2VzTWVzc2FnZXMuYWRkKFN0YXR1c01lc3NhZ2UuU2V2ZXJpdHkuRVJST1IsICJGYWlsZWQgdG8gZW5yb2xsLiBVc2VyIHdpdGggc2FtZSBrZXkgYXR0cmlidXRlcyBleGlzdCBhbHJlYW
 R5IikNCiAgICAgICAgICAgICAgICAgICAgICAgIEZhY2VzQ29udGV4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXRFeHRlcm5hbENvbnRleHQoKS5nZXRGbGFzaCgpLnNldEtlZXBNZXNzYWdlcyhUcnVlKQ0KICAgICAgICAgICAgI
 CAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmFkZFVzZXIodXNlciwgVHJ1ZSkNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwu
 IEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBZGRlZCBuZXcgdXNlciB3aXRoIFVJRDogJyVzJyIgJSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3V
 zZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6ICclcyciICUgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgIC
 AgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZhbHNlKToNC
 iAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAg
 ICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0
 KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbn
 QgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDogJyVzJyIgJSBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgI
 CAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAg
 MS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiAnJXMnIiAlIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyKHNhbWxfdXNlcl91aWQpDQo
 gICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiAgIC
 AgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlb
 nRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6ICclcyciICUgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGlj
 YXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB
 GYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW
 50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb
 3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDogJyVzJyIg
 JSBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZ
 vciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHNlc3Npb25BdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIChzZXNzaW9uQXR0cmlidXRlcyA9PSBOb25lKSBvciBub3Qgc2
 Vzc2lvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfdXNlcl91aWQiKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHNhbWxfdXNlcl91aWQgaXMgZW1wdHkiDQogICAgI
 CAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfdXNlcl91aWQgPSBzZXNzaW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlcl91aWQiKQ0KICAgICAgICAgICAgcGFzc2VkX3N0ZXAxID0gU3RyaW5nSGVs
 cGVyLmlzTm90RW1wdHlTdHJpbmcoc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgIGlmIChub3QgcGFzc2VkX3N0ZXAxKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSB
 JZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZX
 RQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTd
 HJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2Vk
 X2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBzYW1sX3VzZXJfdWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgU2F
 tbCBhY2NvdW50IHRvIG1vcmUgdGhhbiBvbmUgSURQIGFjY291bnQNCiAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2
 FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgIyBBZGQgc2FtbF91c2VyX3VpZCB0byB1c2VyIG9uZSBpZCBVSURzDQogICAgICAgICAgICAgI
 CAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmFkZFVzZXJBdHRyaWJ1dGUodXNlcl9uYW1lLCAib3hFeHRlcm5hbFVpZCIsICJzYW1sOiIgKyBzYW1sX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3Vz
 ZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGUgY3VycmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICB
 yZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgIC
 AgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gcG9zdF9sb2dpbl9yZXN1bHQ6ICclcyciICUgcG9zdF9sb2dpbl9yZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc
 3VsdA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBm
 b3Igc3RlcCAyLiBmb3VuZF91c2VyX25hbWU6ICclcyciICUgZm91bmRfdXNlcl9uYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFscyh1c2VyX25hbWUsIGZvdW5kX3VzZXJfbmFtZSk6DQogICA
 gICAgICAgICAgICAgICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgICAgICAgICAgICAgICBwcm
 ludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHBvc3RfbG9naW5fcmVzdWx0OiAnJXMnIiAlIHBvc3RfbG9naW5fcmVzdWx0DQogICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3Vsd
 A0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5
 pbnN0YW5jZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZX
 J2aWNlLmluc3RhbmNlKCk7DQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ0KICAgICAgICAgICAgYXNzZXJ0aW9uQ
 29uc3VtZXJTZXJ2aWNlVXJsID0gaHR0cFNlcnZpY2UuY29uc3RydWN0U2VydmVyVXJsKHJlcXVlc3QpICsgIi9wb3N0bG9naW4iDQogICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxLiBQcmVwYXJlZCBh
 c3NlcnRpb25Db25zdW1lclNlcnZpY2VVcmw6ICclcyciICUgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsDQogICAgICAgICAgICANCiAgICAgICAgICAgIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q3VycmV
 udFNhbWxDb25maWd1cmF0aW9uKHNlbGYuc2FtbENvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24gPT
 0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gQ2xpZW50IHNhbWwgY29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogI
 CAgICAgICAgICAjIEdlbmVyYXRlIGFuIEF1dGhSZXF1ZXN0IGFuZCBzZW5kIGl0IHRvIHRoZSBpZGVudGl0eSBwcm92aWRlcg0KICAgICAgICAgICAgc2FtbEF1dGhSZXF1ZXN0ID0gQXV0aFJlcXVlc3QoY3VycmVudFNhbWxDb25m
 aWd1cmF0aW9uKQ0KICAgICAgICAgICAgZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaSA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5nZXRJZHBTc29UYXJnZXRVcmwoKSArICI/U0FNTFJlcXVlc3Q9IiArIHNhbWxBdXRoUmVxdWV
 zdC5nZXRSZXF1ZXN0KFRydWUsIGFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVybCkNCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaTogJyVzJyIgJS
 BleHRlcm5hbF9hdXRoX3JlcXVlc3RfdXJpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJleHRlcm5hbF9hdXRoX3JlcXVlc3RfdXJpIiwgZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaSkNCg0KICAgICAgI
 CAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6
 DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMik6DQogICA
 gICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgic2FtbF91c2VyX3VpZCIpDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dH
 JpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm4gY
 29udGV4dC5nZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQog
 ICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfYWxsb3d
 fYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2FsbG93X2Jhc2ljX2xvZ2
 luIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgICAgICAgICAgcmV0dXJuICIvbG9naW4ueGh0bWwiDQogICAgICAgICAgICBlbHNlOg0KICAgI
 CAgICAgICAgICAgIHJldHVybiAiL2F1dGgvc2FtbC9zYW1sbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0aC9zYW1sL3NhbWxwb3N0bG9naW4ueGh0bWwiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgaXNQYXNzZWRTdGVwMSgpOg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V
 0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgIHBhc3NlZF9zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkNCg0KIC
 AgICAgICByZXR1cm4gcGFzc2VkX3N0ZXAxDQoNCiAgICBkZWYgbG9hZENlcml0aWZpY2F0ZShzZWxmLCBhc2ltYmFfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlKToNCiAgICAgICAgYXNpbWJhX3NhbWxfY2VydGlmaWNhdGUgPSBOb25lD
 QoNCiAgICAgICAgIyBMb2FkIGNlcnRpZmljYXRlIGZyb20gZmlsZQ0KICAgICAgICBmID0gb3Blbihhc2ltYmFfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGFzaW1iYV9zYW1s
 X2NlcnRpZmljYXRlID0gZi5yZWFkKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIkZhaWxlZCB0byBsb2FkIGNlcnRpZmljYXRlIGZyb20gZmlsZTogJyVzJyIgJSBhc2ltYmFfc2FtbF9jZXJ0aWZpY2F0ZV9
 maWxlDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgZi5jbG9zZSgpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gYXNpbWJhX3NhbWxfY2VydGlmaWNhdGUNCg0KICAgIGRlZi
 BnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVudCBjb25maWd1cmF0aW9uDQogICAgICAgIGlmIChjb25maWd1c
 mF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKSk6DQogICAgICAgICAgICBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzLmdldCgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCB
 hdHRyaWJ1dGU6ICclcyciICUgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUNCg0KICAgICAgICAgICAgaWYgKHJlcXVlc3RQYXJhbWV0ZXJzID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBOb25lDQ
 oNCiAgICAgICAgICAgIGNsaWVudF9pZCA9IE5vbmUNCiAgICAgICAgICAgIGNsaWVudF9pZF9hcnJheSA9IHJlcXVlc3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmIChBcnJheUhlbHBlci5pc05vd
 EVtcHR5KGNsaWVudF9pZF9hcnJheSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKGNsaWVudF9pZF9hcnJheVswXSkpOg0KICAgICAgICAgICAgICAgIGNsaWVudF9pZCA9IGNsaWVudF9pZF9hcnJheVswXQ0KDQog
 ICAgICAgICAgICBpZiAoY2xpZW50X2lkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgICAgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1N
 ldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKSk6DQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZCA9IGV2ZW50Q29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikuZ2V0KCJjbGllbnRfaWQiKQ0KDQogICAgICAgICAgICBpZi
 AoY2xpZW50X2lkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBjbGllbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgI
 CAgICAgICAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgY2xpZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50X2lkKQ0KICAgICAgICAgICAgaWYgKGNsaWVudCA9
 PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gR2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gRmFpbGVkIHRvIGZpbmQgY2xpZW50ICclcycgaW4gbG9jYWwgTERBUCIgJSBjbGllbnRfaWQNCiAgICAgICAgICAgICA
 gICByZXR1cm4gTm9uZQ0KDQogICAgICAgICAgICBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uID0gY2xpZW50U2VydmljZS5nZXRDdXN0b21BdHRyaWJ1dGUoY2xpZW50LCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYn
 V0ZSkNCiAgICAgICAgICAgIGlmICgoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9PSBOb25lKSBvciBTdHJpbmdIZWxwZXIuaXNFbXB0eShzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uLmdldFZhbHVlKCkpKToNCiAgICAgICAgI
 CAgICAgICBwcmludCAiU2FtbC4gR2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gQ2xpZW50ICclcycgYXR0cmlidXRlICclcycgaXMgZW1wdHkiICUgKCBjbGllbnRfaWQsIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRl
 ICkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCAnJXMnIGF0dHJpYnV0ZSAnJXMnIGlzICclcyciICUgKCBjbGllbnRfaWQsIHNhbWx
 fY2xpZW50X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRlLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uICkNCiAgICAgICAgICAgICAgICByZXR1cm4gc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbg0KDQogICAgICAgIHJldHVybiBOb2
 5lDQoNCiAgICBkZWYgZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0aW9uKHNlbGYsIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgc2Ftb
 F9jbGllbnRfY29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGlmIChzYW1sX2NsaWVudF9jb25maWd1cmF0
 aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbg0KICAgICAgICANCiAgICAgICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZSA9IGpzb24ubG9hZHMoc2FtbF9jbGl
 lbnRfY29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudF9hc2ltYmFfc2FtbF9jZXJ0aWZpY2F0ZSA9IE5vbmUgICAgICANCiAgICAgICAgY2xpZW50X2FzaW1iYV9zYW1sX2NlcnRpZmljYXRlX2ZpbGUgPS
 BzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWyJhc2ltYmFfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlIl0NCiAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KGNsaWVudF9hc2ltYmFfc2FtbF9jZXJ0aWZpY2F0Z
 V9maWxlKSk6DQogICAgICAgICAgICBjbGllbnRfYXNpbWJhX3NhbWxfY2VydGlmaWNhdGUgPSBzZWxmLmxvYWRDZXJpdGlmaWNhdGUoY2xpZW50X2FzaW1iYV9zYW1sX2NlcnRpZmljYXRlX2ZpbGUpDQogICAgICAgICAgICBpZiAo
 U3RyaW5nSGVscGVyLmlzRW1wdHkoY2xpZW50X2FzaW1iYV9zYW1sX2NlcnRpZmljYXRlKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEJ1aWxkQ2xpZW50U2FtbENvbmZpZ3VyYXRpb24uIEZpbGUgd2l0aCB4NTA5IGN
 lcnRpZmljYXRlIHNob3VsZCBiZSBub3QgZW1wdHkuIFVzaW5nIGRlZmF1bHQgY29uZmlndXJhdGlvbiINCiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFNhbWxDb25maWd1cmF0aW9uDQoNCiAgICAgICAgY2xpZW50U2FtbE
 NvbmZpZ3VyYXRpb24gPSBjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24uY2xvbmUoKQ0KICAgICAgICANCiAgICAgICAgaWYgKGNsaWVudF9hc2ltYmFfc2FtbF9jZXJ0aWZpY2F0ZSAhPSBOb25lKToNCiAgICAgICAgICAgIGNsaWVud
 FNhbWxDb25maWd1cmF0aW9uLmxvYWRDZXJ0aWZpY2F0ZUZyb21TdHJpbmcoY2xpZW50X2FzaW1iYV9zYW1sX2NlcnRpZmljYXRlKQ0KDQogICAgICAgIGNsaWVudF9hc2ltYmFfZW50aXR5X2lkID0gc2FtbF9jbGllbnRfY29uZmln
 dXJhdGlvbl92YWx1ZVsiYXNpbWJhX2VudGl0eV9pZCJdDQogICAgICAgIGNsaWVudFNhbWxDb25maWd1cmF0aW9uLnNldElzc3VlcihjbGllbnRfYXNpbWJhX2VudGl0eV9pZCkNCiAgICAgICAgDQogICAgICAgIHNhbWxfdXNlX2F
 1dGhuX2NvbnRleHQgPSBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWyJzYW1sX3VzZV9hdXRobl9jb250ZXh0Il0NCiAgICAgICAgY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLn
 RvQm9vbGVhbihzYW1sX3VzZV9hdXRobl9jb250ZXh0LCBUcnVlKQ0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5zZXRVc2VSZXF1ZXN0ZWRBdXRobkNvbnRleHQoY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250Z
 Xh0KQ0KDQogICAgICAgIHJldHVybiBjbGllbnRTYW1sQ29uZmlndXJhdGlvbg0KDQogICAgZGVmIHByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZyhzZWxmLCBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cmli
 dXRlc19saXN0KToNCiAgICAgICAgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZWxwZXIuaXN
 FbXB0eShzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIHNhbW
 xfaWRwX2F0dHJpYnV0ZXNfbGlzdCBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSA9IFN0cmluZ0hlbHBlci5zcGxpdChzY
 W1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBh
 cmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVjaWZpZWQgaW4gc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGl
 mIChsZW4oc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5KSAhPSBsZW4oc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbm
 cuIFRoZSBudW1iZXIgb2YgYXR0cmlidXRlcyBpbiBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QgYW5kIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IGlzbid0IGVxdWFsIg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgI
 CAgDQogICAgICAgIGF0dHJpYnV0ZU1hcHBpbmcgPSBJZGVudGl0eUhhc2hNYXAoKQ0KICAgICAgICBpID0gMA0KICAgICAgICBjb3VudCA9IGxlbihzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpDQogICAgICAgIHdoaWxl
 IChpIDwgY291bnQpOg0KICAgICAgICAgICAgaWRwQXR0cmlidXRlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdF9hcnJheVtpXSkNCiAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0
 gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0X2FycmF5W2ldKQ0KICAgICAgICAgICAgYXR0cmlidXRlTWFwcGluZy5wdXQoaWRwQXR0cmlidXRlLCBsb2NhbEF0dHJpYnV0ZSkNCg0KIC
 AgICAgICAgICAgaSA9IGkgKyAxDQogICAgICAgIA0KICAgICAgICByZXR1cm4gYXR0cmlidXRlTWFwcGluZw0KDQogICAgZGVmIHByZXBhcmVVc2VyT2JqZWN0Q2xhc3NlcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6D
 QogICAgICAgIHVzZXJfb2JqZWN0X2NsYXNzZXMgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInVzZXJfb2JqZWN0X2NsYXNzZXMiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIHVzZXJfb2JqZWN0X2NsYXNzZXNfbGlzdF9h
 cnJheSA9IFN0cmluZ0hlbHBlci5zcGxpdCh1c2VyX29iamVjdF9jbGFzc2VzLCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KHVzZXJfb2JqZWN0X2NsYXNzZXNfbGlzdF9hcnJheSkpOg0KICAgICAgICAgICA
 gcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiB1c2VyX29iamVjdF9jbGFzc2VzX2xpc3RfYXJyYXkNCg0KICAgIGRlZiBwcmVwYXJlVXNlckVuZm9yY2VVbmlxdWVuZXNzQXR0cmlidXRlcyhzZWxmLCBjb25maW
 d1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGVuZm9yY2VfdW5pcXVlbmVzc19hdHRyX2xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImVuZm9yY2VfdW5pcXVlbmVzc19hdHRyX2xpc3QiKS5nZXRWYWx1ZTIoK
 Q0KDQogICAgICAgIGVuZm9yY2VfdW5pcXVlbmVzc19hdHRyX2xpc3RfYXJyYXkgPSBTdHJpbmdIZWxwZXIuc3BsaXQoZW5mb3JjZV91bmlxdWVuZXNzX2F0dHJfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZWxwZXIuaXNF
 bXB0eShlbmZvcmNlX3VuaXF1ZW5lc3NfYXR0cl9saXN0X2FycmF5KSk6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGVuZm9yY2VfdW5pcXVlbmVzc19hdHRyX2xpc3RfYXJyYXkNCg0
 KICAgIGRlZiBwcmVwYXJlQ3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nKHNlbGYsIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgc2FtbF
 9jbGllbnRfY29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGlmIChzYW1sX2NsaWVudF9jb25maWd1cmF0a
 W9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KDQogICAgICAgIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fdmFsdWUgPSBqc29uLmxvYWRzKHNhbWxfY2xpZW50X2NvbmZp
 Z3VyYXRpb24uZ2V0VmFsdWUoKSkNCg0KICAgICAgICBjbGllbnRBdHRyaWJ1dGVzTWFwcGluZyA9IHNlbGYucHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5nKHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fdmFsdWVbInNhbWxfaWRwX2F
 0dHJpYnV0ZXNfbGlzdCJdLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWyJzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCJdKQ0KICAgICAgICBpZiAoY2xpZW50QXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk6DQogIC
 AgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZUN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy4gQ2xpZW50IGF0dHJpYnV0ZXMgbWFwcGluZyBpcyBpbnZhbGlkLiBVc2luZyBkZWZhdWx0IG9uZSINCiAgICAgICAgICAgIHJldHVyb
 iBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICByZXR1cm4gY2xpZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgIGRlZiBzYW1sRXh0ZW5zaW9uUG9zdExvZ2luKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVz
 LCB1c2VyKToNCiAgICAgICAgaWYgKHNlbGYuc2FtbEV4dGVuc2lvbk1vZHVsZSA9PSBOb25lKToNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2V
 sZi5zYW1sRXh0ZW5zaW9uTW9kdWxlLnBvc3RMb2dpbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgdXNlcikNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4gcmVzdWx0OiAnJXMnIiAlIHBvc3RfbG
 9naW5fcmVzdWx0DQoNCiAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uLCBleDoNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4uIEZha
 WxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICBwcmludCAiU2FtbC4gRXh0ZW5zaW9uUG9zdGxvZ2luLiBVbmV4cGVjdGVkIGVycm9yOiIsIGV4DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAg
 ICAgICAgZXhjZXB0IGphdmEubGFuZy5UaHJvd2FibGUsIGV4Og0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEV4dGVuc2lvblBvc3Rsb2dpbi4gRmFpbGVkIHRvIGV4ZWN1dGUgcG9zdExvZ2luIG1ldGhvZCINCiAgICAgICAgICA
 gIGV4LnByaW50U3RhY2tUcmFjZSgpIA0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgY2hlY2tVc2VyVW5pcXVlbmVzcyhzZWxmLCB1c2VyKToNCiAgICAgICAgaWYgKHNlbGYudXNlckVuZm9yY2VBdHRyaWJ1dG
 VzVW5pcXVlbmVzcyA9PSBOb25lKToNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgIyBQcmVwYXJlIHVzZXIgb2JqZWN0IHRvI
 HNlYXJjaCBieSBwYXR0ZXJuDQogICAgICAgIHVzZXJCYXNlRG4gPSB1c2VyU2VydmljZS5nZXREbkZvclVzZXIoTm9uZSkgDQoNCiAgICAgICAgdXNlclRvU2VhcmNoID0gVXNlcigpDQogICAgICAgIHVzZXJUb1NlYXJjaC5zZXRE
 bih1c2VyQmFzZURuKQ0KDQogICAgICAgIGZvciB1c2VyQXR0cmlidXRlTmFtZSBpbiBzZWxmLnVzZXJFbmZvcmNlQXR0cmlidXRlc1VuaXF1ZW5lc3M6DQogICAgICAgICAgICBhdHRyaWJ1dGVfdmFsdWVzX2xpc3QgPSB1c2VyLmd
 ldEF0dHJpYnV0ZVZhbHVlcyh1c2VyQXR0cmlidXRlTmFtZSkNCiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVfdmFsdWVzX2xpc3QgIT0gTm9uZSkgYW5kIChhdHRyaWJ1dGVfdmFsdWVzX2xpc3Quc2l6ZSgpID4gMCk6DQogICAgIC
 AgICAgICAgICAgdXNlclRvU2VhcmNoLnNldEF0dHJpYnV0ZSh1c2VyQXR0cmlidXRlTmFtZSwgYXR0cmlidXRlX3ZhbHVlc19saXN0KQ0KDQogICAgICAgIGxkYXBFbnRyeU1hbmFnZXIgPSBDb21wb25lbnQuZ2V0SW5zdGFuY2UoI
 mxkYXBFbnRyeU1hbmFnZXIiKTsNCg0KICAgICAgICAjIFRPRE86IFJlcGxhY2Ugd2l0aCB1c2VyU2VydmljZS5maW5kRW50cmllcyBpbiBDRSAyLjQuNQ0KICAgICAgICB1c2VycyA9IGxkYXBFbnRyeU1hbmFnZXIuZmluZEVudHJp
 ZXModXNlclRvU2VhcmNoLCAxLCAxKQ0KICAgICAgICBpZiB1c2Vycy5zaXplKCkgPiAwOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!5018.AF9C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: UAF authentication module
displayName: uaf
gluuStatus: false
inum: %(inumOrg)s!0011!5018.AF9C
oxConfigurationProperty: {"value1":"uaf_server_uri","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"uaf_policy_name","value2":"default","description":""}
oxConfigurationProperty: {"value1":"qr_options","value2":"{ width: 400, height: 400 }","description":""}
oxConfigurationProperty: {"value1":"registration_uri","value2":"https://%(hostname)s/identity/register","description":""}
oxConfigurationProperty: {"value1":"send_push_notifaction","value2":"false","description":""}
oxLevel: 90
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmd
 WxsIHRleHQuDQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KIyBSZXF1aXJlcyB0aGUgZm9sbG93aW5nIGN1c3RvbSBw
 cm9wZXJ0aWVzIGFuZCB2YWx1ZXM6DQojICAgdWFmX3NlcnZlcl91cmk6IGh0dHBzOi8vY2UtZGV2LmdsdXUub3JnDQojDQojIFRoZXNlIGFyZSBub24gbWFuZGF0b3J5IGN1c3RvbSB
 wcm9wZXJ0aWVzIGFuZCB2YWx1ZXM6DQojICAgdWFmX3BvbGljeV9uYW1lOiBkZWZhdWx0DQojICAgc2VuZF9wdXNoX25vdGlmYWN0aW9uOiBmYWxzZQ0KIyAgIHJlZ2lzdHJhdGlvbl
 91cmk6IGh0dHBzOi8vY2UtZGV2LmdsdXUub3JnL2lkZW50aXR5L3JlZ2lzdGVyDQojICAgcXJfb3B0aW9uczogeyB3aWR0aDogNDAwLCBoZWlnaHQ6IDQwMCB9DQoNCmZyb20gb3JnL
 nhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0aGVudGljYXRpb25UeXBlDQpmcm9tIG9yZy5qYm9zcy5zZWFtLmNvbnRleHRzIGltcG9ydCBD
 b250ZXh0LCBDb250ZXh0cw0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclN
 lcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2VydmljZSwgU2Vzc2lvblN0YXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlcg0KZnJvbSBvcmcueGRpLn
 V0aWwgaW1wb3J0IEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20gb3JnLnhkaS5veGF1dGgubW9kZWwuY29uZmlnIGltc
 G9ydCBDb25zdGFudHMNCmZyb20gb3JnLmpib3NzLnJlc3RlYXN5LmNsaWVudCBpbXBvcnQgQ2xpZW50UmVzcG9uc2VGYWlsdXJlDQpmcm9tIGphdmF4LndzLnJzLmNvcmUgaW1wb3J0
 IFJlc3BvbnNlDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UubmV0IGltcG9ydCBIdHRwU2VydmljZQ0KZnJvbSBvcmcuYXB
 hY2hlLmh0dHAucGFyYW1zIGltcG9ydCBDb3JlQ29ubmVjdGlvblBOYW1lcw0KDQppbXBvcnQgc3lzDQppbXBvcnQgamF2YQ0KDQp0cnk6DQogICAgaW1wb3J0IGpzb24NCmV4Y2VwdC
 BJbXBvcnRFcnJvcjoNCiAgICBpbXBvcnQgc2ltcGxlanNvbiBhcyBqc29uDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogI
 CAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYg
 aW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVQUYuIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIGlmIG5vdCBjb25maWd1cmF0aW9
 uQXR0cmlidXRlcy5jb250YWluc0tleSgidWFmX3NlcnZlcl91cmkiKToNCiAgICAgICAgICAgIHByaW50ICJVQUYuIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSB1YWZfc2VydmVyX3
 VyaSBpcyBtYW5kYXRvcnkiDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLnVhZl9zZXJ2ZXJfdXJpID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0K
 CJ1YWZfc2VydmVyX3VyaSIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgc2VsZi51YWZfcG9saWN5X25hbWUgPSAiZGVmYXVsdCINCiAgICAgICAgaWYgY29uZmlndXJhdGlvbkF0dHJp
 YnV0ZXMuY29udGFpbnNLZXkoInVhZl9wb2xpY3lfbmFtZSIpOg0KICAgICAgICAgICAgc2VsZi51YWZfcG9saWN5X25hbWUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInV
 hZl9wb2xpY3lfbmFtZSIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgc2VsZi5zZW5kX3B1c2hfbm90aWZhY3Rpb24gPSBGYWxzZQ0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5jb250YWluc0tleSgic2VuZF9wdXNoX25vdGlmYWN0aW9uIik6DQogICAgICAgICAgICBzZWxmLnNlbmRfcHVzaF9ub3RpZmFjdGlvbiA9IFN0cmluZ0hlbHBlci50b0Jvb
 2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzZW5kX3B1c2hfbm90aWZhY3Rpb24iKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgc2VsZi5yZWdpc3RyYXRp
 b25fdXJpID0gTm9uZQ0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgicmVnaXN0cmF0aW9uX3VyaSIpOg0KICAgICAgICAgICAgc2VsZi5yZWd
 pc3RyYXRpb25fdXJpID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJyZWdpc3RyYXRpb25fdXJpIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBzZWxmLmN1c3RvbVFyT3B0aW
 9ucyA9IHt9DQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJxcl9vcHRpb25zIik6DQogICAgICAgICAgICBzZWxmLmN1c3RvbVFyT3B0aW9uc
 yA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgicXJfb3B0aW9ucyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgcHJpbnQgIlVBRi4gSW5pdGlhbGl6aW5nIEhUVFAgY2xpZW50
 Ig0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgc2VsZi5odHRwX2NsaWVudCA9IGh0dHBTZXJ2aWNlLmdldEh0dHBzQ2xpZW50KCk
 NCiAgICAgICAgaHR0cF9jbGllbnRfcGFyYW1zID0gc2VsZi5odHRwX2NsaWVudC5nZXRQYXJhbXMoKQ0KICAgICAgICBodHRwX2NsaWVudF9wYXJhbXMuc2V0SW50UGFyYW1ldGVyKE
 NvcmVDb25uZWN0aW9uUE5hbWVzLkNPTk5FQ1RJT05fVElNRU9VVCwgMTUgKiAxMDAwKQ0KDQogICAgICAgIHByaW50ICJVQUYuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseS4gdWFmX
 3NlcnZlcl91cmk6ICclcycsIHVhZl9wb2xpY3lfbmFtZTogJyVzJywgc2VuZF9wdXNoX25vdGlmYWN0aW9uOiAnJXMnLCByZWdpc3RyYXRpb25fdXJpOiAnJXMnLCBxcl9vcHRpb25z
 OiAnJXMnIiAlIChzZWxmLnVhZl9zZXJ2ZXJfdXJpLCBzZWxmLnVhZl9wb2xpY3lfbmFtZSwgc2VsZi5zZW5kX3B1c2hfbm90aWZhY3Rpb24sIHNlbGYucmVnaXN0cmF0aW9uX3VyaSw
 gc2VsZi5jdXN0b21Rck9wdGlvbnMpDQogICAgICAgIA0KICAgICAgICBwcmludCAiVUFGLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCi
 AgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVQUYuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJVQUYuIERlc3Ryb
 3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1Zh
 bGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx
 0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZi
 BhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pb
 nN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5n
 ZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KDQogICAgICAgIHNlbGYuc2V0RXZlbnR
 Db250ZXh0UGFyYW1ldGVycyhjb250ZXh0KQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIlVBRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQ
 ogICAgICAgICAgICANCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlciA9IHNlbGYucHJvY2Vzc0Jhc2ljQXV0aGVudGljYXRpb24oY3JlZGVudGlhbHMpDQogICAgICAgICAgI
 CBpZiBhdXRoZW50aWNhdGVkX3VzZXIgPT0gTm9uZToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdWFmX2F1dGhfbWV0aG9kID0gImF1dGhlbnRp
 Y2F0ZSINCiAgICAgICAgICAgICMgVW5jb21tZW50IHRoaXMgYmxvY2sgaWYgeW91IG5lZWQgdG8gYWxsb3cgdXNlciBzZWNvbmQgZGV2aWNlIHJlZ2lzdHJhdGlvbg0KICAgICAgICA
 gICAgI2Vucm9sbG1lbnRfbW9kZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywgImxvZ2luRm9ybTpyZWdpc3RlckJ1dHRvbiIpDQogICAgICAgIC
 AgICAjaWYgU3RyaW5nSGVscGVyLmlzTm90RW1wdHkoZW5yb2xsbWVudF9tb2RlKToNCiAgICAgICAgICAgICMgICAgdWFmX2F1dGhfbWV0aG9kID0gImVucm9sbCINCiAgICAgICAgI
 CAgIA0KICAgICAgICAgICAgaWYgdWFmX2F1dGhfbWV0aG9kID09ICJhdXRoZW50aWNhdGUiOg0KICAgICAgICAgICAgICAgIHVzZXJfZW5yb2xsbWVudHMgPSBzZWxmLmZpbmRFbnJv
 bGxtZW50cyhjcmVkZW50aWFscykNCiAgICAgICAgICAgICAgICBpZiBsZW4odXNlcl9lbnJvbGxtZW50cykgPT0gMDoNCiAgICAgICAgICAgICAgICAgICAgdWFmX2F1dGhfbWV0aG9
 kID0gImVucm9sbCINCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlVBRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFRoZXJlIGlzIG5vIFVBRiBlbnJvbGxtZW50IGZvciB1c2
 VyICclcycuIENoYW5naW5nIHVhZl9hdXRoX21ldGhvZCB0byAnJXMnIiAlICh1c2VyX25hbWUsIHVhZl9hdXRoX21ldGhvZCkNCg0KICAgICAgICAgICAgcHJpbnQgIlVBRi4gQXV0a
 GVudGljYXRlIGZvciBzdGVwIDEuIHVhZl9hdXRoX21ldGhvZDogJyVzJyIgJSB1YWZfYXV0aF9tZXRob2QNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29udGV4dC5zZXQoInVh
 Zl9hdXRoX21ldGhvZCIsIHVhZl9hdXRoX21ldGhvZCkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW5
 0ICJVQUYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICBzZXNzaW9uX3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb2
 5TdGF0ZUZyb21Db29raWUoKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2Vzc2lvbl9zdGF0ZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlVBRi4gUHJlc
 GFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGlmIHVzZXJf
 bmFtZSA9PSBOb25lOg0KICAgICAgICAgICAgICAgIHByaW50ICJVQUYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHVzZXIgbmFtZSINCiAgICA
 gICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdWFmX2F1dGhfcmVzdWx0ID0gU2VydmVyVXRpbC5nZXRGaXJzdFZhbHVlKHJlcXVlc3RQYXJhbWV0ZXJzLCAiYX
 V0aF9yZXN1bHQiKQ0KICAgICAgICAgICAgaWYgdWFmX2F1dGhfcmVzdWx0ICE9ICJzdWNjZXNzIjoNCiAgICAgICAgICAgICAgICBwcmludCAiVUFGLiBBdXRoZW50aWNhdGUgZm9yI
 HN0ZXAgMi4gYXV0aF9yZXN1bHQgaXMgJyVzJyIgJSB1YWZfYXV0aF9yZXN1bHQNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgIyBSZXN0b3JlIHN0
 YXRlIGZyb20gc2Vzc2lvbg0KICAgICAgICAgICAgdWFmX2F1dGhfbWV0aG9kID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgidWFmX2F1dGhfbWV0aG9kIikNCg0KICAgICAgICAgICA
 gaWYgbm90IHVhZl9hdXRoX21ldGhvZCBpbiBbJ2Vucm9sbCcsICdhdXRoZW50aWNhdGUnXToNCiAgICAgICAgICAgICAgICBwcmludCAiVUFGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZX
 AgMi4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB1c2VyLiB1YWZfYXV0aF9tZXRob2Q6ICclcyciICUgdWFmX2F1dGhfbWV0aG9kDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QoNCiAgICAgICAgICAgICMgUmVxdWVzdCBTVEFUVVNfT0JCDQogICAgICAgICAgICBpZiBUcnVlOg0KICAgICAgICAgICAgICAgICNUT0RPOiBSZW1vdmUgdGhpcyBjb25kaXRpb24N
 CiAgICAgICAgICAgICAgICAjIEl0J3Mgd29ya2Fyb3VuZCBiZWN1YXNlIGl0J3Mgbm90IHBvc3NpYmxlIHRvIGNhbGwgU1RBVFVTX09CQiAyIHRpbWVzLiBGaXJzdCB0aW1lIG9uIGJ
 yb3dzZXIgYW5kIHNlY29uZCBpbWUgb24gc2VydmVyDQogICAgICAgICAgICAgICAgdWFmX3VzZXJfZGV2aWNlX2hhbmRsZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZX
 N0UGFyYW1ldGVycywgImF1dGhfaGFuZGxlIikNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgdWFmX29iYl9hdXRoX21ldGhvZCA9IHNlc3Npb25fYXR0cmlidXRlc
 y5nZXQoInVhZl9vYmJfYXV0aF9tZXRob2QiKQ0KICAgICAgICAgICAgICAgIHVhZl9vYmJfc2VydmVyX3VyaSA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoInVhZl9vYmJfc2VydmVy
 X3VyaSIpDQogICAgICAgICAgICAgICAgdWFmX29iYl9zdGFydF9yZXNwb25zZSA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoInVhZl9vYmJfc3RhcnRfcmVzcG9uc2UiKQ0KDQogICA
 gICAgICAgICAgICAgIyBQcmVwYXJlIFNUQVRVU19PQkINCiAgICAgICAgICAgICAgICB1YWZfb2JiX3N0YXJ0X3Jlc3BvbnNlX2pzb24gPSBqc29uLmxvYWRzKHVhZl9vYmJfc3Rhcn
 RfcmVzcG9uc2UpDQogICAgICAgICAgICAgICAgdWFmX29iYl9zdGF0dXNfcmVxdWVzdF9kaWN0aW9uYXJ5ID0geyAib3BlcmF0aW9uIjogIlNUQVRVU18lcyIgJSB1YWZfb2JiX2F1d
 GhfbWV0aG9kLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVzZXJOYW1lIjogdXNlcl9uYW1lLA0KICAgICAgICAgICAgICAg
 ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIm5lZWREZXRhaWxzIjogMSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA
 gICAgICAgICJvb2JTdGF0dXNIYW5kbGUiOiB1YWZfb2JiX3N0YXJ0X3Jlc3BvbnNlX2pzb25bIm9vYlN0YXR1c0hhbmRsZSJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC
 AgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICANCiAgICAgICAgICAgICAgICB1YWZfb2JiX3N0YXR1c19yZXF1ZXN0ID0ganNvbi5kdW1wcyh1YWZfb2JiX3N0YXR1c19yZXF1Z
 XN0X2RpY3Rpb25hcnksIHNlcGFyYXRvcnM9KCcsJywnOicpKQ0KICAgICAgICAgICAgICAgIHByaW50ICJVQUYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBQcmVwYXJlZCBTVEFU
 VVMgcmVxdWVzdDogJyVzJyB0byBzZW5kIHRvICclcyciICUgKHVhZl9vYmJfc3RhdHVzX3JlcXVlc3QsIHVhZl9vYmJfc2VydmVyX3VyaSkNCg0KICAgICAgICAgICAgICAgIHVhZl9
 zdGF0dXNfb2JiX3Jlc3BvbnNlID0gc2VsZi5leGVjdXRlUG9zdCh1YWZfb2JiX3NlcnZlcl91cmksIHVhZl9vYmJfc3RhdHVzX3JlcXVlc3QpDQogICAgICAgICAgICAgICAgaWYgdW
 FmX3N0YXR1c19vYmJfcmVzcG9uc2UgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBwcmludCAiVUFGLiBBdXRoZW50a
 WNhdGUgZm9yIHN0ZXAgMi4gR2V0IFNUQVRVUyByZXNwb25zZTogJyVzJyIgJSB1YWZfc3RhdHVzX29iYl9yZXNwb25zZQ0KICAgICAgICAgICAgICAgIHVhZl9zdGF0dXNfb2JiX3Jl
 c3BvbnNlX2pzb24gPSBqc29uLmxvYWRzKHVhZl9zdGF0dXNfb2JiX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIHVhZl9zdGF0dXNfb2JiX3J
 lc3BvbnNlX2pzb25bInN0YXR1c0NvZGUiXSAhPSA0MDAwOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiVUFGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gVUFGIG9wZXJhdG
 lvbiBzdGF0dXMgaXMgaW52YWxpZC4gc3RhdHVzQ29kZTogJyVzJyIgJSB1YWZfc3RhdHVzX29iYl9yZXNwb25zZV9qc29uWyJzdGF0dXNDb2RlIl0NCiAgICAgICAgICAgICAgICAgI
 CAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICB1YWZfdXNlcl9kZXZpY2VfaGFuZGxlID0gdWFmX3N0YXR1c19vYmJfcmVzcG9uc2VfanNvblsiYWRkaXRpb25hbEluZm8i
 XVsiYXV0aGVudGljYXRvcnNSZXN1bHQiXVsiaGFuZGxlIl0NCg0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkodWFmX3VzZXJfZGV2aWNlX2hhbmRsZSk6DQogICA
 gICAgICAgICAgICAgcHJpbnQgIlVBRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZ2V0IFVBRiBoYW5kbGUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCi
 AgICAgICAgICAgIHVhZl91c2VyX2V4dGVybmFsX3VpZCA9ICJ1YWY6JXMiICUgdWFmX3VzZXJfZGV2aWNlX2hhbmRsZQ0KICAgICAgICAgICAgcHJpbnQgIlVBRi4gQXV0aGVudGljY
 XRlIGZvciBzdGVwIDIuIFVBRiBoYW5kbGU6ICclcyciICUgdWFmX3VzZXJfZXh0ZXJuYWxfdWlkDQoNCiAgICAgICAgICAgIGlmIHVhZl9hdXRoX21ldGhvZCA9PSAiYXV0aGVudGlj
 YXRlIjoNCiAgICAgICAgICAgICAgICAjIFZhbGlkYXRlIGlmIHVzZXIgdXNlZCBkZXZpY2Ugd2l0aCBzYW1lIGtlWUhhbmRsZQ0KICAgICAgICAgICAgICAgIHVzZXJfZW5yb2xsbWV
 udHMgPSBzZWxmLmZpbmRFbnJvbGxtZW50cyhjcmVkZW50aWFscykNCiAgICAgICAgICAgICAgICBpZiBsZW4odXNlcl9lbnJvbGxtZW50cykgPT0gMDoNCiAgICAgICAgICAgICAgIC
 AgICAgdWFmX2F1dGhfbWV0aG9kID0gImVucm9sbCINCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlVBRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIFRoZXJlIGlzIG5vIFVBR
 iBlbnJvbGxtZW50IGZvciB1c2VyICclcycuIiAlIHVzZXJfbmFtZQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAg
 ICAgICBmb3IgdXNlcl9lbnJvbGxtZW50IGluIHVzZXJfZW5yb2xsbWVudHM6DQogICAgICAgICAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHVzZXJ
 fZW5yb2xsbWVudCwgdWFmX3VzZXJfZGV2aWNlX2hhbmRsZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiVUFGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gVGhlcm
 UgaXMgVUFGIGVucm9sbG1lbnQgZm9yIHVzZXIgJyVzJy4gVXNlciBhdXRoZW50aWNhdGVkIHN1Y2Nlc3NmdWxseSIgJSB1c2VyX25hbWUNCiAgICAgICAgICAgICAgICAgICAgICAgI
 HJldHVybiBUcnVlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgICAgICAgICAg
 IyBEb3VibGUgY2hlY2sganVzdCB0byBtYWtlIHN1cmUuIFdlIGRpZCBjaGVja2luZyBpbiBwcmV2aW91cyBzdGVwDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB
 1c2VyIHdoaWNoIGhhcyB1YWZfdXNlcl9leHRlcm5hbF91aWQNCiAgICAgICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgdXNlciBjZXJ0IHRvIG1vcmUgdGhhbiBvbmUgSURQIGFjY2
 91bnQNCiAgICAgICAgICAgICAgICBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgdWFmX3VzZ
 XJfZXh0ZXJuYWxfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIGZpbmRfdXNlcl9ieV9leHRlcm5hbF91aWQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgIyBBZGQgdWFmX3Vz
 ZXJfZXh0ZXJuYWxfdWlkIHRvIHVzZXIncyBleHRlcm5hbCBHVUlEIGxpc3QNCiAgICAgICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X2V4dGVybmFsX3VpZCA9IHVzZXJTZXJ2aWN
 lLmFkZFVzZXJBdHRyaWJ1dGUodXNlcl9uYW1lLCAib3hFeHRlcm5hbFVpZCIsIHVhZl91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgaWYgZmluZF91c2VyX2
 J5X2V4dGVybmFsX3VpZCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlVBRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGUgY
 3VycmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJ
 pYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgY2
 9udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIHNlc3Npb25fYXR0cmlidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0cmlidXRlcyIpDQoNCiAgI
 CAgICAgc2VsZi5zZXRFdmVudENvbnRleHRQYXJhbWV0ZXJzKGNvbnRleHQpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAg
 ICBlbGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcHJpbnQgIlVBRi4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICBzZXNzaW9uX3N0YXRlID0gU2Vzc2lvblN
 0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb25TdGF0ZUZyb21Db29raWUoKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2Vzc2lvbl9zdGF0ZSk6DQ
 ogICAgICAgICAgICAgICAgcHJpbnQgIlVBRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICAgICAgICAgICAgcmV0d
 XJuIEZhbHNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICB1c2VyID0gYXV0
 aGVudGljYXRpb25TZXJ2aWNlLmdldEF1dGhlbnRpY2F0ZWRVc2VyKCkNCiAgICAgICAgICAgIGlmICh1c2VyID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVQUYuIFB
 yZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHVhZl9hdXRoX2
 1ldGhvZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoInVhZl9hdXRoX21ldGhvZCIpDQogICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh1YWZfYXV0aF9tZXRob2QpO
 g0KICAgICAgICAgICAgICAgIHByaW50ICJVQUYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSBhdXRoX21ldGhvZCINCiAgICAgICAgICAgICAgICByZXR1
 cm4gRmFsc2UNCg0KICAgICAgICAgICAgcHJpbnQgIlVBRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiB1YWZfYXV0aF9tZXRob2Q6ICclcyciICUgdWFmX2F1dGhfbWV0aG9kDQoNCiAgICA
 gICAgICAgIHVhZl9vYmJfYXV0aF9tZXRob2QgPSAiT09CX1JFRyINCiAgICAgICAgICAgIHVhZl9vYmJfc2VydmVyX3VyaSA9IHNlbGYudWFmX3NlcnZlcl91cmkgKyAiL25ubC92Mi
 9yZWciIA0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UodWFmX2F1dGhfbWV0aG9kLCAiYXV0aGVudGljYXRlIik6DQogICAgICAgICAgICAgICAgd
 WFmX29iYl9hdXRoX21ldGhvZCA9ICJPT0JfQVVUSCINCiAgICAgICAgICAgICAgICB1YWZfb2JiX3NlcnZlcl91cmkgPSBzZWxmLnVhZl9zZXJ2ZXJfdXJpICsgIi9ubmwvdjIvYXV0
 aCIgDQoNCiAgICAgICAgICAgICMgUHJlcGFyZSBTVEFSVF9PQkINCiAgICAgICAgICAgIHVhZl9vYmJfc3RhcnRfcmVxdWVzdF9kaWN0aW9uYXJ5ID0geyAib3BlcmF0aW9uIjogIlN
 UQVJUXyVzIiAlIHVhZl9vYmJfYXV0aF9tZXRob2QsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInVzZXJOYW1lIjogdXNlci5nZXRVc2
 VySWQoKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicG9saWN5TmFtZSI6ICJkZWZhdWx0IiwNCiAgICAgICAgICAgICAgICAgICAgI
 CAgICAgICAgICAgICAgICAgICAgICAgICAgICAib29iTW9kZSI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyAicXIiOiAidHJ1
 ZSIsICJyYXdEYXRhIjogImZhbHNlIiwgInB1c2giOiAiZmFsc2UiIH0gDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICA
 gICAgdWFmX29iYl9zdGFydF9yZXF1ZXN0ID0ganNvbi5kdW1wcyh1YWZfb2JiX3N0YXJ0X3JlcXVlc3RfZGljdGlvbmFyeSwgc2VwYXJhdG9ycz0oJywnLCc6JykpDQogICAgICAgIC
 AgICBwcmludCAiVUFGLiBQcmVwYXJlIGZvciBzdGVwIDIuIFByZXBhcmVkIFNUQVJUIHJlcXVlc3Q6ICclcycgdG8gc2VuZCB0byAnJXMnIiAlICh1YWZfb2JiX3N0YXJ0X3JlcXVlc
 3QsIHVhZl9vYmJfc2VydmVyX3VyaSkNCg0KICAgICAgICAgICAgIyBSZXF1ZXN0IFNUQVJUX09CQg0KICAgICAgICAgICAgdWFmX29iYl9zdGFydF9yZXNwb25zZSA9IHNlbGYuZXhl
 Y3V0ZVBvc3QodWFmX29iYl9zZXJ2ZXJfdXJpLCB1YWZfb2JiX3N0YXJ0X3JlcXVlc3QpDQogICAgICAgICAgICBpZiB1YWZfb2JiX3N0YXJ0X3Jlc3BvbnNlID09IE5vbmU6DQogICA
 gICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHByaW50ICJVQUYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gR2V0IFNUQVJUIHJlc3BvbnNlOiAnJXMnIiAlIHVhZl
 9vYmJfc3RhcnRfcmVzcG9uc2UNCiAgICAgICAgICAgIHVhZl9vYmJfc3RhcnRfcmVzcG9uc2VfanNvbiA9IGpzb24ubG9hZHModWFmX29iYl9zdGFydF9yZXNwb25zZSkNCg0KICAgI
 CAgICAgICAgIyBQcmVwYXJlIFNUQVRVU19PQkINCiAgICAgICAgICAgICNUT0RPOiBSZW1vdmUgbmVlZERldGFpbHMgcGFyYW1ldGVyDQogICAgICAgICAgICB1YWZfb2JiX3N0YXR1
 c19yZXF1ZXN0X2RpY3Rpb25hcnkgPSB7ICJvcGVyYXRpb24iOiAiU1RBVFVTXyVzIiAlIHVhZl9vYmJfYXV0aF9tZXRob2QsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA
 gICAgICAgICAgICAgICAgICAgICJ1c2VyTmFtZSI6IHVzZXIuZ2V0VXNlcklkKCksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJuZW
 VkRGV0YWlscyI6IDEsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvb2JTdGF0dXNIYW5kbGUiOiB1YWZfb2JiX3N0YXJ0X3Jlc3Bvb
 nNlX2pzb25bIm9vYlN0YXR1c0hhbmRsZSJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICB1YWZfb2JiX3N0
 YXR1c19yZXF1ZXN0ID0ganNvbi5kdW1wcyh1YWZfb2JiX3N0YXR1c19yZXF1ZXN0X2RpY3Rpb25hcnksIHNlcGFyYXRvcnM9KCcsJywnOicpKQ0KICAgICAgICAgICAgcHJpbnQgIlV
 BRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBQcmVwYXJlZCBTVEFUVVMgcmVxdWVzdDogJyVzJyB0byBzZW5kIHRvICclcyciICUgKHVhZl9vYmJfc3RhdHVzX3JlcXVlc3QsIHVhZl9vYm
 Jfc2VydmVyX3VyaSkNCg0KICAgICAgICAgICAgY29udGV4dC5zZXQoInVhZl9vYmJfYXV0aF9tZXRob2QiLCB1YWZfb2JiX2F1dGhfbWV0aG9kKQ0KICAgICAgICAgICAgY29udGV4d
 C5zZXQoInVhZl9vYmJfc2VydmVyX3VyaSIsIHVhZl9vYmJfc2VydmVyX3VyaSkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJ1YWZfb2JiX3N0YXJ0X3Jlc3BvbnNlIiwgdWFmX29i
 Yl9zdGFydF9yZXNwb25zZSkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJxcl9pbWFnZSIsIHVhZl9vYmJfc3RhcnRfcmVzcG9uc2VfanNvblsibW9kZVJlc3VsdCJdWyJxckNvZGU
 iXVsicXJJbWFnZSJdKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoInVhZl9vYmJfc3RhdHVzX3JlcXVlc3QiLCB1YWZfb2JiX3N0YXR1c19yZXF1ZXN0KQ0KDQogICAgICAgICAgIC
 ByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1c
 mF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJ1YWZfYXV0aF9tZXRob2QiLCAidWFmX29iYl9hdXRoX21ldGhvZCIsICJ1YWZfb2Ji
 X3NlcnZlcl91cmkiLCAidWFmX29iYl9zdGFydF9yZXNwb25zZSIpDQoNCiAgICBkZWYgZ2V0Q291bnRBdXRoZW50aWNhdGlvblN0ZXBzKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzKToNCiAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdG
 VwID09IDIpOg0KICAgICAgICAgICAgcmV0dXJuICIvYXV0aC91YWYvbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ
 3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgc2V0RXZlbnRDb250ZXh0UGFyYW1ldGVycyhzZWxmLCBj
 b250ZXh0KToNCiAgICAgICAgaWYgc2VsZi5yZWdpc3RyYXRpb25fdXJpICE9IE5vbmU6DQogICAgICAgICAgICBjb250ZXh0LnNldCgiZXh0ZXJuYWxfcmVnaXN0cmF0aW9uX3VyaSI
 sIHNlbGYucmVnaXN0cmF0aW9uX3VyaSkNCiAgICAgICAgY29udGV4dC5zZXQoInFyX29wdGlvbnMiLCBzZWxmLmN1c3RvbVFyT3B0aW9ucykNCg0KICAgIGRlZiBwcm9jZXNzQmFzaW
 NBdXRoZW50aWNhdGlvbihzZWxmLCBjcmVkZW50aWFscyk6DQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgIHVzZXJfbmFtZSA9I
 GNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICBsb2dnZWRfaW4gPSBGYWxz
 ZQ0KICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKTo
 NCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgaWYgbm90IGxvZ2dlZF9pbj
 oNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiBmaW5kX
 3VzZXJfYnlfdWlkID09IE5vbmU6DQogICAgICAgICAgICBwcmludCAiVUFGLiBQcm9jZXNzIGJhc2ljIGF1dGhlbnRpY2F0aW9uLiBGYWlsZWQgdG8gZmluZCB1c2VyICclcyciICUg
 dXNlcl9uYW1lDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGZpbmRfdXNlcl9ieV91aWQNCg0KICAgIGRlZiBmaW5kRW5yb2xsbWVudHM
 oc2VsZiwgY3JlZGVudGlhbHMpOg0KICAgICAgICByZXN1bHQgPSBbXQ0KDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICB1c2VyX2
 5hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgIHVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyKHVzZXJfbmFtZSwgIm94RXh0ZXJuYWxVaWQiKQ0KICAgICAgI
 CBpZiB1c2VyID09IE5vbmU6DQogICAgICAgICAgICBwcmludCAiVUFGLiBGaW5kIGVucm9sbG1lbnRzLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgICAgICAgcmV0dXJuIHJl
 c3VsdA0KICAgICAgICANCiAgICAgICAgdXNlcl9jdXN0b21fZXh0X2F0dHJpYnV0ZSA9IHVzZXJTZXJ2aWNlLmdldEN1c3RvbUF0dHJpYnV0ZSh1c2VyLCAib3hFeHRlcm5hbFVpZCI
 pDQogICAgICAgIGlmIHVzZXJfY3VzdG9tX2V4dF9hdHRyaWJ1dGUgPT0gTm9uZToNCiAgICAgICAgICAgIHJldHVybiByZXN1bHQNCiAgICAgICAgDQogICAgICAgIHVhZl9wcmVmaX
 ggPSAidWFmOiINCiAgICAgICAgdWFmX3ByZWZpeF9sZW5ndGggPSBsZW4odWFmX3ByZWZpeCkgDQogICAgICAgIGZvciB1c2VyX2V4dGVybmFsX3VpZCBpbiB1c2VyX2N1c3RvbV9le
 HRfYXR0cmlidXRlLmdldFZhbHVlcygpOg0KICAgICAgICAgICAgaW5kZXggPSB1c2VyX2V4dGVybmFsX3VpZC5maW5kKHVhZl9wcmVmaXgpDQogICAgICAgICAgICBpZiBpbmRleCAh
 PSAtMToNCiAgICAgICAgICAgICAgICBlbnJvbGxtZW50X3VpZCA9IHVzZXJfZXh0ZXJuYWxfdWlkW3VhZl9wcmVmaXhfbGVuZ3RoOl0NCiAgICAgICAgICAgICAgICByZXN1bHQuYXB
 wZW5kKGVucm9sbG1lbnRfdWlkKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHJlc3VsdA0KDQogICAgZGVmIGV4ZWN1dGVQb3N0KHNlbGYsIHJlcXVlc3RfdXJpLCByZXF1ZXN0X2
 RhdGEpOg0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICByZXF1ZXN0X2hlYWRlcnMgPSB7ICJDb250ZW50LXR5cGUiIDogImFwc
 GxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgiLCAiQWNjZXB0IiA6ICJhcHBsaWNhdGlvbi9qc29uIiB9DQoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaHR0cF9zZXJ2aWNl
 X3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZVBvc3Qoc2VsZi5odHRwX2NsaWVudCwgcmVxdWVzdF91cmksIE5vbmUsIHJlcXVlc3RfaGVhZGVycywgcmVxdWVzdF9kYXRhKQ0
 KICAgICAgICAgICAgaHR0cF9yZXNwb25zZSA9IGh0dHBfc2VydmljZV9yZXNwb25zZS5nZXRIdHRwUmVzcG9uc2UoKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludC
 AiVUFGLiBWYWxpZGF0ZSBQT1NUIHJlc3BvbnNlLiBFeGNlcHRpb246ICIsIHN5cy5leGNfaW5mbygpWzFdDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIHRyeToNC
 iAgICAgICAgICAgIGlmIG5vdCBodHRwU2VydmljZS5pc1Jlc3BvbnNlU3Rhc3R1c0NvZGVPayhodHRwX3Jlc3BvbnNlKToNCiAgICAgICAgICAgICAgICBwcmludCAiVUFGLiBWYWxp
 ZGF0ZSBQT1NUIHJlc3BvbnNlLiBHZXQgaW52YWxpZCByZXNwb25zZSBmcm9tICBzZXJ2ZXI6ICVzIiAlIHN0cihodHRwX3Jlc3BvbnNlLmdldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXN
 Db2RlKCkpDQogICAgICAgICAgICAgICAgaHR0cFNlcnZpY2UuY29uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgDQogICAgICAgIC
 AgICByZXNwb25zZV9ieXRlcyA9IGh0dHBTZXJ2aWNlLmdldFJlc3BvbnNlQ29udGVudChodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgcmVzcG9uc2Vfc3RyaW5nID0gaHR0cFNlc
 nZpY2UuY29udmVydEVudGl0eVRvU3RyaW5nKHJlc3BvbnNlX2J5dGVzKQ0KICAgICAgICAgICAgaHR0cFNlcnZpY2UuY29uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAg
 DQogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2Vfc3RyaW5nDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzcG9uc2UuY2xvc2VDb25uZWN0aW9
 uKCkNCiAgICAgICAgcmV0dXJuIE5vbmUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!5018.D4BF,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: HOTP/TOPT authentication module
displayName: otp
gluuStatus: false
inum: %(inumOrg)s!0011!5018.D4BF
oxConfigurationProperty: {"value1":"otp_type","value2":"totp","description":
 ""}
oxConfigurationProperty: {"value1":"otp_conf_file","value2":"/etc/certs/otp_configuration.json","description":""}
oxConfigurationProperty: {"value1":"issuer","value2":"Gluu Inc","description":""}
oxConfigurationProperty: {"value1":"label","value2":"Gluu OTP","description"
 :""}
oxConfigurationProperty: {"value1":"qr_options","value2":"{ size: 400, mSize
 : 0.05 }","description":""}
oxConfigurationProperty: {"value1":"registration_uri","value2":"https://%(hostname)s/identity/register","description":""}
oxLevel: 50
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KIyBSZXF1aXJlcyB0aGUgZm9sbG93aW5nIGN1c3RvbSBwcm9wZXJ0aWVzIGFuZCB2YW
 x1ZXM6DQojICAgb3RwX3R5cGU6IHRvdHAvaHRvcA0KIyAgIGlzc3VlcjogR2x1dSBJbmMNCiMgI
 CBvdHBfY29uZl9maWxlOiAvZXRjL2NlcnRzL290cF9jb25maWd1cmF0aW9uLmpzb24NCiMNCiMg
 VGhlc2UgYXJlIG5vbiBtYW5kYXRvcnkgY3VzdG9tIHByb3BlcnRpZXMgYW5kIHZhbHVlczoNCiM
 gICBsYWJlbDogR2x1dSBPVFANCiMgICBxcl9vcHRpb25zOiB7IHdpZHRoOiA0MDAsIGhlaWdodD
 ogNDAwIH0NCiMgICByZWdpc3RyYXRpb25fdXJpOiBodHRwczovL2NlLWRldi5nbHV1Lm9yZy9pZ
 GVudGl0eS9yZWdpc3Rlcg0KDQpmcm9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBl
 LmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcuamJvc3Muc2V
 hbS5mYWNlcyBpbXBvcnQgRmFjZXNNZXNzYWdlcw0KZnJvbSBqYXZheC5mYWNlcy5jb250ZXh0IG
 ltcG9ydCBGYWNlc0NvbnRleHQNCmZyb20gb3JnLmpib3NzLnNlYW0uaW50ZXJuYXRpb25hbCBpb
 XBvcnQgU3RhdHVzTWVzc2FnZQ0KZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQg
 Q29udGV4dCwgQ29udGV4dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IEl
 kZW50aXR5DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJTZXJ2aWNlLC
 BBdXRoZW50aWNhdGlvblNlcnZpY2UsIFNlc3Npb25TdGF0ZVNlcnZpY2UNCmZyb20gb3JnLnhka
 S51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJh
 eUhlbHBlcg0KZnJvbSBvcmcueGRpLm94YXV0aC51dGlsIGltcG9ydCBTZXJ2ZXJVdGlsDQpmcm9
 tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzDQoNCmZyb20gamF2YS5zZWN1cml0eSBpbXBvcnQgU2
 VjdXJlUmFuZG9tDQpmcm9tIGphdmEudXRpbC5jb25jdXJyZW50IGltcG9ydCBUaW1lVW5pdA0KD
 Qpmcm9tIGNvbS5nb29nbGUuY29tbW9uLmlvIGltcG9ydCBCYXNlRW5jb2RpbmcNCg0KZnJvbSBj
 b20ubG9jaGJyaWRnZS5vYXRoLm90cCBpbXBvcnQgVE9UUA0KZnJvbSBjb20ubG9jaGJyaWRnZS5
 vYXRoLm90cCBpbXBvcnQgSE9UUA0KZnJvbSBjb20ubG9jaGJyaWRnZS5vYXRoLm90cCBpbXBvcn
 QgSE9UUFZhbGlkYXRpb25SZXN1bHQNCmZyb20gY29tLmxvY2hicmlkZ2Uub2F0aC5vdHAgaW1wb
 3J0IEhPVFBWYWxpZGF0b3INCmZyb20gY29tLmxvY2hicmlkZ2Uub2F0aC5vdHAgaW1wb3J0IEht
 YWNTaGFBbGdvcml0aG0NCg0KZnJvbSBjb20ubG9jaGJyaWRnZS5vYXRoLm90cC5rZXlwcm92aXN
 pb25pbmcgaW1wb3J0IE9UUEF1dGhVUklCdWlsZGVyOw0KZnJvbSBjb20ubG9jaGJyaWRnZS5vYX
 RoLm90cC5rZXlwcm92aXNpb25pbmcgaW1wb3J0IE9UUEtleTsNCmZyb20gY29tLmxvY2hicmlkZ
 2Uub2F0aC5vdHAua2V5cHJvdmlzaW9uaW5nLk9UUEtleSBpbXBvcnQgT1RQVHlwZTsNCg0KaW1w
 b3J0IHN5cw0KaW1wb3J0IGphdmENCmltcG9ydCBqYXJyYXkNCg0KdHJ5Og0KICAgIGltcG9ydCB
 qc29uDQpleGNlcHQgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMganNvbg
 0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGUpO
 g0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNl
 bGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQ
 oc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiT1RQLiBJbm
 l0aWFsaXphdGlvbiINCg0KICAgICAgICBpZiBub3QgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY
 29udGFpbnNLZXkoIm90cF90eXBlIik6DQogICAgICAgICAgICBwcmludCAiT1RQLiBJbml0aWFs
 aXphdGlvbi4gUHJvcGVydHkgb3RwX3R5cGUgaXMgbWFuZGF0b3J5Ig0KICAgICAgICAgICAgcmV
 0dXJuIEZhbHNlDQogICAgICAgIHNlbGYub3RwVHlwZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dG
 VzLmdldCgib3RwX3R5cGUiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIGlmIG5vdCBzZWxmLm90c
 FR5cGUgaW4gWyJob3RwIiwgInRvdHAiXToNCiAgICAgICAgICAgIHByaW50ICJPVFAuIEluaXRp
 YWxpemF0aW9uLiBQcm9wZXJ0eSB2YWx1ZSBvdHBfdHlwZSBpcyBpbnZhbGlkIg0KICAgICAgICA
 gICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dG
 VzLmNvbnRhaW5zS2V5KCJpc3N1ZXIiKToNCiAgICAgICAgICAgIHByaW50ICJPVFAuIEluaXRpY
 WxpemF0aW9uLiBQcm9wZXJ0eSBpc3N1ZXIgaXMgbWFuZGF0b3J5Ig0KICAgICAgICAgICAgcmV0
 dXJuIEZhbHNlDQogICAgICAgIHNlbGYub3RwSXNzdWVyID0gY29uZmlndXJhdGlvbkF0dHJpYnV
 0ZXMuZ2V0KCJpc3N1ZXIiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIHNlbGYuY3VzdG9tTGFiZW
 wgPSBOb25lDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5K
 CJsYWJlbCIpOg0KICAgICAgICAgICAgc2VsZi5jdXN0b21MYWJlbCA9IGNvbmZpZ3VyYXRpb25B
 dHRyaWJ1dGVzLmdldCgibGFiZWwiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIHNlbGYuY3VzdG9
 tUXJPcHRpb25zID0ge30NCiAgICAgICAgaWYgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udG
 FpbnNLZXkoInFyX29wdGlvbnMiKToNCiAgICAgICAgICAgIHNlbGYuY3VzdG9tUXJPcHRpb25zI
 D0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJxcl9vcHRpb25zIikuZ2V0VmFsdWUyKCkN
 Cg0KICAgICAgICBzZWxmLnJlZ2lzdHJhdGlvblVyaSA9IE5vbmUNCiAgICAgICAgaWYgY29uZml
 ndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInJlZ2lzdHJhdGlvbl91cmkiKToNCiAgIC
 AgICAgICAgIHNlbGYucmVnaXN0cmF0aW9uVXJpID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ
 2V0KCJyZWdpc3RyYXRpb25fdXJpIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICB2YWxpZE90cENv
 bmZpZ3VyYXRpb24gPSBzZWxmLmxvYWRPdHBDb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb25BdHR
 yaWJ1dGVzKQ0KICAgICAgICBpZiBub3QgdmFsaWRPdHBDb25maWd1cmF0aW9uOg0KICAgICAgIC
 AgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIA0KICAgICAgICBwcmludCAiT1RQLiBJbml0aWFsa
 XplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZGVzdHJv
 eShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJPVFAuIER
 lc3Ryb3kiDQogICAgICAgIHByaW50ICJPVFAuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogIC
 AgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgI
 CAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwg
 dXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnV
 lDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2
 FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNC
 g0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJl
 cXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5
 pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudG
 lhbHMuZ2V0VXNlcm5hbWUoKQ0KDQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVud
 ENvbnRleHQoKQ0KICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vz
 c2lvbkF0dHJpYnV0ZXMiKQ0KDQogICAgICAgIHNlbGYuc2V0RXZlbnRDb250ZXh0UGFyYW1ldGV
 ycyhjb250ZXh0KQ0KDQogICAgICAgIGlmIHN0ZXAgPT0gMToNCiAgICAgICAgICAgIHByaW50IC
 JPVFAuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgI
 CBhdXRoZW50aWNhdGVkX3VzZXIgPSBzZWxmLnByb2Nlc3NCYXNpY0F1dGhlbnRpY2F0aW9uKGNy
 ZWRlbnRpYWxzKQ0KICAgICAgICAgICAgaWYgYXV0aGVudGljYXRlZF91c2VyID09IE5vbmU6DQo
 gICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIG90cF9hdXRoX21ldG
 hvZCA9ICJhdXRoZW50aWNhdGUiDQogICAgICAgICAgICAjIFVuY29tbWVudCB0aGlzIGJsb2NrI
 GlmIHlvdSBuZWVkIHRvIGFsbG93IHVzZXIgc2Vjb25kIE9UUCByZWdpc3RyYXRpb24NCiAgICAg
 ICAgICAgICNlbnJvbGxtZW50X21vZGUgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWV
 zdFBhcmFtZXRlcnMsICJsb2dpbkZvcm06cmVnaXN0ZXJCdXR0b24iKQ0KICAgICAgICAgICAgI2
 lmIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KGVucm9sbG1lbnRfbW9kZSk6DQogICAgICAgICAgI
 CAjICAgIG90cF9hdXRoX21ldGhvZCA9ICJlbnJvbGwiDQogICAgICAgICAgICANCiAgICAgICAg
 ICAgIGlmIG90cF9hdXRoX21ldGhvZCA9PSAiYXV0aGVudGljYXRlIjoNCiAgICAgICAgICAgICA
 gICB1c2VyX2Vucm9sbG1lbnRzID0gc2VsZi5maW5kRW5yb2xsbWVudHModXNlcl9uYW1lKQ0KIC
 AgICAgICAgICAgICAgIGlmIGxlbih1c2VyX2Vucm9sbG1lbnRzKSA9PSAwOg0KICAgICAgICAgI
 CAgICAgICAgICBvdHBfYXV0aF9tZXRob2QgPSAiZW5yb2xsIg0KICAgICAgICAgICAgICAgICAg
 ICBwcmludCAiT1RQLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGhlcmUgaXMgbm8gT1RQIGV
 ucm9sbG1lbnQgZm9yIHVzZXIgJyVzJy4gQ2hhbmdpbmcgb3RwX2F1dGhfbWV0aG9kIHRvICclcy
 ciICUgKHVzZXJfbmFtZSwgb3RwX2F1dGhfbWV0aG9kKQ0KICAgICAgICAgICAgICAgICAgICANC
 iAgICAgICAgICAgIGlmIG90cF9hdXRoX21ldGhvZCA9PSAiZW5yb2xsIjoNCiAgICAgICAgICAg
 ICAgICBwcmludCAiT1RQLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCB
 zdGVwczogJyVzJyIgJSAzDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoIm90cF9jb3VudF
 9sb2dpbl9zdGVwcyIsIDMpDQoNCiAgICAgICAgICAgIHByaW50ICJPVFAuIEF1dGhlbnRpY2F0Z
 SBmb3Igc3RlcCAxLiBvdHBfYXV0aF9tZXRob2Q6ICclcyciICUgb3RwX2F1dGhfbWV0aG9kDQog
 ICAgICAgICAgICBjb250ZXh0LnNldCgib3RwX2F1dGhfbWV0aG9kIiwgb3RwX2F1dGhfbWV0aG9
 kKQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIHN0ZXAgPT0gMjoNCi
 AgICAgICAgICAgIHByaW50ICJPVFAuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KDQogICAgI
 CAgICAgICBzZXNzaW9uX3N0YXRlX3ZhbGlkYXRpb24gPSBzZWxmLnZhbGlkYXRlU2Vzc2lvblN0
 YXRlKHNlc3Npb25fYXR0cmlidXRlcykNCiAgICAgICAgICAgIGlmIG5vdCBzZXNzaW9uX3N0YXR
 lX3ZhbGlkYXRpb246DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgIC
 AgICMgUmVzdG9yZSBzdGF0ZSBmcm9tIHNlc3Npb24NCiAgICAgICAgICAgIG90cF9hdXRoX21ld
 GhvZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoIm90cF9hdXRoX21ldGhvZCIpDQogICAgICAg
 ICAgICBpZiBvdHBfYXV0aF9tZXRob2QgPT0gJ2Vucm9sbCc6DQogICAgICAgICAgICAgICAgYXV
 0aF9yZXN1bHQgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVzdFBhcmFtZXRlcnMsIC
 JhdXRoX3Jlc3VsdCIpDQogICAgICAgICAgICAgICAgaWYgbm90IFN0cmluZ0hlbHBlci5pc0Vtc
 HR5KGF1dGhfcmVzdWx0KToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIk9UUC4gQXV0aGVu
 dGljYXRlIGZvciBzdGVwIDIuIFVzZXIgbm90IGVucm9sbGVkIE9UUCINCiAgICAgICAgICAgICA
 gICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBwcmludCAiT1RQLiBBdXRoZW
 50aWNhdGUgZm9yIHN0ZXAgMi4gU2tpcHBpbmcgdGhpcyBzdGVwIGR1cmluZyBlbnJvbGxtZW50I
 g0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgIG90cF9hdXRoX3Jl
 c3VsdCA9IHNlbGYucHJvY2Vzc090cEF1dGhlbnRpY2F0aW9uKHJlcXVlc3RQYXJhbWV0ZXJzLCB
 1c2VyX25hbWUsIHNlc3Npb25fYXR0cmlidXRlcywgb3RwX2F1dGhfbWV0aG9kKQ0KICAgICAgIC
 AgICAgcHJpbnQgIk9UUC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIE9UUCBhdXRoZW50aWNhd
 GlvbiByZXN1bHQ6ICclcyciICUgb3RwX2F1dGhfcmVzdWx0DQoNCiAgICAgICAgICAgIHJldHVy
 biBvdHBfYXV0aF9yZXN1bHQNCiAgICAgICAgZWxpZiBzdGVwID09IDM6DQogICAgICAgICAgICB
 wcmludCAiT1RQLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMyINCg0KICAgICAgICAgICAgc2Vzc2
 lvbl9zdGF0ZV92YWxpZGF0aW9uID0gc2VsZi52YWxpZGF0ZVNlc3Npb25TdGF0ZShzZXNzaW9uX
 2F0dHJpYnV0ZXMpDQogICAgICAgICAgICBpZiBub3Qgc2Vzc2lvbl9zdGF0ZV92YWxpZGF0aW9u
 Og0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAjIFJlc3RvcmU
 gc3RhdGUgZnJvbSBzZXNzaW9uDQogICAgICAgICAgICBvdHBfYXV0aF9tZXRob2QgPSBzZXNzaW
 9uX2F0dHJpYnV0ZXMuZ2V0KCJvdHBfYXV0aF9tZXRob2QiKQ0KICAgICAgICAgICAgaWYgb3RwX
 2F1dGhfbWV0aG9kICE9ICdlbnJvbGwnOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0K
 DQogICAgICAgICAgICBvdHBfYXV0aF9yZXN1bHQgPSBzZWxmLnByb2Nlc3NPdHBBdXRoZW50aWN
 hdGlvbihyZXF1ZXN0UGFyYW1ldGVycywgdXNlcl9uYW1lLCBzZXNzaW9uX2F0dHJpYnV0ZXMsIG
 90cF9hdXRoX21ldGhvZCkNCiAgICAgICAgICAgIHByaW50ICJPVFAuIEF1dGhlbnRpY2F0ZSBmb
 3Igc3RlcCAzLiBPVFAgYXV0aGVudGljYXRpb24gcmVzdWx0OiAnJXMnIiAlIG90cF9hdXRoX3Jl
 c3VsdA0KDQogICAgICAgICAgICByZXR1cm4gb3RwX2F1dGhfcmVzdWx0DQogICAgICAgIGVsc2U
 6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZW
 xmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KI
 CAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMo
 KQ0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICA
 gc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCg
 0KICAgICAgICBzZWxmLnNldEV2ZW50Q29udGV4dFBhcmFtZXRlcnMoY29udGV4dCkNCg0KICAgI
 CAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgICBwcmludCAiT1RQLiBQcmVwYXJlIGZvciBz
 dGVwIDEiDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsaWYgc3RlcCA9PSA
 yOg0KICAgICAgICAgICAgcHJpbnQgIk9UUC4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgIC
 AgICAgICBzZXNzaW9uX3N0YXRlX3ZhbGlkYXRpb24gPSBzZWxmLnZhbGlkYXRlU2Vzc2lvblN0Y
 XRlKHNlc3Npb25fYXR0cmlidXRlcykNCiAgICAgICAgICAgIGlmIG5vdCBzZXNzaW9uX3N0YXRl
 X3ZhbGlkYXRpb246DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICA
 gIG90cF9hdXRoX21ldGhvZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoIm90cF9hdXRoX21ldG
 hvZCIpDQogICAgICAgICAgICBwcmludCAiT1RQLiBQcmVwYXJlIGZvciBzdGVwIDIuIG90cF9hd
 XRoX21ldGhvZDogJyVzJyIgJSBvdHBfYXV0aF9tZXRob2QNCg0KICAgICAgICAgICAgaWYgb3Rw
 X2F1dGhfbWV0aG9kID09ICdlbnJvbGwnOg0KICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9
 uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgIC
 AgICAgdXNlciA9IGF1dGhlbnRpY2F0aW9uU2VydmljZS5nZXRBdXRoZW50aWNhdGVkVXNlcigpD
 QogICAgICAgICAgICAgICAgaWYgdXNlciA9PSBOb25lOg0KICAgICAgICAgICAgICAgICAgICBw
 cmludCAiT1RQLiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBsb2FkIHVzZXIgZW50eSI
 NCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBpZi
 BzZWxmLm90cFR5cGUgPT0gImhvdHAiOg0KICAgICAgICAgICAgICAgICAgICBvdHBfc2VjcmV0X
 2tleSA9IHNlbGYuZ2VuZXJhdGVTZWNyZXRIb3RwS2V5KCkNCiAgICAgICAgICAgICAgICAgICAg
 b3RwX2Vucm9sbG1lbnRfcmVxdWVzdCA9IHNlbGYuZ2VuZXJhdGVIb3RwU2VjcmV0S2V5VXJpKG9
 0cF9zZWNyZXRfa2V5LCBzZWxmLm90cElzc3VlciwgdXNlci5nZXRBdHRyaWJ1dGUoImRpc3BsYX
 lOYW1lIikpDQogICAgICAgICAgICAgICAgZWxpZiBzZWxmLm90cFR5cGUgPT0gInRvdHAiOg0KI
 CAgICAgICAgICAgICAgICAgICBvdHBfc2VjcmV0X2tleSA9IHNlbGYuZ2VuZXJhdGVTZWNyZXRU
 b3RwS2V5KCkNCiAgICAgICAgICAgICAgICAgICAgb3RwX2Vucm9sbG1lbnRfcmVxdWVzdCA9IHN
 lbGYuZ2VuZXJhdGVUb3RwU2VjcmV0S2V5VXJpKG90cF9zZWNyZXRfa2V5LCBzZWxmLm90cElzc3
 VlciwgdXNlci5nZXRBdHRyaWJ1dGUoImRpc3BsYXlOYW1lIikpDQogICAgICAgICAgICAgICAgZ
 WxzZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIk9UUC4gUHJlcGFyZSBmb3Igc3RlcCAy
 LiBVbmtub3duIE9UUCB0eXBlOiAnJXMnIiAlIHNlbGYub3RwVHlwZQ0KICAgICAgICAgICAgICA
 gICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHByaW50ICJPVFAuIFByZXBhcm
 UgZm9yIHN0ZXAgMi4gUHJlcGFyZWQgZW5yb2xsbWVudCByZXF1ZXN0IGZvciB1c2VyOiAnJXMnI
 iAlIHVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgib3RwX3Nl
 Y3JldF9rZXkiLCBzZWxmLnRvQmFzZTY0VXJsKG90cF9zZWNyZXRfa2V5KSkNCiAgICAgICAgICA
 gICAgICBjb250ZXh0LnNldCgib3RwX2Vucm9sbG1lbnRfcmVxdWVzdCIsIG90cF9lbnJvbGxtZW
 50X3JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsaWYgc3Rlc
 CA9PSAzOg0KICAgICAgICAgICAgcHJpbnQgIk9UUC4gUHJlcGFyZSBmb3Igc3RlcCAzIg0KDQog
 ICAgICAgICAgICBzZXNzaW9uX3N0YXRlX3ZhbGlkYXRpb24gPSBzZWxmLnZhbGlkYXRlU2Vzc2l
 vblN0YXRlKHNlc3Npb25fYXR0cmlidXRlcykNCiAgICAgICAgICAgIGlmIG5vdCBzZXNzaW9uX3
 N0YXRlX3ZhbGlkYXRpb246DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgI
 CAgICAgIG90cF9hdXRoX21ldGhvZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoIm90cF9hdXRo
 X21ldGhvZCIpDQogICAgICAgICAgICBwcmludCAiT1RQLiBQcmVwYXJlIGZvciBzdGVwIDMuIG9
 0cF9hdXRoX21ldGhvZDogJyVzJyIgJSBvdHBfYXV0aF9tZXRob2QNCg0KICAgICAgICAgICAgaW
 Ygb3RwX2F1dGhfbWV0aG9kID09ICdlbnJvbGwnOg0KICAgICAgICAgICAgICAgIHJldHVybiBUc
 nVlDQoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJz
 Rm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIHJ
 ldHVybiBBcnJheXMuYXNMaXN0KCJvdHBfYXV0aF9tZXRob2QiLCAib3RwX2NvdW50X2xvZ2luX3
 N0ZXBzIiwgIm90cF9zZWNyZXRfa2V5IiwgIm90cF9lbnJvbGxtZW50X3JlcXVlc3QiKQ0KDQogI
 CAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0
 cmlidXRlcyk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0
 KICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYn
 V0ZXMiKQ0KDQogICAgICAgIGlmIHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgib3RwX
 2NvdW50X2xvZ2luX3N0ZXBzIik6DQogICAgICAgICAgICByZXR1cm4gU3RyaW5nSGVscGVyLnRv
 SW50ZWdlcihzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJvdHBfY291bnRfbG9naW5fc3RlcHMiKSk
 NCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiAyDQoNCiAgICBkZWYgZ2V0UGFnZU
 ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZ
 iBzdGVwID09IDI6DQogICAgICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250
 ZXh0KCkNCiAgICAgICAgICAgIHNlc3Npb25fYXR0cmlidXRlcyA9IGNvbnRleHQuZ2V0KCJzZXN
 zaW9uQXR0cmlidXRlcyIpDQogICAgDQogICAgICAgICAgICBvdHBfYXV0aF9tZXRob2QgPSBzZX
 NzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJvdHBfYXV0aF9tZXRob2QiKQ0KICAgICAgICAgICAgcHJpb
 nQgIk9UUC4gR2VwIHBhZ2UgZm9yIHN0ZXAgMi4gb3RwX2F1dGhfbWV0aG9kOiAnJXMnIiAlIG90
 cF9hdXRoX21ldGhvZA0KICAgIA0KICAgICAgICAgICAgaWYgb3RwX2F1dGhfbWV0aG9kID09ICd
 lbnJvbGwnOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2F1dGgvb3RwL2Vucm9sbC54aHRtbC
 INCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcmV0dXJuICIvYXV0aC9vdHAvb
 3RwbG9naW4ueGh0bWwiDQogICAgICAgIGVsaWYgc3RlcCA9PSAzOg0KICAgICAgICAgICAgcmV0
 dXJuICIvYXV0aC9vdHAvb3RwbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIiDQoNCiA
 gICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW
 1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgc2V0RXZlbnRDb250ZXh0U
 GFyYW1ldGVycyhzZWxmLCBjb250ZXh0KToNCiAgICAgICAgaWYgc2VsZi5yZWdpc3RyYXRpb25V
 cmkgIT0gTm9uZToNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJleHRlcm5hbF9yZWdpc3RyYXR
 pb25fdXJpIiwgc2VsZi5yZWdpc3RyYXRpb25VcmkpDQoNCiAgICAgICAgaWYgc2VsZi5jdXN0b2
 1MYWJlbCAhPSBOb25lOg0KICAgICAgICAgICAgY29udGV4dC5zZXQoInFyX2xhYmVsIiwgc2VsZ
 i5jdXN0b21MYWJlbCkNCg0KICAgICAgICBjb250ZXh0LnNldCgicXJfb3B0aW9ucyIsIHNlbGYu
 Y3VzdG9tUXJPcHRpb25zKQ0KDQogICAgZGVmIGxvYWRPdHBDb25maWd1cmF0aW9uKHNlbGYsIGN
 vbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIk9UUC4gTG9hZCBPVFAgY2
 9uZmlndXJhdGlvbiINCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvb
 nRhaW5zS2V5KCJvdHBfY29uZl9maWxlIik6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0K
 ICAgICAgICBvdHBfY29uZl9maWxlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJvdHB
 fY29uZl9maWxlIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICAjIExvYWQgY29uZmlndXJhdGlvbi
 Bmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4ob3RwX2NvbmZfZmlsZSwgJ3InKQ0KICAgICAgI
 CB0cnk6DQogICAgICAgICAgICBvdHBDb25maWd1cmF0aW9uID0ganNvbi5sb2FkcyhmLnJlYWQo
 KSkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIk9UUC4gTG9hZCBPVFAgY29
 uZmlndXJhdGlvbi4gRmFpbGVkIHRvIGxvYWQgY29uZmlndXJhdGlvbiBmcm9tIGZpbGU6Iiwgb3
 RwX2NvbmZfZmlsZQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGZpbmFsbHk6D
 QogICAgICAgICAgICBmLmNsb3NlKCkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgY29uZmln
 dXJhdGlvbiBmaWxlIHNldHRpbmdzDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHNlbGYuaG9
 0cENvbmZpZ3VyYXRpb24gPSBvdHBDb25maWd1cmF0aW9uWyJodG9wIl0NCiAgICAgICAgICAgIH
 NlbGYudG90cENvbmZpZ3VyYXRpb24gPSBvdHBDb25maWd1cmF0aW9uWyJ0b3RwIl0NCiAgICAgI
 CAgICAgIA0KICAgICAgICAgICAgaG1hY1NoYUFsZ29yaXRobSA9IHNlbGYudG90cENvbmZpZ3Vy
 YXRpb25bImhtYWNTaGFBbGdvcml0aG0iXQ0KICAgICAgICAgICAgaG1hY1NoYUFsZ29yaXRobVR
 5cGUgPSBOb25lDQoNCiAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYX
 NlKGhtYWNTaGFBbGdvcml0aG0sICJzaGExIik6DQogICAgICAgICAgICAgICAgaG1hY1NoYUFsZ
 29yaXRobVR5cGUgPSBIbWFjU2hhQWxnb3JpdGhtLkhNQUNfU0hBXzENCiAgICAgICAgICAgIGVs
 aWYgU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoaG1hY1NoYUFsZ29yaXRobSwgInNoYTI
 1NiIpOg0KICAgICAgICAgICAgICAgIGhtYWNTaGFBbGdvcml0aG1UeXBlID0gSG1hY1NoYUFsZ2
 9yaXRobS5ITUFDX1NIQV8yNTYNCiAgICAgICAgICAgIGVsaWYgU3RyaW5nSGVscGVyLmVxdWFsc
 0lnbm9yZUNhc2UoaG1hY1NoYUFsZ29yaXRobSwgInNoYTUxMiIpOg0KICAgICAgICAgICAgICAg
 IGhtYWNTaGFBbGdvcml0aG1UeXBlID0gSG1hY1NoYUFsZ29yaXRobS5ITUFDX1NIQV81MTINCiA
 gICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIk9UUC4gTG9hZCBPVFAgY2
 9uZmlndXJhdGlvbi4gSW52YWxpZCBUT1RQIEhNQUMgU0hBIGFsZ29yaXRobTogJyVzJyIgJSBob
 WFjU2hhQWxnb3JpdGhtDQogICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgc2VsZi50b3Rw
 Q29uZmlndXJhdGlvblsiaG1hY1NoYUFsZ29yaXRobVR5cGUiXSA9IGhtYWNTaGFBbGdvcml0aG1
 UeXBlDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJPVFAuIExvYWQgT1RQIG
 NvbmZpZ3VyYXRpb24uIEludmFsaWQgY29uZmlndXJhdGlvbiBmaWxlICclcycgZm9ybWF0LiBFe
 GNlcHRpb246ICclcyciICUgKG90cF9jb25mX2ZpbGUsIHN5cy5leGNfaW5mbygpWzFdKQ0KICAg
 ICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIA0KDQogICAgICAgIHJldHVybiBUcnVlDQo
 NCiAgICBkZWYgcHJvY2Vzc0Jhc2ljQXV0aGVudGljYXRpb24oc2VsZiwgY3JlZGVudGlhbHMpOg
 0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgI
 CB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgIHVzZXJfcGFz
 c3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgbG9nZ2VkX2luID0
 gRmFsc2UNCiAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW
 1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCk6DQogI
 CAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1l
 LCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgIGlmIG5vdCBsb2dnZWRfaW46DQogICAgICAgICA
 gICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS
 5nZXRVc2VyKHVzZXJfbmFtZSkNCiAgICAgICAgaWYgZmluZF91c2VyX2J5X3VpZCA9PSBOb25lO
 g0KICAgICAgICAgICAgcHJpbnQgIk9UUC4gUHJvY2VzcyBiYXNpYyBhdXRoZW50aWNhdGlvbi4g
 RmFpbGVkIHRvIGZpbmQgdXNlciAnJXMnIiAlIHVzZXJfbmFtZQ0KICAgICAgICAgICAgcmV0dXJ
 uIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiBmaW5kX3VzZXJfYnlfdWlkDQoNCiAgIC
 BkZWYgZmluZEVucm9sbG1lbnRzKHNlbGYsIHVzZXJfbmFtZSwgc2tpcFByZWZpeCA9IFRydWUpO
 g0KICAgICAgICByZXN1bHQgPSBbXQ0KDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZp
 Y2UuaW5zdGFuY2UoKQ0KICAgICAgICB1c2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25
 hbWUsICJveEV4dGVybmFsVWlkIikNCiAgICAgICAgaWYgdXNlciA9PSBOb25lOg0KICAgICAgIC
 AgICAgcHJpbnQgIk9UUC4gRmluZCBlbnJvbGxtZW50cy4gRmFpbGVkIHRvIGZpbmQgdXNlciINC
 iAgICAgICAgICAgIHJldHVybiByZXN1bHQNCiAgICAgICAgDQogICAgICAgIHVzZXJfY3VzdG9t
 X2V4dF9hdHRyaWJ1dGUgPSB1c2VyU2VydmljZS5nZXRDdXN0b21BdHRyaWJ1dGUodXNlciwgIm9
 4RXh0ZXJuYWxVaWQiKQ0KICAgICAgICBpZiB1c2VyX2N1c3RvbV9leHRfYXR0cmlidXRlID09IE
 5vbmU6DQogICAgICAgICAgICByZXR1cm4gcmVzdWx0DQoNCiAgICAgICAgb3RwX3ByZWZpeCA9I
 CIlczoiICUgc2VsZi5vdHBUeXBlDQogICAgICAgIA0KICAgICAgICBvdHBfcHJlZml4X2xlbmd0
 aCA9IGxlbihvdHBfcHJlZml4KSANCiAgICAgICAgZm9yIHVzZXJfZXh0ZXJuYWxfdWlkIGluIHV
 zZXJfY3VzdG9tX2V4dF9hdHRyaWJ1dGUuZ2V0VmFsdWVzKCk6DQogICAgICAgICAgICBpbmRleC
 A9IHVzZXJfZXh0ZXJuYWxfdWlkLmZpbmQob3RwX3ByZWZpeCkNCiAgICAgICAgICAgIGlmIGluZ
 GV4ICE9IC0xOg0KICAgICAgICAgICAgICAgIGlmIHNraXBQcmVmaXg6DQogICAgICAgICAgICAg
 ICAgICAgIGVucm9sbG1lbnRfdWlkID0gdXNlcl9leHRlcm5hbF91aWRbb3RwX3ByZWZpeF9sZW5
 ndGg6XQ0KICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgIGVucm9sbG
 1lbnRfdWlkID0gdXNlcl9leHRlcm5hbF91aWQNCg0KICAgICAgICAgICAgICAgIHJlc3VsdC5hc
 HBlbmQoZW5yb2xsbWVudF91aWQpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gcmVzdWx0DQoN
 CiAgICBkZWYgdmFsaWRhdGVTZXNzaW9uU3RhdGUoc2VsZiwgc2Vzc2lvbl9hdHRyaWJ1dGVzKTo
 NCiAgICAgICAgc2Vzc2lvbl9zdGF0ZSA9IFNlc3Npb25TdGF0ZVNlcnZpY2UuaW5zdGFuY2UoKS
 5nZXRTZXNzaW9uU3RhdGVGcm9tQ29va2llKCkNCiAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzR
 W1wdHkoc2Vzc2lvbl9zdGF0ZSk6DQogICAgICAgICAgICBwcmludCAiT1RQLiBWYWxpZGF0ZSBz
 ZXNzaW9uIHN0YXRlLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICA
 gICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBvdHBfYXV0aF9tZXRob2QgPSBzZXNzaW9uX2
 F0dHJpYnV0ZXMuZ2V0KCJvdHBfYXV0aF9tZXRob2QiKQ0KICAgICAgICBpZiBub3Qgb3RwX2F1d
 GhfbWV0aG9kIGluIFsnZW5yb2xsJywgJ2F1dGhlbnRpY2F0ZSddOg0KICAgICAgICAgICAgcHJp
 bnQgIk9UUC4gVmFsaWRhdGUgc2Vzc2lvbiBzdGF0ZS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB
 1c2VyLiBvdHBfYXV0aF9tZXRob2Q6ICclcyciICUgb3RwX2F1dGhfbWV0aG9kDQogICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIHByb2Nlc
 3NPdHBBdXRoZW50aWNhdGlvbihzZWxmLCByZXF1ZXN0UGFyYW1ldGVycywgdXNlcl9uYW1lLCBz
 ZXNzaW9uX2F0dHJpYnV0ZXMsIG90cF9hdXRoX21ldGhvZCk6DQogICAgICAgIGZhY2VzTWVzc2F
 nZXMgPSBGYWNlc01lc3NhZ2VzLmluc3RhbmNlKCkNCiAgICAgICAgRmFjZXNDb250ZXh0LmdldE
 N1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldEZsYXNoKCkuc2V0S2Vlc
 E1lc3NhZ2VzKFRydWUpDQoNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0
 YW5jZSgpDQoNCiAgICAgICAgb3RwQ29kZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF
 1ZXN0UGFyYW1ldGVycywgImxvZ2luRm9ybTpvdHBDb2RlIikNCiAgICAgICAgaWYgU3RyaW5nSG
 VscGVyLmlzRW1wdHkob3RwQ29kZSk6DQogICAgICAgICAgICBmYWNlc01lc3NhZ2VzLmFkZChTd
 GF0dXNNZXNzYWdlLlNldmVyaXR5LkVSUk9SLCAiRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZS4gT1RQ
 IGNvZGUgaXMgZW1wdHkiKQ0KICAgICAgICAgICAgcHJpbnQgIk9UUC4gUHJvY2VzcyBPVFAgYXV
 0aGVudGljYXRpb24uIG90cENvZGUgaXMgZW1wdHkiDQoNCiAgICAgICAgICAgIHJldHVybiBGYW
 xzZQ0KICAgICAgICANCiAgICAgICAgaWYgb3RwX2F1dGhfbWV0aG9kID09ICJlbnJvbGwiOg0KI
 CAgICAgICAgICAgIyBHZXQga2V5IGZyb20gc2Vzc2lvbg0KICAgICAgICAgICAgb3RwX3NlY3Jl
 dF9rZXlfZW5jb2RlZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoIm90cF9zZWNyZXRfa2V5Iik
 NCiAgICAgICAgICAgIGlmIG90cF9zZWNyZXRfa2V5X2VuY29kZWQgPT0gTm9uZToNCiAgICAgIC
 AgICAgICAgICBwcmludCAiT1RQLiBQcm9jZXNzIE9UUCBhdXRoZW50aWNhdGlvbi4gT1RQIHNlY
 3JldCBrZXkgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAg
 ICAgICAgIA0KICAgICAgICAgICAgb3RwX3NlY3JldF9rZXkgPSBzZWxmLmZyb21CYXNlNjRVcmw
 ob3RwX3NlY3JldF9rZXlfZW5jb2RlZCkNCg0KICAgICAgICAgICAgaWYgc2VsZi5vdHBUeXBlID
 09ICJob3RwIjoNCiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uX3Jlc3VsdCA9IHNlbGYudmFsa
 WRhdGVIb3RwS2V5KG90cF9zZWNyZXRfa2V5LCAxLCBvdHBDb2RlKQ0KICAgICAgICAgICAgICAg
 IA0KICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uX3Jlc3VsdCAhPSBOb25lKSBhbmQgdmF
 saWRhdGlvbl9yZXN1bHRbInJlc3VsdCJdOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiT1
 RQLiBQcm9jZXNzIEhPVFAgYXV0aGVudGljYXRpb24gZHVyaW5nIGVucm9sbG1lbnQuIG90cENvZ
 GUgaXMgdmFsaWQiDQogICAgICAgICAgICAgICAgICAgICMgU3RvcmUgSE9UUCBTZWNyZXQgS2V5
 IGFuZCBtb3ZpbmcgZmFjdG9yIGluIHVzZXIgZW50cnkNCiAgICAgICAgICAgICAgICAgICAgb3R
 wX3VzZXJfZXh0ZXJuYWxfdWlkID0gImhvdHA6JXM7JXMiICUgKCBvdHBfc2VjcmV0X2tleV9lbm
 NvZGVkLCB2YWxpZGF0aW9uX3Jlc3VsdFsibW92aW5nRmFjdG9yIl0gKQ0KDQogICAgICAgICAgI
 CAgICAgICAgICMgQWRkIG90cF91c2VyX2V4dGVybmFsX3VpZCB0byB1c2VyJ3MgZXh0ZXJuYWwg
 R1VJRCBsaXN0DQogICAgICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV9leHRlcm5hbF91aWQ
 gPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJfbmFtZSwgIm94RXh0ZXJuYWxVaW
 QiLCBvdHBfdXNlcl9leHRlcm5hbF91aWQpDQogICAgICAgICAgICAgICAgICAgIGlmIGZpbmRfd
 XNlcl9ieV9leHRlcm5hbF91aWQgIT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHJl
 dHVybiBUcnVlDQoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIk9UUC4gUHJvY2VzcyBIT1R
 QIGF1dGhlbnRpY2F0aW9uIGR1cmluZyBlbnJvbGxtZW50LiBGYWlsZWQgdG8gdXBkYXRlIHVzZX
 IgZW50cnkiDQogICAgICAgICAgICBlbGlmIHNlbGYub3RwVHlwZSA9PSAidG90cCI6DQogICAgI
 CAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBzZWxmLnZhbGlkYXRlVG90cEtleShvdHBf
 c2VjcmV0X2tleSwgb3RwQ29kZSkNCiAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbl9yZXN
 1bHQgIT0gTm9uZSkgYW5kIHZhbGlkYXRpb25fcmVzdWx0WyJyZXN1bHQiXToNCiAgICAgICAgIC
 AgICAgICAgICAgcHJpbnQgIk9UUC4gUHJvY2VzcyBUT1RQIGF1dGhlbnRpY2F0aW9uIGR1cmluZ
 yBlbnJvbGxtZW50LiBvdHBDb2RlIGlzIHZhbGlkIg0KICAgICAgICAgICAgICAgICAgICAjIFN0
 b3JlIFRPVFAgU2VjcmV0IEtleSBhbmQgbW92aW5nIGZhY3RvciBpbiB1c2VyIGVudHJ5DQogICA
 gICAgICAgICAgICAgICAgIG90cF91c2VyX2V4dGVybmFsX3VpZCA9ICJ0b3RwOiVzIiAlIG90cF
 9zZWNyZXRfa2V5X2VuY29kZWQNCg0KICAgICAgICAgICAgICAgICAgICAjIEFkZCBvdHBfdXNlc
 l9leHRlcm5hbF91aWQgdG8gdXNlcidzIGV4dGVybmFsIEdVSUQgbGlzdA0KICAgICAgICAgICAg
 ICAgICAgICBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UuYWRkVXNlckF
 0dHJpYnV0ZSh1c2VyX25hbWUsICJveEV4dGVybmFsVWlkIiwgb3RwX3VzZXJfZXh0ZXJuYWxfdW
 lkKQ0KICAgICAgICAgICAgICAgICAgICBpZiBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkICE9I
 E5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgICAg
 ICAgICAgICAgIHByaW50ICJPVFAuIFByb2Nlc3MgVE9UUCBhdXRoZW50aWNhdGlvbiBkdXJpbmc
 gZW5yb2xsbWVudC4gRmFpbGVkIHRvIHVwZGF0ZSB1c2VyIGVudHJ5Ig0KICAgICAgICBlbGlmIG
 90cF9hdXRoX21ldGhvZCA9PSAiYXV0aGVudGljYXRlIjoNCiAgICAgICAgICAgIHVzZXJfZW5yb
 2xsbWVudHMgPSBzZWxmLmZpbmRFbnJvbGxtZW50cyh1c2VyX25hbWUpDQoNCiAgICAgICAgICAg
 IGlmIGxlbih1c2VyX2Vucm9sbG1lbnRzKSA9PSAwOg0KICAgICAgICAgICAgICAgIHByaW50ICJ
 PVFAuIFByb2Nlc3MgT1RQIGF1dGhlbnRpY2F0aW9uLiBUaGVyZSBpcyBubyBPVFAgZW5yb2xsbW
 VudCBmb3IgdXNlciAnJXMnIiAlIHVzZXJfbmFtZQ0KICAgICAgICAgICAgICAgIGZhY2VzTWVzc
 2FnZXMuYWRkKFN0YXR1c01lc3NhZ2UuU2V2ZXJpdHkuRVJST1IsICJUaGVyZSBpcyBubyB2YWxp
 ZCBPVFAgdXNlciBlbnJvbGxtZW50cyIpDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQo
 NCiAgICAgICAgICAgIGlmIHNlbGYub3RwVHlwZSA9PSAiaG90cCI6DQogICAgICAgICAgICAgIC
 AgZm9yIHVzZXJfZW5yb2xsbWVudCBpbiB1c2VyX2Vucm9sbG1lbnRzOg0KICAgICAgICAgICAgI
 CAgICAgICB1c2VyX2Vucm9sbG1lbnRfZGF0YSA9IHVzZXJfZW5yb2xsbWVudC5zcGxpdCgiOyIp
 DQogICAgICAgICAgICAgICAgICAgIG90cF9zZWNyZXRfa2V5X2VuY29kZWQgPSB1c2VyX2Vucm9
 sbG1lbnRfZGF0YVswXQ0KDQogICAgICAgICAgICAgICAgICAgICMgR2V0IGN1cnJlbnQgbW92aW
 5nIGZhY3RvciBmcm9tIHVzZXIgZW50cnkNCiAgICAgICAgICAgICAgICAgICAgbW92aW5nX2ZhY
 3RvciA9IFN0cmluZ0hlbHBlci50b0ludGVnZXIodXNlcl9lbnJvbGxtZW50X2RhdGFbMV0pDQog
 ICAgICAgICAgICAgICAgICAgIG90cF9zZWNyZXRfa2V5ID0gc2VsZi5mcm9tQmFzZTY0VXJsKG9
 0cF9zZWNyZXRfa2V5X2VuY29kZWQpDQoNCiAgICAgICAgICAgICAgICAgICAgIyBWYWxpZGF0ZS
 BUT1RQDQogICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25fcmVzdWx0ID0gc2VsZi52YWxpZ
 GF0ZUhvdHBLZXkob3RwX3NlY3JldF9rZXksIG1vdmluZ19mYWN0b3IsIG90cENvZGUpDQogICAg
 ICAgICAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uX3Jlc3VsdCAhPSBOb25lKSBhbmQgdmFsaWR
 hdGlvbl9yZXN1bHRbInJlc3VsdCJdOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIk
 9UUC4gUHJvY2VzcyBIT1RQIGF1dGhlbnRpY2F0aW9uIGR1cmluZyBhdXRoZW50aWNhdGlvbi4gb
 3RwQ29kZSBpcyB2YWxpZCINCiAgICAgICAgICAgICAgICAgICAgICAgIG90cF91c2VyX2V4dGVy
 bmFsX3VpZCA9ICJob3RwOiVzOyVzIiAlICggb3RwX3NlY3JldF9rZXlfZW5jb2RlZCwgbW92aW5
 nX2ZhY3RvciApDQogICAgICAgICAgICAgICAgICAgICAgICBuZXdfb3RwX3VzZXJfZXh0ZXJuYW
 xfdWlkID0gImhvdHA6JXM7JXMiICUgKCBvdHBfc2VjcmV0X2tleV9lbmNvZGVkLCB2YWxpZGF0a
 W9uX3Jlc3VsdFsibW92aW5nRmFjdG9yIl0gKQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICAg
 ICAgIyBVcGRhdGUgbW92aW5nIGZhY3RvciBpbiB1c2VyIGVudHJ5DQogICAgICAgICAgICAgICA
 gICAgICAgICBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkID0gdXNlclNlcnZpY2UucmVwbGFjZV
 VzZXJBdHRyaWJ1dGUodXNlcl9uYW1lLCAib3hFeHRlcm5hbFVpZCIsIG90cF91c2VyX2V4dGVyb
 mFsX3VpZCwgbmV3X290cF91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgICAgICAgICAg
 ICAgIGlmIGZpbmRfdXNlcl9ieV9leHRlcm5hbF91aWQgIT0gTm9uZToNCiAgICAgICAgICAgICA
 gICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIA0KICAgICAgICAgICAgICAgICAgICAgIC
 AgcHJpbnQgIk9UUC4gUHJvY2VzcyBIT1RQIGF1dGhlbnRpY2F0aW9uIGR1cmluZyBhdXRoZW50a
 WNhdGlvbi4gRmFpbGVkIHRvIHVwZGF0ZSB1c2VyIGVudHJ5Ig0KICAgICAgICAgICAgZWxpZiBz
 ZWxmLm90cFR5cGUgPT0gInRvdHAiOg0KICAgICAgICAgICAgICAgIGZvciB1c2VyX2Vucm9sbG1
 lbnQgaW4gdXNlcl9lbnJvbGxtZW50czoNCiAgICAgICAgICAgICAgICAgICAgb3RwX3NlY3JldF
 9rZXkgPSBzZWxmLmZyb21CYXNlNjRVcmwodXNlcl9lbnJvbGxtZW50KQ0KDQogICAgICAgICAgI
 CAgICAgICAgICMgVmFsaWRhdGUgVE9UUA0KICAgICAgICAgICAgICAgICAgICB2YWxpZGF0aW9u
 X3Jlc3VsdCA9IHNlbGYudmFsaWRhdGVUb3RwS2V5KG90cF9zZWNyZXRfa2V5LCBvdHBDb2RlKQ0
 KICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvbl9yZXN1bHQgIT0gTm9uZSkgYW5kIH
 ZhbGlkYXRpb25fcmVzdWx0WyJyZXN1bHQiXToNCiAgICAgICAgICAgICAgICAgICAgICAgIHBya
 W50ICJPVFAuIFByb2Nlc3MgVE9UUCBhdXRoZW50aWNhdGlvbiBkdXJpbmcgYXV0aGVudGljYXRp
 b24uIG90cENvZGUgaXMgdmFsaWQiDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ
 1ZQ0KDQogICAgICAgIGZhY2VzTWVzc2FnZXMuYWRkKFN0YXR1c01lc3NhZ2UuU2V2ZXJpdHkuRV
 JST1IsICJGYWlsZWQgdG8gYXV0aGVudGljYXRlLiBPVFAgY29kZSBpcyBpbnZhbGlkIikNCiAgI
 CAgICAgcHJpbnQgIk9UUC4gUHJvY2VzcyBPVFAgYXV0aGVudGljYXRpb24uIE9UUCBjb2RlIGlz
 IGludmFsaWQiDQoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAjIFNoYXJlZCBIT1RQL1R
 PVFAgbWV0aG9kcw0KICAgIGRlZiBnZW5lcmF0ZVNlY3JldEtleShzZWxmLCBrZXlMZW5ndGgpOg
 0KICAgICAgICBieXRlcyA9IGphcnJheS56ZXJvcyhrZXlMZW5ndGgsICJiIikNCiAgICAgICAgc
 2VjdXJlUmFuZG9tID0gU2VjdXJlUmFuZG9tKCkNCiAgICAgICAgc2VjdXJlUmFuZG9tLm5leHRC
 eXRlcyhieXRlcykNCiAgICAgICAgDQogICAgICAgIHJldHVybiBieXRlcw0KICAgIA0KICAgICM
 gSE9UUCBtZXRob2RzDQogICAgZGVmIGdlbmVyYXRlU2VjcmV0SG90cEtleShzZWxmKToNCiAgIC
 AgICAga2V5TGVuZ3RoID0gc2VsZi5ob3RwQ29uZmlndXJhdGlvblsia2V5TGVuZ3RoIl0NCiAgI
 CAgICAgDQogICAgICAgIHJldHVybiBzZWxmLmdlbmVyYXRlU2VjcmV0S2V5KGtleUxlbmd0aCkN
 Cg0KICAgIGRlZiBnZW5lcmF0ZUhvdHBLZXkoc2VsZiwgc2VjcmV0S2V5LCBtb3ZpbmdGYWN0b3I
 pOg0KICAgICAgICBkaWdpdHMgPSBzZWxmLmhvdHBDb25maWd1cmF0aW9uWyJkaWdpdHMiXQ0KDQ
 ogICAgICAgIGhvdHAgPSBIT1RQLmtleShzZWNyZXRLZXkpLmRpZ2l0cyhkaWdpdHMpLm1vdmluZ
 0ZhY3Rvcihtb3ZpbmdGYWN0b3IpLmJ1aWxkKCkNCiAgICAgICAgDQogICAgICAgIHJldHVybiBo
 b3RwLnZhbHVlKCkNCg0KICAgIGRlZiB2YWxpZGF0ZUhvdHBLZXkoc2VsZiwgc2VjcmV0S2V5LCB
 tb3ZpbmdGYWN0b3IsIHRvdHBLZXkpOg0KICAgICAgICBkaWdpdHMgPSBzZWxmLmhvdHBDb25maW
 d1cmF0aW9uWyJkaWdpdHMiXQ0KDQogICAgICAgIGh0b3BWYWxpZGF0aW9uUmVzdWx0ID0gSE9UU
 FZhbGlkYXRvci5sb29rQWhlYWRXaW5kb3coMSkudmFsaWRhdGUoc2VjcmV0S2V5LCBtb3ZpbmdG
 YWN0b3IsIGRpZ2l0cywgdG90cEtleSkNCiAgICAgICAgaWYgaHRvcFZhbGlkYXRpb25SZXN1bHQ
 uaXNWYWxpZCgpOg0KICAgICAgICAgICAgcmV0dXJuIHsgInJlc3VsdCI6IFRydWUsICJtb3Zpbm
 dGYWN0b3IiOiBodG9wVmFsaWRhdGlvblJlc3VsdC5nZXROZXdNb3ZpbmdGYWN0b3IoKSB9DQoNC
 iAgICAgICAgcmV0dXJuIHsgInJlc3VsdCI6IEZhbHNlLCAibW92aW5nRmFjdG9yIjogTm9uZSB9
 DQoNCiAgICBkZWYgZ2VuZXJhdGVIb3RwU2VjcmV0S2V5VXJpKHNlbGYsIHNlY3JldEtleSwgaXN
 zdWVyLCB1c2VyRGlzcGxheU5hbWUpOg0KICAgICAgICBkaWdpdHMgPSBzZWxmLmhvdHBDb25maW
 d1cmF0aW9uWyJkaWdpdHMiXQ0KDQogICAgICAgIHNlY3JldEtleUJhc2UzMiA9IHNlbGYudG9CY
 XNlMzIoc2VjcmV0S2V5KQ0KICAgICAgICBvdHBLZXkgPSBPVFBLZXkoc2VjcmV0S2V5QmFzZTMy
 LCBPVFBUeXBlLkhPVFApDQogICAgICAgIGxhYmVsID0gaXNzdWVyICsgIjolcyIgJSB1c2VyRGl
 zcGxheU5hbWU7DQoNCiAgICAgICAgb3RwQXV0aFVSSSA9IE9UUEF1dGhVUklCdWlsZGVyLmZyb2
 1LZXkob3RwS2V5KS5sYWJlbChsYWJlbCkuaXNzdWVyKGlzc3VlcikuZGlnaXRzKGRpZ2l0cykuY
 nVpbGQoKTsNCg0KICAgICAgICByZXR1cm4gb3RwQXV0aFVSSS50b1VyaVN0cmluZygpDQoNCiAg
 ICAjIFRPVFAgbWV0aG9kcw0KICAgIGRlZiBnZW5lcmF0ZVNlY3JldFRvdHBLZXkoc2VsZik6DQo
 gICAgICAgIGtleUxlbmd0aCA9IHNlbGYudG90cENvbmZpZ3VyYXRpb25bImtleUxlbmd0aCJdDQ
 ogICAgICAgIA0KICAgICAgICByZXR1cm4gc2VsZi5nZW5lcmF0ZVNlY3JldEtleShrZXlMZW5nd
 GgpDQoNCiAgICBkZWYgZ2VuZXJhdGVUb3RwS2V5KHNlbGYsIHNlY3JldEtleSk6DQogICAgICAg
 IGRpZ2l0cyA9IHNlbGYudG90cENvbmZpZ3VyYXRpb25bImRpZ2l0cyJdDQogICAgICAgIHRpbWV
 TdGVwID0gc2VsZi50b3RwQ29uZmlndXJhdGlvblsidGltZVN0ZXAiXQ0KICAgICAgICBobWFjU2
 hhQWxnb3JpdGhtVHlwZSA9IHNlbGYudG90cENvbmZpZ3VyYXRpb25bImhtYWNTaGFBbGdvcml0a
 G1UeXBlIl0NCg0KICAgICAgICB0b3RwID0gVE9UUC5rZXkoc2VjcmV0S2V5KS5kaWdpdHMoZGln
 aXRzKS50aW1lU3RlcChUaW1lVW5pdC5TRUNPTkRTLnRvTWlsbGlzKHRpbWVTdGVwKSkuaG1hY1N
 oYShobWFjU2hhQWxnb3JpdGhtVHlwZSkuYnVpbGQoKQ0KICAgICAgICANCiAgICAgICAgcmV0dX
 JuIHRvdHAudmFsdWUoKQ0KDQogICAgZGVmIHZhbGlkYXRlVG90cEtleShzZWxmLCBzZWNyZXRLZ
 XksIHRvdHBLZXkpOg0KICAgICAgICBsb2NhbFRvdHBLZXkgPSBzZWxmLmdlbmVyYXRlVG90cEtl
 eShzZWNyZXRLZXkpDQogICAgICAgIGlmIFN0cmluZ0hlbHBlci5lcXVhbHMobG9jYWxUb3RwS2V
 5LCB0b3RwS2V5KToNCiAgICAgICAgICAgIHJldHVybiB7ICJyZXN1bHQiOiBUcnVlIH0NCg0KIC
 AgICAgICByZXR1cm4geyAicmVzdWx0IjogRmFsc2UgfQ0KDQogICAgZGVmIGdlbmVyYXRlVG90c
 FNlY3JldEtleVVyaShzZWxmLCBzZWNyZXRLZXksIGlzc3VlciwgdXNlckRpc3BsYXlOYW1lKToN
 CiAgICAgICAgZGlnaXRzID0gc2VsZi50b3RwQ29uZmlndXJhdGlvblsiZGlnaXRzIl0NCiAgICA
 gICAgdGltZVN0ZXAgPSBzZWxmLnRvdHBDb25maWd1cmF0aW9uWyJ0aW1lU3RlcCJdDQoNCiAgIC
 AgICAgc2VjcmV0S2V5QmFzZTMyID0gc2VsZi50b0Jhc2UzMihzZWNyZXRLZXkpDQogICAgICAgI
 G90cEtleSA9IE9UUEtleShzZWNyZXRLZXlCYXNlMzIsIE9UUFR5cGUuVE9UUCkNCiAgICAgICAg
 bGFiZWwgPSBpc3N1ZXIgKyAiOiVzIiAlIHVzZXJEaXNwbGF5TmFtZTsNCg0KICAgICAgICBvdHB
 BdXRoVVJJID0gT1RQQXV0aFVSSUJ1aWxkZXIuZnJvbUtleShvdHBLZXkpLmxhYmVsKGxhYmVsKS
 5pc3N1ZXIoaXNzdWVyKS5kaWdpdHMoZGlnaXRzKS50aW1lU3RlcChUaW1lVW5pdC5TRUNPTkRTL
 nRvTWlsbGlzKHRpbWVTdGVwKSkuYnVpbGQoKTsNCg0KICAgICAgICByZXR1cm4gb3RwQXV0aFVS
 SS50b1VyaVN0cmluZygpDQoNCiAgICAjIFV0aWxpdHkgbWV0aG9kcw0KICAgIGRlZiB0b0Jhc2U
 zMihzZWxmLCBieXRlcyk6DQogICAgICAgIHJldHVybiBCYXNlRW5jb2RpbmcuYmFzZTMyKCkuZW
 5jb2RlKGJ5dGVzKQ0KDQogICAgZGVmIHRvQmFzZTY0VXJsKHNlbGYsIGJ5dGVzKToNCiAgICAgI
 CAgcmV0dXJuIEJhc2VFbmNvZGluZy5iYXNlNjRVcmwoKS5lbmNvZGUoYnl0ZXMpDQoNCiAgICBk
 ZWYgZnJvbUJhc2U2NFVybChzZWxmLCBjaGFycyk6DQogICAgICAgIHJldHVybiBCYXNlRW5jb2R
 pbmcuYmFzZTY0VXJsKCkuZGVjb2RlKGNoYXJzKQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B788,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Client Registration script
displayName: client_registration
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B788
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5jbGllbnQgaW1wb
 3J0IENsaWVudFJlZ2lzdHJhdGlvblR5cGUNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJp
 bmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J
 0IFNjb3BlU2VydmljZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQ
 oNCmltcG9ydCBqYXZhDQoNCmNsYXNzIENsaWVudFJlZ2lzdHJhdGlvbihDbGllbnRSZWdpc3RyY
 XRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0K
 ICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICA
 gIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbn
 QgIkNsaWVudCByZWdpc3RyYXRpb24uIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHNlbGYuc
 2NvcGVTZXJ2aWNlID0gU2NvcGVTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBwcmludCAi
 Q2xpZW50IHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICA
 gIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDbGllbnQgcmVnaXN0cmF0aW9uLiBEZXN0cm95I
 g0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3Nm
 dWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIGNsaWVudCBlbnR
 yeSBiZWZvcmUgcGVyc2lzdGVudCBpdA0KICAgICMgICByZWdpc3RlclJlcXVlc3QgaXMgb3JnLn
 hkaS5veGF1dGguY2xpZW50LlJlZ2lzdGVyUmVxdWVzdA0KICAgICMgICBjbGllbnQgaXMgb3JnL
 nhkaS5veGF1dGgubW9kZWwucmVnaXN0cmF0aW9uLkNsaWVudA0KICAgICMgICBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGV
 ydHk+DQogICAgZGVmIHVwZGF0ZUNsaWVudChzZWxmLCByZWdpc3RlclJlcXVlc3QsIGNsaWVudC
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzd
 HJhdGlvbi4gVXBkYXRlQ2xpZW50IG1ldGhvZCINCg0KICAgICAgICByZWRpcmVjdFVyaXMgPSBj
 bGllbnQuZ2V0UmVkaXJlY3RVcmlzKCkNCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXR
 pb24uIFJlZGlyZWN0IFVyaXM6IiwgcmVkaXJlY3RVcmlzDQoNCiAgICAgICAgYWRkQWRkcmVzc1
 Njb3BlID0gRmFsc2UNCiAgICAgICAgZm9yIHJlZGlyZWN0VXJpIGluIHJlZGlyZWN0VXJpczoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShyZWRpcmVjdFVy
 aSwgImh0dHBzOi8vY2xpZW50LmV4YW1wbGUuY29tL2V4YW1wbGUxIikpOg0KICAgICAgICAgICA
 gICAgIGFkZEFkZHJlc3NTY29wZSA9IFRydWUNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgIC
 AgICANCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIElzIGFkZCBhZGRyZXNzI
 HNjb3BlOiIsIGFkZEFkZHJlc3NTY29wZQ0KDQogICAgICAgIGlmIChhZGRBZGRyZXNzU2NvcGUp
 Og0KICAgICAgICAgICAgY3VycmVudFNjb3BlcyA9IGNsaWVudC5nZXRTY29wZXMoKQ0KICAgICA
 gICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIEN1cnJlbnQgc2NvcGVzOiIsIGN1cn
 JlbnRTY29wZXMNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYWRkcmVzc1Njb3BlID0gc2VsZ
 i5zY29wZVNlcnZpY2UuZ2V0U2NvcGVCeURpc3BsYXlOYW1lKCJhZGRyZXNzIikNCiAgICAgICAg
 ICAgIG5ld1Njb3BlcyA9IEFycmF5SGVscGVyLmFkZEl0ZW1Ub1N0cmluZ0FycmF5KGN1cnJlbnR
 TY29wZXMsIGFkZHJlc3NTY29wZS5nZXREbigpKQ0KICAgIA0KICAgICAgICAgICAgcHJpbnQgIk
 NsaWVudCByZWdpc3RyYXRpb24uIFJlc3VsdCBzY29wZXM6IiwgbmV3U2NvcGVzDQogICAgICAgI
 CAgICBjbGllbnQuc2V0U2NvcGVzKG5ld1Njb3BlcykNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
 DQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFB
 hcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb2
 4oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: client_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B789,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Application Session script
displayName: application_session
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B789
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zZXNzaW9uIGltc
 G9ydCBBcHBsaWNhdGlvblNlc3Npb25UeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyLCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJ
 yYXlMaXN0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEFwcGxpY2F0aW9uU2Vzc2lvbihBcHBsaW
 NhdGlvblNlc3Npb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNa
 WxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxs
 aXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcHJpbnQgIkFwcGxpY2F0aW9uIHNlc3Npb24uIEluaXRpYWxpemF0aW9uIg0KICAgICAgIC
 BwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KD
 QogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1
 cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiB
 EZXN0cm95Ig0KICAgICAgICBwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gRGVzdHJveWVkIH
 N1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBnZXRBcGlWZ
 XJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgIyBBcHBsaWNhdGlvbiBjYWxs
 cyBpdCBhdCBlbmQgc2Vzc2lvbiByZXF1ZXN0IHRvIGFsbG93IG5vdGlmeSAzcmQgcGFydCBzeXN
 0ZW1zDQogICAgIyAgIGh0dHBSZXF1ZXN0IGlzIGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vydm
 xldFJlcXVlc3QNCiAgICAjICAgYXV0aG9yaXphdGlvbkdyYW50IGlzIG9yZy54ZGkub3hhdXRoL
 m1vZGVsLmNvbW1vbi5BdXRob3JpemF0aW9uR3JhbnQNCiAgICAjICAgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5Pg0
 KICAgIGRlZiBlbmRTZXNzaW9uKHNlbGYsIGh0dHBSZXF1ZXN0LCBhdXRob3JpemF0aW9uR3Jhbn
 QsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkFwcGxpY2F0aW9uI
 HNlc3Npb24uIFN0YXJ0aW5nIGV4dGVybmFsIHNlc3Npb24gZW5kIg0KDQogICAgICAgIHByaW50
 ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiBFeHRlcm5hbCBzZXNzaW9uIGVuZGVkIHN1Y2Nlc3NmdWx
 seSINCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: application_session
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!031C.5621,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Dynamic Scope script
displayName: dynamic_scope
gluuStatus: false
inum: %(inumOrg)s!0011!031C.5621
oxLevel: 100
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY29wZSBpbXBvcn
 QgRHluYW1pY1Njb3BlVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlc
 iwgQXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0K
 DQppbXBvcnQgamF2YQ0KDQpjbGFzcyBEeW5hbWljU2NvcGUoRHluYW1pY1Njb3BlVHlwZSk6DQo
 gICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi
 5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHNj
 b3BlLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gSW5
 pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgIC
 BkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHBya
 W50ICJEeW5hbWljIHNjb3BlLiBEZXN0cm95Ig0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29w
 ZS4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICA
 gICMgVXBkYXRlIEpzb24gV2ViIHRva2VuIGJlZm9yZSBzaWduaW5nL2VuY3J5cHJpbmcgaXQNCi
 AgICAjICAgZHluYW1pY1Njb3BlQ29udGV4dCBpcyBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmV4d
 GVybmFsLmNvbnRleHQuRHluYW1pY1Njb3BlRXh0ZXJuYWxDb250ZXh0DQogICAgIyAgIGNvbmZp
 Z3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21
 Qcm9wZXJ0eT4NCiAgICBkZWYgdXBkYXRlKHNlbGYsIGR5bmFtaWNTY29wZUNvbnRleHQsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIFVwZ
 GF0ZSBtZXRob2QiDQoNCiAgICAgICAgZHluYW1pY1Njb3BlcyA9IGR5bmFtaWNTY29wZUNvbnRl
 eHQuZ2V0RHluYW1pY1Njb3BlcygpDQogICAgICAgIGF1dGhvcml6YXRpb25HcmFudCA9IGR5bmF
 taWNTY29wZUNvbnRleHQuZ2V0QXV0aG9yaXphdGlvbkdyYW50KCkNCiAgICAgICAgdXNlciA9IG
 R5bmFtaWNTY29wZUNvbnRleHQuZ2V0VXNlcigpDQogICAgICAgIGpzb25XZWJSZXNwb25zZSA9I
 GR5bmFtaWNTY29wZUNvbnRleHQuZ2V0SnNvbldlYlJlc3BvbnNlKCkNCiAgICAgICAgY2xhaW1z
 ID0ganNvbldlYlJlc3BvbnNlLmdldENsYWltcygpDQoNCiAgICAgICAgIyBJdGVyYXRlIHRocm9
 1Z2ggbGlzdCBvZiBkeW5hbWljIHNjb3BlcyBpbiBvcmRlciB0byBhZGQgY3VzdG9tIHNjb3Blcy
 BpZiBuZWVkZWQNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIER5bmFtaWMgc2NvcGVzO
 iIsIGR5bmFtaWNTY29wZXMNCiAgICAgICAgZm9yIGR5bmFtaWNTY29wZSBpbiBkeW5hbWljU2Nv
 cGVzOg0KICAgICAgICAgICAgIyBBZGQgb3JnYW5pemF0aW9uIG5hbWUgaWYgdGhlcmUgaXMgc2N
 vcGUgPSBvcmdfbmFtZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcm
 VDYXNlKGR5bmFtaWNTY29wZSwgIm9yZ19uYW1lIikpOg0KICAgICAgICAgICAgICAgIGNsYWltc
 y5zZXRDbGFpbSgib3JnX25hbWUiLCAiR2x1dSwgSW5jLiIpDQogICAgICAgICAgICAgICAgY29u
 dGludWUNCg0KICAgICAgICAgICAgIyBBZGQgd29yayBwaG9uZSBpZiB0aGVyZSBpcyBzY29wZSA
 9IHdvcmtfcGhvbmUNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2
 FzZShkeW5hbWljU2NvcGUsICJ3b3JrX3Bob25lIikpOg0KICAgICAgICAgICAgICAgIHdvcmtQa
 G9uZSA9IHVzZXIuZ2V0QXR0cmlidXRlKCJ0ZWxlcGhvbmVOdW1iZXIiKTsNCiAgICAgICAgICAg
 ICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHkod29ya1Bob25lKSk6DQogICAgICAgICA
 gICAgICAgICAgIGNsYWltcy5zZXRDbGFpbSgid29ya19waG9uZSIsIHdvcmtQaG9uZSkNCiAgIC
 AgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgb
 G9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6
 DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiA
 gICAgICAgcmV0dXJuIDENCg==
oxScriptType: dynamic_scope
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!A910.56AB,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample script for SCIM events
displayName: scim_event_handler
gluuStatus: false
inum: %(inumOrg)s!0011!A910.56AB
oxConfigurationProperty: {"value1":"testProp1","value2":"Test value 1","description":""}
oxConfigurationProperty: {"value1":"testProp2","value2":"Test value 2","description":""}
oxLevel: 100
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY2ltIGltcG9yd
 CBTY2ltVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlI
 ZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0KZnJvbSBvcmc
 uZ2x1dS5veHRydXN0LmxkYXAuc2VydmljZSBpbXBvcnQgSVBlcnNvblNlcnZpY2UsIFBlcnNvbl
 NlcnZpY2UNCmZyb20gb3JnLmdsdXUub3h0cnVzdC5tb2RlbCBpbXBvcnQgR2x1dUN1c3RvbVBlc
 nNvbg0KDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBTY2ltRXZlbnRIYW5kbGVyKFNjaW1UeXBlKToN
 Cg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHN
 lbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaX
 Qoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2NpbUV2Z
 W50SGFuZGxlciAoaW5pdCk6IEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0
 dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzKToNCiAgICAgICAgcHJpbnQgIlNjaW1FdmVudEhhbmRsZXIgKGRlc3Ryb3kpOiBEZXN0cm
 95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGdld
 EFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgY3JlYXRlVXNl
 cihzZWxmLCB1c2VyLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQoNCiAgICAgICAgcHJpbnQ
 gIlNjaW1FdmVudEhhbmRsZXIgKGNyZWF0ZVVzZXIpOiBDdXJyZW50IGlkID0gIiArIHVzZXIuZ2
 V0VWlkKCkNCg0KICAgICAgICB0ZXN0UHJvcDEgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZ
 XQoInRlc3RQcm9wMSIpLmdldFZhbHVlMigpDQogICAgICAgIHRlc3RQcm9wMiA9IGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzLmdldCgidGVzdFByb3AyIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICB
 wcmludCAiU2NpbUV2ZW50SGFuZGxlciAoY3JlYXRlVXNlcik6IHRlc3RQcm9wMSA9ICIgKyB0ZX
 N0UHJvcDENCiAgICAgICAgcHJpbnQgIlNjaW1FdmVudEhhbmRsZXIgKGNyZWF0ZVVzZXIpOiB0Z
 XN0UHJvcDIgPSAiICsgdGVzdFByb3AyDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRl
 ZiB1cGRhdGVVc2VyKHNlbGYsIHVzZXIsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcGVyc29uU2VydmljZSA9IFBlcnNvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBvbG
 RVc2VyID0gcGVyc29uU2VydmljZS5nZXRQZXJzb25CeVVpZCh1c2VyLmdldFVpZCgpKQ0KICAgI
 CAgICBwcmludCAiU2NpbUV2ZW50SGFuZGxlciAodXBkYXRlVXNlcik6IE9sZCBkaXNwbGF5TmFt
 ZSA9ICIgKyBvbGRVc2VyIC5nZXREaXNwbGF5TmFtZSgpDQogICAgICAgIHByaW50ICJTY2ltRXZ
 lbnRIYW5kbGVyICh1cGRhdGVVc2VyKTogTmV3IGRpc3BsYXlOYW1lID0gIiArIHVzZXIuZ2V0RG
 lzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGRlbGV0ZVVzZXIoc
 2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2Np
 bUV2ZW50SGFuZGxlciAoZGVsZXRlVXNlcik6IEN1cnJlbnQgaWQgPSAiICsgdXNlci5nZXRVaWQ
 oKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGNyZWF0ZUdyb3VwKHNlbGYsIGdyb3
 VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJTY2ltRXZlbnRIY
 W5kbGVyIChjcmVhdGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiICsgZ3JvdXAuZ2V0
 RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIHVwZGF0ZUdyb3V
 wKHNlbGYsIGdyb3VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50IC
 JTY2ltRXZlbnRIYW5kbGVyICh1cGRhdGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiI
 CsgZ3JvdXAuZ2V0RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVm
 IGRlbGV0ZUdyb3VwKHNlbGYsIGdyb3VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICA
 gICAgIHByaW50ICJTY2ltRXZlbnRIYW5kbGVyIChkZWxldGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiICsgZ3JvdXAuZ2V0RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: scim
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!24FD.B96E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: top
objectClass: oxCustomScript
description: OTP Validation of passwords using Yubicloud authentication module
displayName: yubicloud
gluuStatus: false
inum: %(inumOrg)s!0011!24FD.B96E
oxConfigurationProperty: {"value1":"yubicloud_uri","value2":"api.yubico.com"
 ,"description":""}
oxConfigurationProperty: {"value1":"yubicloud_api_key","value2":"","descript
 ion":""}
oxConfigurationProperty: {"value1":"yubicloud_id","value2":"","description":
 ""}
oxLevel: 90
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 sIEFydW5tb3poaQ0KIw0KDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9ydCBJZG
 VudGl0eQ0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9yd
 CBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBp
 bXBvcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXI
 NCg0KaW1wb3J0IGphdmENCg0KaW1wb3J0IHVybGxpYjINCmltcG9ydCB1cmxsaWINCmltcG9ydC
 B1dWlkDQppbXBvcnQgdHJhY2ViYWNrDQoNCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oU
 GVyc29uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVu
 dFRpbWVNaWxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFR
 pbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKT
 oNCiAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHBya
 W50ICJZdWJpY2xvdWQuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCg0KICAgICAgICBzZWxm
 LmFwaV9zZXJ2ZXIgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInl1YmljbG91ZF91cmk
 iKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzZWxmLmFwaV9rZXkgPSBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5nZXQoInl1YmljbG91ZF9hcGlfa2V5IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgc2VsZ
 i5jbGllbnRfaWQgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInl1YmljbG91ZF9pZCIp
 LmdldFZhbHVlMigpDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBkZXN0cm95KHN
 lbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIll1YmljbG91ZC
 4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gRGVzdHJveWVkIHN1Y2Nlc3Nmd
 WxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYp
 Og0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGh
 vZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcm
 V0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kK
 HNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1
 cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cml
 idXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKT
 oNCiAgICAgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxI
 g0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3Jl
 ZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcm5hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmF
 tZSgpDQogICAgICAgICAgICBvdHAgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgIC
 AgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIFVzZXJuYW1lOiAgJXMiICUgKHVzZXJuYW1lKQ0KI
 CAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gT1RQOiAgJXMiICUgKG90cCkNCg0KICAgICAg
 ICAgICAgIyBWYWxpZGF0ZSBvdHAgbGVuZ3RoDQogICAgICAgICAgICBpZiBsZW4ob3RwKSA8IDM
 yIG9yIGxlbihvdHApID4gNDg6DQogICAgICAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gSW
 52YWxpZCBPVFAgbGVuZ3RoIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgI
 CAgICAgICB1c2VyX3NlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAg
 ICB1c2VyID0gdXNlcl9zZXJ2aWNlLmdldFVzZXIodXNlcm5hbWUpDQoNCiAgICAgICAgICAgIHB
 1YmxpY19rZXkgPSB1c2VyLmdldEF0dHJpYnV0ZSgneXViaWtleUlkJykNCg0KICAgICAgICAgIC
 AgcHJpbnQgIll1YmljbG91ZC4gUHVibGljIEtleTogJXMiICUgKHB1YmxpY19rZXkpDQoNCiAgI
 CAgICAgICAgICMgTWF0Y2ggdGhlIHVzZXIgd2l0aCB0aGUgeXViaWtleQ0KICAgICAgICAgICAg
 aWYgcHVibGljX2tleSBub3QgaW4gb3RwOg0KICAgICAgICAgICAgICAgIHByaW50ICJZdWJpY2x
 vdWQuIFB1YmxpYyBLZXkgbm90IG1hdGNoaW5nIE9UUCINCiAgICAgICAgICAgICAgICByZXR1cm
 4gRmFsc2UNCg0KICAgICAgICAgICAgZGF0YSA9ICIiDQogICAgICAgICAgICB0cnk6DQogICAgI
 CAgICAgICAgICAgbm9uY2UgPSBzdHIodXVpZC51dWlkNCgpKS5yZXBsYWNlKCItIiwgIiIpDQog
 ICAgICAgICAgICAgICAgcGFyYW1zID0gdXJsbGliLnVybGVuY29kZSh7ImlkIjogc2VsZi5jbGl
 lbnRfaWQsICJvdHAiOiBvdHAsICJub25jZSI6IG5vbmNlfSkNCiAgICAgICAgICAgICAgICB1cm
 wgPSAiaHR0cHM6Ly8iICsgc2VsZi5hcGlfc2VydmVyICsgIi93c2FwaS8yLjAvdmVyaWZ5Lz8iI
 CsgcGFyYW1zDQogICAgICAgICAgICAgICAgZiA9IHVybGxpYjIudXJsb3Blbih1cmwpDQogICAg
 ICAgICAgICAgICAgZGF0YSA9IGYucmVhZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgcmVwcih
 kYXRhKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgIC
 AgIHByaW50ICJZdWJpY2xvdWQuIEV4Y2VwdGlvbiAiLCBlDQoNCiAgICAgICAgICAgIGlmICdzd
 GF0dXM9T0snIGluIGRhdGE6DQogICAgICAgICAgICAgICAgdXNlcl9zZXJ2aWNlLmF1dGhlbnRp
 Y2F0ZSh1c2VybmFtZSkNCiAgICAgICAgICAgICAgICBwcmludCAiWXViaWNsb3VkLiBBdXRoZW5
 0aWNhdGlvbiBTdWNjZXNzZnVsIg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgIC
 AgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIEVuZCBvZiBTdGVwIDEuIFJldHVybmluZyBGYWxzZ
 S4iDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXR
 pb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGlmIChzdG
 VwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gUHJlcGFyZSBmb3IgU3Rlc
 CAxIg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiw
 gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQ
 ogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQ
 XR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAo
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiI
 NCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3
 RQYXJhbWV0ZXJzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python
